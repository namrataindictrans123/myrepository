{"version":3,"file":"form.min.js","sources":["../../../apps/frappe/frappe/public/js/frappe/views/formview.js","../../../apps/frappe/frappe/public/js/legacy/form.js","../../../apps/frappe/frappe/public/js/legacy/client_script_helpers.js","../../../apps/frappe/frappe/public/js/frappe/form/toolbar.js","../../../apps/frappe/frappe/public/js/frappe/form/dashboard.js","../../../apps/frappe/frappe/public/js/frappe/form/document_flow.js","../../../apps/frappe/frappe/public/js/frappe/form/save.js","../../../apps/frappe/frappe/public/js/frappe/form/script_manager.js","../../../apps/frappe/frappe/public/js/frappe/form/linked_with.js","../../../apps/frappe/frappe/public/js/frappe/form/workflow.js","../../../apps/frappe/frappe/public/js/frappe/form/print.js","../../../apps/frappe/frappe/public/js/frappe/form/form_sidebar.js","../../../apps/frappe/frappe/public/js/frappe/form/user_image.js","../../../apps/frappe/frappe/public/js/frappe/form/share.js","../../../apps/frappe/frappe/public/js/frappe/form/form_viewers.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/footer.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/attachments.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/timeline.js","../../../apps/frappe/frappe/public/js/frappe/form/footer/assign_to.js","../../../apps/frappe/frappe/public/js/frappe/form/quick_entry.js","../../../apps/frappe/frappe/public/js/frappe/form/success_action.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.views.formview');\n\nfrappe.views.FormFactory = class FormFactory extends frappe.views.Factory {\n\tmake(route) {\n\t\tvar me = this,\n\t\t\tdt = route[1];\n\n\t\tif(!frappe.views.formview[dt]) {\n\t\t\tfrappe.model.with_doctype(dt, function() {\n\t\t\t\tme.page = frappe.container.add_page(\"Form/\" + dt);\n\t\t\t\tfrappe.views.formview[dt] = me.page;\n\t\t\t\tme.page.frm = new _f.Frm(dt, me.page, true);\n\t\t\t\tme.show_doc(route);\n\t\t\t});\n\t\t} else {\n\t\t\tme.show_doc(route);\n\t\t}\n\n\n\t\tif(!this.initialized) {\n\t\t\t$(document).on(\"page-change\", function() {\n\t\t\t\tfrappe.ui.form.close_grid_form();\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"new_communication\", function(data) {\n\t\t\t\tfrappe.timeline.new_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"delete_communication\", function(data) {\n\t\t\t\tfrappe.timeline.delete_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on('update_communication', function(data) {\n\t\t\t\tfrappe.timeline.update_communication(data);\n\t\t\t});\n\n\t\t\tfrappe.realtime.on(\"doc_viewers\", function(data) {\n\t\t\t\tfrappe.ui.form.set_viewers(data);\n\t\t\t});\n\t\t}\n\n\n\t\tthis.initialized = true;\n\t}\n\n\tshow_doc(route) {\n\t\tvar dt = route[1],\n\t\t\tdn = route.slice(2).join(\"/\"),\n\t\t\tme = this;\n\n\t\tif(frappe.model.new_names[dn]) {\n\t\t\tdn = frappe.model.new_names[dn];\n\t\t\tfrappe.set_route(\"Form\", dt, dn);\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.model.with_doc(dt, dn, function(dn, r) {\n\t\t\tif(r && r['403']) return; // not permitted\n\n\t\t\tif(!(locals[dt] && locals[dt][dn])) {\n\t\t\t\t// doc not found, but starts with New,\n\t\t\t\t// make a new doc and set it\n\t\t\t\tvar new_str = __(\"New\") + \" \";\n\t\t\t\tif(dn && dn.substr(0, new_str.length)==new_str) {\n\t\t\t\t\tvar new_name = frappe.model.make_new_doc_and_get_name(dt, true);\n\t\t\t\t\tif(new_name===dn) {\n\t\t\t\t\t\tme.load(dt, dn);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.set_route(\"Form\", dt, new_name)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.show_not_found(route);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tme.load(dt, dn);\n\t\t});\n\t}\n\n\tload(dt, dn) {\n\t\tfrappe.container.change_to(\"Form/\" + dt);\n\t\tfrappe.views.formview[dt].frm.refresh(dn);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\n/* Form page structure\n\n\t+ this.parent (either FormContainer or Dialog)\n\t\t+ this.wrapper\n\t\t\t+ this.toolbar\n\t\t\t+ this.form_wrapper\n\t\t\t\t\t+ this.head\n\t\t\t\t\t+ this.body\n\t\t\t\t\t\t+ this.layout\n\t\t\t\t+ this.sidebar\n\t\t\t+ this.footer\n*/\n\n/* eslint-disable no-console */\n\nfrappe.provide('_f');\nfrappe.provide('frappe.ui.form');\n\nfrappe.ui.form.Controller = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t}\n});\n\n_f.frms = {};\n\n_f.Frm = function(doctype, parent, in_form) {\n\tthis.docname = '';\n\tthis.doctype = doctype;\n\tthis.hidden = false;\n\tthis.refresh_if_stale_for = 120;\n\n\tvar me = this;\n\tthis.opendocs = {};\n\tthis.custom_buttons = {};\n\tthis.sections = [];\n\tthis.grids = [];\n\tthis.cscript = new frappe.ui.form.Controller({frm:this});\n\tthis.events = {};\n\tthis.pformat = {};\n\tthis.fetch_dict = {};\n\tthis.parent = parent;\n\tthis.tinymce_id_list = [];\n\n\tthis.setup_meta(doctype);\n\n\t// show in form instead of in dialog, when called using url (router.js)\n\tthis.in_form = in_form ? true : false;\n\n\t// notify on rename\n\t$(document).on('rename', function(event, dt, old_name, new_name) {\n\t\tif(dt==me.doctype)\n\t\t\tme.rename_notify(dt, old_name, new_name);\n\t});\n};\n\n_f.Frm.prototype.check_doctype_conflict = function(docname) {\n\tif(this.doctype=='DocType' && docname=='DocType') {\n\t\tfrappe.msgprint(__('Allowing DocType, DocType. Be careful!'));\n\t} else if(this.doctype=='DocType') {\n\t\tif (frappe.views.formview[docname] || frappe.pages['List/'+docname]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open {0} when its instance is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t} else {\n\t\tif (frappe.views.formview.DocType && frappe.views.formview.DocType.frm.opendocs[this.doctype]) {\n\t\t\twindow.location.reload();\n\t\t\t//\tfrappe.msgprint(__(\"Cannot open instance when its {0} is open\", ['DocType']))\n\t\t\t// throw 'doctype open conflict'\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.setup = function() {\n\tthis.fields = [];\n\tthis.fields_dict = {};\n\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.doctype);\n\n\t// wrapper\n\tthis.wrapper = this.parent;\n\tthis.$wrapper = $(this.wrapper);\n\tfrappe.ui.make_app_page({\n\t\tparent: this.wrapper,\n\t\tsingle_column: this.meta.hide_toolbar\n\t});\n\tthis.page = this.wrapper.page;\n\tthis.layout_main = this.page.main.get(0);\n\n\tthis.toolbar = new frappe.ui.form.Toolbar({\n\t\tfrm: this,\n\t\tpage: this.page\n\t});\n\n\t// print layout\n\tthis.setup_print_layout();\n\n\t// 2 column layout\n\tthis.setup_std_layout();\n\n\t// client script must be called after \"setup\" - there are no fields_dict attached to the frm otherwise\n\tthis.script_manager = new frappe.ui.form.ScriptManager({\n\t\tfrm: this\n\t});\n\tthis.script_manager.setup();\n\tthis.watch_model_updates();\n\n\tif(!this.meta.hide_toolbar) {\n\t\tthis.footer = new frappe.ui.form.Footer({\n\t\t\tfrm: this,\n\t\t\tparent: $('<div>').appendTo(this.page.main.parent())\n\t\t});\n\t\t$(\"body\").attr(\"data-sidebar\", 1);\n\t}\n\tthis.setup_drag_drop();\n\n\tthis.setup_done = true;\n};\n\n_f.Frm.prototype.setup_drag_drop = function() {\n\tvar me = this;\n\tthis.$wrapper.on('dragenter dragover', false)\n\t\t.on('drop', function(e) {\n\t\t\tvar dataTransfer = e.originalEvent.dataTransfer;\n\t\t\tif (!(dataTransfer && dataTransfer.files && dataTransfer.files.length > 0)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\n\t\t\tif(me.doc.__islocal) {\n\t\t\t\tfrappe.msgprint(__(\"Please save before attaching.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tif(me.attachments.max_reached()) {\n\t\t\t\tfrappe.msgprint(__(\"Maximum Attachment Limit for this record reached.\"));\n\t\t\t\tthrow \"attach error\";\n\t\t\t}\n\n\t\t\tfrappe.upload.make({\n\t\t\t\targs: me.attachments.get_args(),\n\t\t\t\tfiles: dataTransfer.files,\n\t\t\t\tcallback: function(attachment, r) {\n\t\t\t\t\tme.attachments.attachment_uploaded(attachment, r);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n};\n\n_f.Frm.prototype.setup_print_layout = function() {\n\tvar me = this;\n\tthis.print_preview = new frappe.ui.form.PrintPreview({\n\t\tfrm: this\n\t});\n\n\t// show edit button for print view\n\tthis.page.wrapper.on('view-change', function() {\n\t\tme.toolbar.set_primary_action();\n\t});\n};\n\n_f.Frm.prototype.print_doc = function() {\n\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\tthis.hide_print();\n\t\treturn;\n\t}\n\tif(!frappe.model.can_print(this.doc.doctype, this)) {\n\t\tfrappe.msgprint(__(\"You are not allowed to print this document\"));\n\t\treturn;\n\t}\n\n\tthis.print_preview.refresh_print_options().trigger(\"change\");\n\tthis.page.set_view(\"print\");\n\tthis.print_preview.set_user_lang();\n\tthis.print_preview.set_default_print_language();\n\tthis.print_preview.preview();\n};\n\n_f.Frm.prototype.hide_print = function() {\n\tif(this.setup_done && this.page.current_view_name===\"print\") {\n\t\tthis.page.set_view(this.page.previous_view_name===\"print\" ?\n\t\t\t\"main\" : (this.page.previous_view_name || \"main\"));\n\t}\n};\n\n_f.Frm.prototype.watch_model_updates = function() {\n\t// watch model updates\n\tvar me = this;\n\n\t// on main doc\n\tfrappe.model.on(me.doctype, \"*\", function(fieldname, value, doc) {\n\t\t// set input\n\t\tif(doc.name===me.docname) {\n\t\t\tif ((value==='' || value===null) && !doc[fieldname]) {\n\t\t\t\t// both the incoming and outgoing values are falsy\n\t\t\t\t// the texteditor, summernote, changes nulls to empty strings on render,\n\t\t\t\t// so ignore those changes\n\t\t\t} else {\n\t\t\t\tme.dirty();\n\t\t\t}\n\t\t\tme.fields_dict[fieldname]\n\t\t\t\t&& me.fields_dict[fieldname].refresh(fieldname);\n\n\t\t\tme.layout.refresh_dependency();\n\t\t\tlet object = me.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\treturn object;\n\t\t}\n\t});\n\n\t// on table fields\n\tvar table_fields = frappe.get_children(\"DocType\", me.doctype, \"fields\", {fieldtype:\"Table\"});\n\n\t// using $.each to preserve df via closure\n\t$.each(table_fields, function(i, df) {\n\t\tfrappe.model.on(df.options, \"*\", function(fieldname, value, doc) {\n\t\t\tif(doc.parent===me.docname && doc.parentfield===df.fieldname) {\n\t\t\t\tme.dirty();\n\t\t\t\tme.fields_dict[df.fieldname].grid.set_value(fieldname, value, doc);\n\t\t\t\tme.script_manager.trigger(fieldname, doc.doctype, doc.name);\n\t\t\t}\n\t\t});\n\t});\n};\n\n_f.Frm.prototype.setup_std_layout = function() {\n\tthis.form_wrapper \t= $('<div></div>').appendTo(this.layout_main);\n\tthis.body \t\t\t= $('<div></div>').appendTo(this.form_wrapper);\n\n\t// only tray\n\tthis.meta.section_style='Simple'; // always simple!\n\n\t// layout\n\tthis.layout = new frappe.ui.form.Layout({\n\t\tparent: this.body,\n\t\tdoctype: this.doctype,\n\t\tfrm: this,\n\t\twith_dashboard: true\n\t});\n\tthis.layout.make();\n\n\tthis.fields_dict = this.layout.fields_dict;\n\tthis.fields = this.layout.fields_list;\n\n\tthis.document_flow = new frappe.ui.form.DocumentFlow({\n\t\tfrm: this\n\t});\n\n\tthis.dashboard = new frappe.ui.form.Dashboard({\n\t\tfrm: this,\n\t});\n\n\t// state\n\tthis.states = new frappe.ui.form.States({\n\t\tfrm: this\n\t});\n};\n\n// email the form\n_f.Frm.prototype.email_doc = function(message) {\n\tnew frappe.views.CommunicationComposer({\n\t\tdoc: this.doc,\n\t\tfrm: this,\n\t\tsubject: __(this.meta.name) + ': ' + this.docname,\n\t\trecipients: this.doc.email || this.doc.email_id || this.doc.contact_email,\n\t\tattach_document_print: true,\n\t\tmessage: message,\n\t\treal_name: this.doc.real_name || this.doc.contact_display || this.doc.contact_name\n\t});\n};\n\n// rename the form\n_f.Frm.prototype.rename_doc = function() {\n\tfrappe.model.rename_doc(this.doctype, this.docname);\n};\n\n_f.Frm.prototype.share_doc = function() {\n\tthis.shared.show();\n};\n\n// notify this form of renamed records\n_f.Frm.prototype.rename_notify = function(dt, old, name) {\n\t// from form\n\tif(this.meta.istable)\n\t\treturn;\n\n\tif(this.docname == old)\n\t\tthis.docname = name;\n\telse\n\t\treturn;\n\n\t// cleanup\n\tif(this && this.opendocs[old] && frappe.meta.docfield_copy[dt]) {\n\t\t// delete docfield copy\n\t\tfrappe.meta.docfield_copy[dt][name] = frappe.meta.docfield_copy[dt][old];\n\t\tdelete frappe.meta.docfield_copy[dt][old];\n\t}\n\n\tdelete this.opendocs[old];\n\tthis.opendocs[name] = true;\n\n\tif(this.meta.in_dialog || !this.in_form) {\n\t\treturn;\n\t}\n\n\tfrappe.re_route[window.location.hash] = '#Form/' + encodeURIComponent(this.doctype) + '/' + encodeURIComponent(name);\n\tfrappe.set_route('Form', this.doctype, name);\n};\n\n// SETUP\n\n_f.Frm.prototype.setup_meta = function() {\n\tthis.meta = frappe.get_doc('DocType', this.doctype);\n\tthis.perm = frappe.perm.get_perm(this.doctype); // for create\n\tif(this.meta.istable) {\n\t\tthis.meta.in_dialog = 1;\n\t}\n};\n\n_f.Frm.prototype.refresh_header = function(is_a_different_doc) {\n\t// set title\n\t// main title\n\tif(!this.meta.in_dialog || this.in_form) {\n\t\tfrappe.utils.set_title(this.meta.issingle ? this.doctype : this.docname);\n\t}\n\n\t// show / hide buttons\n\tif(this.toolbar) {\n\t\tif (is_a_different_doc) {\n\t\t\tthis.toolbar.current_status = undefined;\n\t\t}\n\n\t\tthis.toolbar.refresh();\n\t}\n\n\tthis.document_flow.refresh();\n\tthis.dashboard.refresh();\n\n\tif(this.meta.is_submittable\n\t\t&& this.perm[0] && this.perm[0].submit\n\t\t&& !this.is_dirty()\n\t\t&& !this.is_new()\n\t\t&& !frappe.model.has_workflow(this.doctype) // show only if no workflow\n\t\t&& this.doc.docstatus===0) {\n\t\tthis.dashboard.add_comment(__('Submit this document to confirm'), 'orange', true);\n\t}\n\n\tthis.clear_custom_buttons();\n\n\tthis.show_web_link();\n};\n\n_f.Frm.prototype.show_web_link = function() {\n\tvar doc = this.doc, me = this;\n\tif(!doc.__islocal && doc.__onload && doc.__onload.is_website_generator) {\n\t\tme.web_link && me.web_link.remove();\n\t\tif(doc.__onload.published) {\n\t\t\tme.add_web_link(\"/\" + doc.route);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.add_web_link = function(path, label) {\n\tlabel = label || \"See on Website\";\n\tthis.web_link = this.sidebar.add_user_action(__(label),\n\t\tfunction() {}).attr(\"href\", path || this.doc.route).attr(\"target\", \"_blank\");\n};\n\n_f.Frm.prototype.check_doc_perm = function() {\n\t// get perm\n\tvar dt = this.parent_doctype?this.parent_doctype : this.doctype;\n\tthis.perm = frappe.perm.get_perm(dt, this.doc);\n\n\tif(!this.perm[0].read) {\n\t\treturn 0;\n\t}\n\treturn 1;\n};\n\n_f.Frm.prototype.refresh = function(docname) {\n\tvar is_a_different_doc = docname ? true : false;\n\n\tif(docname) {\n\t\t// record switch\n\t\tif(this.docname != docname && (!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\t\tfrappe.utils.scroll_to(0);\n\t\t\tthis.hide_print();\n\t\t}\n\t\t// reset visible columns, since column headings can change in different docs\n\t\tthis.grids.forEach(grid_obj => grid_obj.grid.visible_columns = null);\n\t\tfrappe.ui.form.close_grid_form();\n\t\tthis.docname = docname;\n\t}\n\n\tcur_frm = this;\n\n\tif(this.docname) { // document to show\n\n\t\t// set the doc\n\t\tthis.doc = frappe.get_doc(this.doctype, this.docname);\n\n\t\t// check permissions\n\t\tif(!this.check_doc_perm()) {\n\t\t\tfrappe.show_not_permitted(__(this.doctype) + \" \" + __(this.docname));\n\t\t\treturn;\n\t\t}\n\n\t\t// read only (workflow)\n\t\tthis.read_only = frappe.workflow.is_read_only(this.doctype, this.docname);\n\t\tif (this.read_only) this.set_read_only(true);\n\n\t\t// check if doctype is already open\n\t\tif (!this.opendocs[this.docname]) {\n\t\t\tthis.check_doctype_conflict(this.docname);\n\t\t} else {\n\t\t\tif(this.doc && (!this.doc.__unsaved) && this.doc.__last_sync_on &&\n\t\t\t\t(new Date() - this.doc.__last_sync_on) > (this.refresh_if_stale_for * 1000)) {\n\t\t\t\tthis.reload_doc();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// do setup\n\t\tif(!this.setup_done) {\n\t\t\tthis.setup();\n\t\t}\n\n\t\t// load the record for the first time, if not loaded (call 'onload')\n\t\tthis.cscript.is_onload = false;\n\t\tif(!this.opendocs[this.docname]) {\n\t\t\tvar me = this;\n\t\t\tthis.cscript.is_onload = true;\n\t\t\tthis.setnewdoc();\n\t\t\t$(document).trigger(\"form-load\", [this]);\n\t\t\t$(this.page.wrapper).on('hide',  function() {\n\t\t\t\t$(document).trigger(\"form-unload\", [me]);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.render_form(is_a_different_doc);\n\t\t\tif (this.doc.localname) {\n\t\t\t\t// trigger form-rename and remove .localname\n\t\t\t\tdelete this.doc.localname;\n\t\t\t\t$(document).trigger(\"form-rename\", [this]);\n\t\t\t}\n\t\t}\n\n\t\t// if print format is shown, refresh the format\n\t\tif(this.print_preview.wrapper.is(\":visible\")) {\n\t\t\tthis.print_preview.preview();\n\t\t}\n\n\t\tif(is_a_different_doc) {\n\t\t\tif(this.show_print_first && this.doc.docstatus===1) {\n\t\t\t\t// show print view\n\t\t\t\tthis.print_doc();\n\t\t\t}\n\t\t}\n\n\t\t// set status classes\n\t\tthis.$wrapper.removeClass('validated-form')\n\t\t\t.toggleClass('editable-form', this.doc.docstatus===0)\n\t\t\t.toggleClass('submitted-form', this.doc.docstatus===1)\n\t\t\t.toggleClass('cancelled-form', this.doc.docstatus===2);\n\n\t\tthis.show_if_needs_refresh();\n\t}\n};\n\n_f.Frm.prototype.show_if_needs_refresh = function() {\n\tif(this.doc.__needs_refresh) {\n\t\tif(this.doc.__unsaved) {\n\t\t\tthis.dashboard.clear_headline();\n\t\t\tthis.dashboard.set_headline_alert(__(\"This form has been modified after you have loaded it\")\n\t\t\t\t+ '<a class=\"btn btn-xs btn-primary pull-right\" onclick=\"cur_frm.reload_doc()\">'\n\t\t\t\t+ __(\"Refresh\") + '</a>', \"alert-warning\");\n\t\t} else {\n\t\t\tthis.reload_doc();\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.render_form = function(is_a_different_doc) {\n\tif(!this.meta.istable) {\n\t\tthis.layout.doc = this.doc;\n\t\tthis.layout.attach_doc_and_docfields();\n\n\t\tthis.sidebar = new frappe.ui.form.Sidebar({\n\t\t\tfrm: this,\n\t\t\tpage: this.page\n\t\t});\n\t\tthis.sidebar.make();\n\n\t\t// clear layout message\n\t\tthis.layout.show_message();\n\n\t\tfrappe.run_serially([\n\t\t\t// header must be refreshed before client methods\n\t\t\t// because add_custom_button\n\t\t\t() => this.refresh_header(is_a_different_doc),\n\t\t\t// trigger global trigger\n\t\t\t// to use this\n\t\t\t() => $(document).trigger('form-refresh', [this]),\n\t\t\t// fields\n\t\t\t() => this.refresh_fields(),\n\t\t\t// call trigger\n\t\t\t() => this.script_manager.trigger(\"refresh\"),\n\t\t\t// call onload post render for callbacks to be fired\n\t\t\t() => {\n\t\t\t\tif(this.cscript.is_onload) {\n\t\t\t\t\treturn this.script_manager.trigger(\"onload_post_render\");\n\t\t\t\t}\n\t\t\t},\n\t\t\t() => this.dashboard.after_refresh()\n\t\t]);\n\t\t// focus on first input\n\n\t\tif(this.is_new()) {\n\t\t\tvar first = this.form_wrapper.find('.form-layout input:first');\n\t\t\tif(!in_list([\"Date\", \"Datetime\"], first.attr(\"data-fieldtype\"))) {\n\t\t\t\tfirst.focus();\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthis.refresh_header(is_a_different_doc);\n\t}\n\n\tthis.$wrapper.trigger('render_complete');\n\n\tif(!this.hidden) {\n\t\tthis.layout.show_empty_form_message();\n\t}\n\n\tthis.scroll_to_element();\n};\n\n_f.Frm.prototype.refresh_field = function(fname) {\n\tif(this.fields_dict[fname] && this.fields_dict[fname].refresh) {\n\t\tthis.fields_dict[fname].refresh();\n\t\tthis.layout.refresh_dependency();\n\t}\n};\n\n_f.Frm.prototype.refresh_fields = function() {\n\tthis.layout.refresh(this.doc);\n\tthis.layout.primary_button = this.$wrapper.find(\".btn-primary\");\n\n\t// cleanup activities after refresh\n\tthis.cleanup_refresh(this);\n};\n\n\n_f.Frm.prototype.cleanup_refresh = function() {\n\tvar me = this;\n\tif(me.fields_dict['amended_from']) {\n\t\tif (me.doc.amended_from) {\n\t\t\tunhide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) unhide_field('amendment_date');\n\t\t} else {\n\t\t\thide_field('amended_from');\n\t\t\tif (me.fields_dict['amendment_date']) hide_field('amendment_date');\n\t\t}\n\t}\n\n\tif(me.fields_dict['trash_reason']) {\n\t\tif(me.doc.trash_reason && me.doc.docstatus == 2) {\n\t\t\tunhide_field('trash_reason');\n\t\t} else {\n\t\t\thide_field('trash_reason');\n\t\t}\n\t}\n\n\tif(me.meta.autoname && me.meta.autoname.substr(0,6)=='field:' && !me.doc.__islocal) {\n\t\tvar fn = me.meta.autoname.substr(6);\n\n\t\tif (me.doc[fn]) {\n\t\t\tme.toggle_display(fn, false);\n\t\t}\n\t}\n\n\tif(me.meta.autoname==\"naming_series:\" && !me.doc.__islocal) {\n\t\tme.toggle_display(\"naming_series\", false);\n\t}\n};\n\n_f.Frm.prototype.setnewdoc = function() {\n\t// moved this call to refresh function\n\t// this.check_doctype_conflict(docname);\n\tvar me = this;\n\n\t// hide any open grid\n\tthis.script_manager.trigger(\"before_load\", this.doctype, this.docname)\n\t\t.then(() => {\n\t\t\tme.script_manager.trigger(\"onload\");\n\t\t\tme.opendocs[me.docname] = true;\n\t\t\tme.render_form();\n\n\t\t\tfrappe.after_ajax(function() {\n\t\t\t\tme.trigger_link_fields();\n\t\t\t});\n\n\t\t\tfrappe.breadcrumbs.add(me.meta.module, me.doctype);\n\t\t});\n\n\t// update seen\n\tif(this.meta.track_seen) {\n\t\t$('.list-id[data-name=\"'+ me.docname +'\"]').addClass('seen');\n\t}\n};\n\n_f.Frm.prototype.trigger_link_fields = function() {\n\t// trigger link fields which have default values set\n\tif (this.is_new() && this.doc.__run_link_triggers) {\n\t\t$.each(this.fields_dict, function(fieldname, field) {\n\t\t\tif (in_list(['Link', 'Dynamic Link'], field.df.fieldtype) && this.doc[fieldname]) {\n\t\t\t\t// triggers add fetch, sets value in model and runs triggers\n\t\t\t\tfield.set_value(this.doc[fieldname]);\n\t\t\t}\n\t\t});\n\n\t\tdelete this.doc.__run_link_triggers;\n\t}\n};\n\n_f.Frm.prototype.runscript = function(scriptname, callingfield, onrefresh) {\n\tvar me = this;\n\tif(this.docname) {\n\t\t// send to run\n\t\tif(callingfield)\n\t\t\t$(callingfield.input).set_working();\n\n\t\tfrappe.call({\n\t\t\tmethod: \"runserverobj\",\n\t\t\targs: {'docs':this.doc, 'method':scriptname },\n\t\t\tbtn: callingfield.$input,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(onrefresh) {\n\t\t\t\t\t\tonrefresh(r);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_fields();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.copy_doc = function(onload, from_amend) {\n\tthis.validate_form_action(\"Create\");\n\tvar newdoc = frappe.model.copy_doc(this.doc, from_amend);\n\n\tnewdoc.idx = null;\n\tnewdoc.__run_link_triggers = false;\n\tif(onload) {\n\t\tonload(newdoc);\n\t}\n\tfrappe.set_route('Form', newdoc.doctype, newdoc.name);\n};\n\n_f.Frm.prototype.reload_doc = function() {\n\tthis.check_doctype_conflict(this.docname);\n\n\tvar me = this;\n\n\tif(!me.doc.__islocal) {\n\t\tfrappe.model.remove_from_locals(me.doctype, me.docname);\n\t\tfrappe.model.with_doc(me.doctype, me.docname, function() {\n\t\t\tme.refresh();\n\t\t});\n\t}\n};\n\nfrappe.validated = 0;\n// Proxy for frappe.validated\nObject.defineProperty(window, 'validated', {\n\tget: function() {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\treturn frappe.validated;\n\t},\n\tset: function(value) {\n\t\tconsole.warn('Please use `frappe.validated` instead of `validated`. It will be deprecated soon.');\n\t\tfrappe.validated = value;\n\t\treturn frappe.validated;\n\t}\n});\n\n_f.Frm.prototype.save = function(save_action, callback, btn, on_error) {\n\tlet me = this;\n\treturn new Promise((resolve, reject) => {\n\t\tbtn && $(btn).prop(\"disabled\", true);\n\t\t$(document.activeElement).blur();\n\n\t\tfrappe.ui.form.close_grid_form();\n\t\t// let any pending js process finish\n\t\tsetTimeout(function() {\n\t\t\tme._save(save_action, callback, btn, on_error, resolve, reject);\n\t\t}, 100);\n\t}).then(() => {\n\t\tme.show_success_action();\n\t}).catch((e) => {\n\t\tconsole.error(e);\n\t});\n};\n\n_f.Frm.prototype._save = function(save_action, callback, btn, on_error, resolve, reject) {\n\tvar me = this;\n\tif(!save_action) save_action = \"Save\";\n\tthis.validate_form_action(save_action, resolve);\n\n\tif((!this.meta.in_dialog || this.in_form) && !this.meta.istable) {\n\t\tfrappe.utils.scroll_to(0);\n\t}\n\tvar after_save = function(r) {\n\t\tif(!r.exc) {\n\t\t\tif ([\"Save\", \"Update\", \"Amend\"].indexOf(save_action)!==-1) {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t}\n\n\t\t\tme.script_manager.trigger(\"after_save\");\n\t\t\tme.refresh();\n\t\t} else {\n\t\t\tif(on_error) {\n\t\t\t\ton_error();\n\t\t\t\treject();\n\t\t\t}\n\t\t}\n\t\tcallback && callback(r);\n\t\tresolve();\n\t};\n\n\tvar fail = () => {\n\t\tbtn && $(btn).prop(\"disabled\", false);\n\t\tif(on_error) {\n\t\t\ton_error();\n\t\t\treject();\n\t\t}\n\t};\n\n\tif(save_action != \"Update\") {\n\t\t// validate\n\t\tfrappe.validated = true;\n\t\tfrappe.run_serially([\n\t\t\t() => this.script_manager.trigger(\"validate\"),\n\t\t\t() => this.script_manager.trigger(\"before_save\"),\n\t\t\t() => {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\tfail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t\t\t}\n\t\t]).catch(fail);\n\t} else {\n\t\tfrappe.ui.form.save(me, save_action, after_save, btn);\n\t}\n};\n\n\n_f.Frm.prototype.savesubmit = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\treturn new Promise(resolve => {\n\t\tthis.validate_form_action(\"Submit\");\n\t\tfrappe.confirm(__(\"Permanently Submit {0}?\", [this.docname]), function() {\n\t\t\tfrappe.validated = true;\n\t\t\tme.script_manager.trigger(\"before_submit\").then(function() {\n\t\t\t\tif(!frappe.validated) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tme.save('Submit', function(r) {\n\t\t\t\t\tif(r.exc) {\n\t\t\t\t\t\thandle_fail();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tcallback && callback();\n\t\t\t\t\t\tme.script_manager.trigger(\"on_submit\")\n\t\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t\t}\n\t\t\t\t}, btn, () => handle_fail(), resolve);\n\t\t\t});\n\t\t}, () => handle_fail() );\n\t});\n};\n\n_f.Frm.prototype.savecancel = function(btn, callback, on_error) {\n\tvar me = this;\n\n\tlet handle_fail = () => {\n\t\t$(btn).prop('disabled', false);\n\t\tif (on_error) {\n\t\t\ton_error();\n\t\t}\n\t};\n\n\tthis.validate_form_action('Cancel');\n\tfrappe.confirm(__(\"Permanently Cancel {0}?\", [this.docname]), function() {\n\t\tfrappe.validated = true;\n\t\tme.script_manager.trigger(\"before_cancel\").then(function() {\n\t\t\tif(!frappe.validated) {\n\t\t\t\thandle_fail();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar after_cancel = function(r) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\thandle_fail();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\t\t\tme.refresh();\n\t\t\t\t\tcallback && callback();\n\t\t\t\t\tme.script_manager.trigger(\"after_cancel\");\n\t\t\t\t}\n\t\t\t};\n\t\t\tfrappe.ui.form.save(me, \"cancel\", after_cancel, btn);\n\t\t});\n\t}, () => handle_fail());\n};\n\n// delete the record\n_f.Frm.prototype.savetrash = function() {\n\tthis.validate_form_action(\"Delete\");\n\tfrappe.model.delete_doc(this.doctype, this.docname, function() {\n\t\twindow.history.back();\n\t});\n};\n\n_f.Frm.prototype.amend_doc = function() {\n\tif(!this.fields_dict['amended_from']) {\n\t\talert('\"amended_from\" field must be present to do an amendment.');\n\t\treturn;\n\t}\n\tthis.validate_form_action(\"Amend\");\n\tvar me = this;\n\tvar fn = function(newdoc) {\n\t\tnewdoc.amended_from = me.docname;\n\t\tif(me.fields_dict && me.fields_dict['amendment_date'])\n\t\t\tnewdoc.amendment_date = frappe.datetime.obj_to_str(new Date());\n\t};\n\tthis.copy_doc(fn, 1);\n\tfrappe.utils.play_sound(\"click\");\n};\n\n_f.Frm.prototype.disable_save = function() {\n\t// IMPORTANT: this function should be called in refresh event\n\tthis.save_disabled = true;\n\tthis.toolbar.current_status = null;\n\tthis.page.clear_primary_action();\n};\n\n_f.Frm.prototype.enable_save = function() {\n\tthis.save_disabled = false;\n\tthis.toolbar.set_primary_action();\n};\n\n_f.Frm.prototype.save_or_update = function() {\n\tif(this.save_disabled) return;\n\n\tif(this.doc.docstatus===0) {\n\t\tthis.save();\n\t} else if(this.doc.docstatus===1 && this.doc.__unsaved) {\n\t\tthis.save(\"Update\");\n\t}\n};\n\n_f.Frm.prototype.dirty = function() {\n\tthis.doc.__unsaved = 1;\n\tthis.$wrapper.trigger('dirty');\n};\n\n_f.Frm.prototype.get_docinfo = function() {\n\treturn frappe.model.docinfo[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.is_dirty = function() {\n\treturn this.doc.__unsaved;\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n\n_f.Frm.prototype.reload_docinfo = function(callback) {\n\tvar me = this;\n\tfrappe.call({\n\t\tmethod: \"frappe.desk.form.load.get_docinfo\",\n\t\targs: {\n\t\t\tdoctype: me.doctype,\n\t\t\tname: me.doc.name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\t// docinfo will be synced\n\t\t\tif(callback) callback(r.docinfo);\n\t\t\tme.timeline.refresh();\n\t\t\tme.assign_to.refresh();\n\t\t\tme.attachments.refresh();\n\t\t}\n\t});\n};\n\n\n_f.Frm.prototype.get_perm = function(permlevel, access_type) {\n\treturn this.perm[permlevel] ? this.perm[permlevel][access_type] : null;\n};\n\n\n_f.Frm.prototype.set_intro = function(txt) {\n\tthis.dashboard.set_headline_alert(txt);\n};\n\n_f.Frm.prototype.set_footnote = function(txt) {\n\tthis.footnote_area = frappe.utils.set_footnote(this.footnote_area, this.body, txt);\n};\n\n\n_f.Frm.prototype.add_custom_button = function(label, fn, group) {\n\t// temp! old parameter used to be icon\n\tif(group && group.indexOf(\"fa fa-\")!==-1) group = null;\n\tvar btn = this.page.add_inner_button(label, fn, group);\n\tif(btn) {\n\t\tthis.custom_buttons[label] = btn;\n\t}\n\treturn btn;\n};\n\n//Remove all custom buttons\n_f.Frm.prototype.clear_custom_buttons = function() {\n\tthis.page.clear_inner_toolbar();\n\tthis.page.clear_user_actions();\n\tthis.custom_buttons = {};\n};\n\n//Remove specific custom button by button Label\n_f.Frm.prototype.remove_custom_button = function(label, group) {\n\tthis.page.remove_inner_button(label, group);\n};\n\n_f.Frm.prototype.add_fetch = function(link_field, src_field, tar_field) {\n\tif(!this.fetch_dict[link_field]) {\n\t\tthis.fetch_dict[link_field] = {'columns':[], 'fields':[]};\n\t}\n\tthis.fetch_dict[link_field].columns.push(src_field);\n\tthis.fetch_dict[link_field].fields.push(tar_field);\n};\n\n_f.Frm.prototype.set_print_heading = function(txt) {\n\tthis.pformat[this.docname] = txt;\n};\n\n_f.Frm.prototype.action_perm_type_map = {\n\t\"Create\": \"create\",\n\t\"Save\": \"write\",\n\t\"Submit\": \"submit\",\n\t\"Update\": \"submit\",\n\t\"Cancel\": \"cancel\",\n\t\"Amend\": \"amend\",\n\t\"Delete\": \"delete\"\n};\n\n_f.Frm.prototype.validate_form_action = function(action, resolve) {\n\tvar perm_to_check = this.action_perm_type_map[action];\n\tvar allowed_for_workflow = false;\n\tvar perms = frappe.perm.get_perm(this.doc.doctype)[0];\n\n\t// Allow submit, write, cancel and create permissions for read only documents that are assigned by\n\t// workflows if the user already have those permissions. This is to allow for users to\n\t// continue through the workflow states and to allow execution of functions like Duplicate.\n\tif ((frappe.workflow.is_read_only(this.doctype, this.docname) && (perms[\"write\"] ||\n\t\tperms[\"create\"] || perms[\"submit\"] || perms[\"cancel\"])) || !frappe.workflow.is_read_only(this.doctype, this.docname)) {\n\t\tallowed_for_workflow = true;\n\t}\n\n\tif (!this.perm[0][perm_to_check] && !allowed_for_workflow) {\n\t\tif(resolve) {\n\t\t\t// re-enable buttons\n\t\t\tresolve();\n\t\t}\n\t\tfrappe.throw (__(\"No permission to '{0}' {1}\", [__(action), __(this.doc.doctype)]));\n\t}\n};\n\n_f.Frm.prototype.has_perm = function(ptype) {\n\treturn frappe.perm.has_perm(this.doctype, 0, ptype, this.doc);\n};\n\n_f.Frm.prototype.scroll_to_element = function() {\n\tif (frappe.route_options && frappe.route_options.scroll_to) {\n\t\tvar scroll_to = frappe.route_options.scroll_to;\n\t\tdelete frappe.route_options.scroll_to;\n\n\t\tvar selector = [];\n\t\tfor (var key in scroll_to) {\n\t\t\tvar value = scroll_to[key];\n\t\t\tselector.push(repl('[data-%(key)s=\"%(value)s\"]', {key: key, value: value}));\n\t\t}\n\n\t\tselector = $(selector.join(\" \"));\n\t\tif (selector.length) {\n\t\t\tfrappe.utils.scroll_to(selector);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.show_success_action = function() {\n\tconst route = frappe.get_route();\n\tif (route[0] !== 'Form') return;\n\tif (this.meta.is_submittable && this.doc.docstatus !== 1) return;\n\n\tconst success_action = new frappe.ui.form.SuccessAction(this);\n\tsuccess_action.show();\n};\n\n_f.Frm.prototype.is_first_creation = function() {\n\tlet { modified, creation } = this.doc;\n\n\t// strip out milliseconds\n\tmodified = modified.split('.')[0];\n\tcreation = creation.split('.')[0];\n\n\treturn modified === creation;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n/* eslint-disable no-console */\n\nwindow.get_server_fields = function(method, arg, table_field, doc, dt, dn, allow_edit, call_back) {\n\tconsole.warn(\"This function 'get_server_fields' has been deprecated and will be removed soon.\");\n\tfrappe.dom.freeze();\n\tif($.isPlainObject(arg)) arg = JSON.stringify(arg);\n\treturn $c('runserverobj', {'method': method, 'docs': JSON.stringify(doc), 'arg': arg },\n\t\tfunction(r) {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\tif (r.message)  {\n\t\t\t\tvar d = locals[dt][dn];\n\t\t\t\tvar field_dict = r.message;\n\t\t\t\tfor(var key in field_dict) {\n\t\t\t\t\td[key] = field_dict[key];\n\t\t\t\t\tif (table_field)\n\t\t\t\t\t\trefresh_field(key, d.name, table_field);\n\t\t\t\t\telse\n\t\t\t\t\t\trefresh_field(key);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(call_back){\n\t\t\t\tdoc = locals[doc.doctype][doc.name];\n\t\t\t\tcall_back(doc, dt, dn);\n\t\t\t}\n\t\t});\n};\n\n\nwindow.set_multiple = function(dt, dn, dict, table_field) {\n\tvar d = locals[dt][dn];\n\tfor(var key in dict) {\n\t\td[key] = dict[key];\n\t\tif (table_field)\n\t\t\trefresh_field(key, d.name, table_field);\n\t\telse\n\t\t\trefresh_field(key);\n\t}\n};\n\nwindow.refresh_many = function(flist, dn, table_field) {\n\tfor(var i in flist) {\n\t\tif (table_field)\n\t\t\trefresh_field(flist[i], dn, table_field);\n\t\telse\n\t\t\trefresh_field(flist[i]);\n\t}\n};\n\nwindow.set_field_tip = function(n,txt) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df)df.description = txt;\n\n\tif(cur_frm && cur_frm.fields_dict) {\n\t\tif(cur_frm.fields_dict[n])\n\t\t\tcur_frm.fields_dict[n].comment_area.innerHTML = frappe.utils.replace_newlines(txt);\n\t\telse\n\t\t\tconsole.log('[set_field_tip] Unable to set field tip: ' + n);\n\t}\n};\n\nwindow.refresh_field = function(n, docname, table_field) {\n\t// multiple\n\tif(typeof n==typeof [])\n\t\trefresh_many(n, docname, table_field);\n\n\tif (n && typeof n==='string' && table_field){\n\t\tvar grid = cur_frm.fields_dict[table_field].grid,\n\t\t\tfield = frappe.utils.filter_dict(grid.docfields, {fieldname: n});\n\t\tif (field && field.length){\n\t\t\tfield = field[0];\n\t\t\tvar meta = frappe.meta.get_docfield(field.parent, field.fieldname, docname);\n\t\t\t$.extend(field, meta);\n\t\t\tif (docname){\n\t\t\t\tcur_frm.fields_dict[table_field].grid.grid_rows_by_docname[docname].refresh_field(n);\n\t\t\t} else {\n\t\t\t\tcur_frm.fields_dict[table_field].grid.refresh();\n\t\t\t}\n\t\t}\n\t} else if(cur_frm) {\n\t\tcur_frm.refresh_field(n);\n\t}\n};\n\nwindow.set_field_options = function(n, txt) {\n\tcur_frm.set_df_property(n, 'options', txt);\n};\n\nwindow.set_field_permlevel = function(n, level) {\n\tcur_frm.set_df_property(n, 'permlevel', level);\n};\n\nwindow.toggle_field = function(n, hidden) {\n\tvar df = frappe.meta.get_docfield(cur_frm.doctype, n, cur_frm.docname);\n\tif(df) {\n\t\tdf.hidden = hidden;\n\t\trefresh_field(n);\n\t} else {\n\t\tconsole.log((hidden ? \"hide_field\" : \"unhide_field\") + \" cannot find field \" + n);\n\t}\n};\n\nwindow.hide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 1);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 1);\n\t\t}\n\t}\n};\n\nwindow.unhide_field = function(n) {\n\tif(cur_frm) {\n\t\tif(n.substr) toggle_field(n, 0);\n\t\telse {\n\t\t\tfor(var i in n) toggle_field(n[i], 0);\n\t\t}\n\t}\n};\n\nwindow.get_field_obj = function(fn) {\n\treturn cur_frm.fields_dict[fn];\n};\n\n_f.Frm.prototype.get_doc = function() {\n\treturn locals[this.doctype][this.docname];\n};\n\n_f.Frm.prototype.set_currency_labels = function(fields_list, currency, parentfield) {\n\t// To set the currency in the label\n\t// For example Total Cost(INR), Total Cost(USD)\n\n\tvar me = this;\n\tvar doctype = parentfield ? this.fields_dict[parentfield].grid.doctype : this.doc.doctype;\n\tvar field_label_map = {};\n\tvar grid_field_label_map = {};\n\n\t$.each(fields_list, function(i, fname) {\n\t\tvar docfield = frappe.meta.docfield_map[doctype][fname];\n\t\tif(docfield) {\n\t\t\tvar label = __(docfield.label || \"\").replace(/\\([^\\)]*\\)/g, \"\"); // eslint-disable-line\n\t\t\tif(parentfield) {\n\t\t\t\tgrid_field_label_map[doctype + \"-\" + fname] =\n\t\t\t\t\tlabel.trim() + \" (\" + __(currency) + \")\";\n\t\t\t} else {\n\t\t\t\tfield_label_map[fname] = label.trim() + \" (\" + currency + \")\";\n\t\t\t}\n\t\t}\n\t});\n\n\t$.each(field_label_map, function(fname, label) {\n\t\tme.fields_dict[fname].set_label(label);\n\t});\n\n\t$.each(grid_field_label_map, function(fname, label) {\n\t\tfname = fname.split(\"-\");\n\t\tvar df = frappe.meta.get_docfield(fname[0], fname[1], me.doc.name);\n\t\tif(df) df.label = label;\n\t});\n};\n\n_f.Frm.prototype.field_map = function(fnames, fn) {\n\tif(typeof fnames==='string') {\n\t\tif(fnames == '*') {\n\t\t\tfnames = Object.keys(this.fields_dict);\n\t\t} else {\n\t\t\tfnames = [fnames];\n\t\t}\n\t}\n\tfor (var i=0, l=fnames.length; i<l; i++) {\n\t\tvar fieldname = fnames[i];\n\t\tvar field = frappe.meta.get_docfield(cur_frm.doctype, fieldname, this.docname);\n\t\tif(field) {\n\t\t\tfn(field);\n\t\t\tthis.refresh_field(fieldname);\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.get_docfield = function(fieldname1, fieldname2) {\n\tif(fieldname2) {\n\t\t// for child\n\t\tvar doctype = this.get_docfield(fieldname1).options;\n\t\treturn frappe.meta.get_docfield(doctype, fieldname2, this.docname);\n\t} else {\n\t\t// for parent\n\t\treturn frappe.meta.get_docfield(this.doctype, fieldname1, this.docname);\n\t}\n};\n\n_f.Frm.prototype.set_df_property = function(fieldname, property, value, docname, table_field) {\n\tvar df;\n\tif (!docname && !table_field){\n\t\tdf = this.get_docfield(fieldname);\n\t} else {\n\t\tvar grid = this.fields_dict[table_field].grid,\n\t\t\tfname = frappe.utils.filter_dict(grid.docfields, {'fieldname': fieldname});\n\t\tif (fname && fname.length)\n\t\t\tdf = frappe.meta.get_docfield(fname[0].parent, fieldname, docname);\n\t}\n\tif(df && df[property] != value) {\n\t\tdf[property] = value;\n\t\trefresh_field(fieldname, table_field);\n\t}\n};\n\n_f.Frm.prototype.toggle_enable = function(fnames, enable) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.read_only = enable ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.toggle_reqd = function(fnames, mandatory) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.reqd = mandatory ? true : false;\n\t});\n};\n\n_f.Frm.prototype.toggle_display = function(fnames, show) {\n\tthis.field_map(fnames, function(field) {\n\t\tfield.hidden = show ? 0 : 1;\n\t});\n};\n\n_f.Frm.prototype.call_server = function(method, args, callback) {\n\treturn $c_obj(this.doc, method, args, callback);\n};\n\n_f.Frm.prototype.get_files = function() {\n\treturn this.attachments\n\t\t? frappe.utils.sort(this.attachments.get_attachments(), \"file_name\", \"string\")\n\t\t: [] ;\n};\n\n_f.Frm.prototype.set_query = function(fieldname, opt1, opt2) {\n\tif(opt2) {\n\t\t// on child table\n\t\t// set_query(fieldname, parent fieldname, query)\n\t\tthis.fields_dict[opt1].grid.get_field(fieldname).get_query = opt2;\n\t} else {\n\t\t// on parent table\n\t\t// set_query(fieldname, query)\n\t\tif(this.fields_dict[fieldname]) {\n\t\t\tthis.fields_dict[fieldname].get_query = opt1;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.set_value_if_missing = function(field, value) {\n\treturn this.set_value(field, value, true);\n};\n\n_f.Frm.prototype.clear_table = function(fieldname) {\n\tfrappe.model.clear_table(this.doc, fieldname);\n};\n\n_f.Frm.prototype.add_child = function(fieldname, values) {\n\tvar doc = frappe.model.add_child(this.doc, frappe.meta.get_docfield(this.doctype, fieldname).options, fieldname);\n\tif(values) {\n\t\t// Values of unique keys should not be overridden\n\t\tvar d = {};\n\t\tvar unique_keys = [\"idx\", \"name\"];\n\n\t\tObject.keys(values).map((key) => {\n\t\t\tif(!unique_keys.includes(key)) {\n\t\t\t\td[key] = values[key];\n\t\t\t}\n\t\t});\n\n\t\t$.extend(doc, d);\n\t}\n\treturn doc;\n};\n\n_f.Frm.prototype.set_value = function(field, value, if_missing) {\n\tvar me = this;\n\tvar _set = function(f, v) {\n\t\tvar fieldobj = me.fields_dict[f];\n\t\tif(fieldobj) {\n\t\t\tif(!if_missing || !frappe.model.has_value(me.doctype, me.doc.name, f)) {\n\t\t\t\tif(fieldobj.df.fieldtype===\"Table\" && $.isArray(v)) {\n\n\t\t\t\t\tfrappe.model.clear_table(me.doc, fieldobj.df.fieldname);\n\n\t\t\t\t\tfor (var i=0, j=v.length; i < j; i++) {\n\t\t\t\t\t\tvar d = v[i];\n\t\t\t\t\t\tvar child = frappe.model.add_child(me.doc, fieldobj.df.options,\n\t\t\t\t\t\t\tfieldobj.df.fieldname, i+1);\n\t\t\t\t\t\t$.extend(child, d);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.refresh_field(f);\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t} else {\n\t\t\t\t\treturn frappe.model.set_value(me.doctype, me.doc.name, f, v);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfrappe.msgprint(__(\"Field {0} not found.\",[f]));\n\t\t\tthrow \"frm.set_value\";\n\t\t}\n\t};\n\n\tif(typeof field==\"string\") {\n\t\treturn _set(field, value);\n\t} else if($.isPlainObject(field)) {\n\t\tlet tasks = [];\n\t\tfor (let f in field) {\n\t\t\tlet v = field[f];\n\t\t\tif(me.get_field(f)) {\n\t\t\t\ttasks.push(() => _set(f, v));\n\t\t\t}\n\t\t}\n\t\treturn frappe.run_serially(tasks);\n\t}\n};\n\n_f.Frm.prototype.call = function(opts, args, callback) {\n\tvar me = this;\n\tif(typeof opts==='string') {\n\t\t// called as frm.call('do_this', {with_arg: 'arg'});\n\t\topts = {\n\t\t\tmethod: opts,\n\t\t\tdoc: this.doc,\n\t\t\targs: args,\n\t\t\tcallback: callback\n\t\t};\n\t}\n\tif(!opts.doc) {\n\t\tif(opts.method.indexOf(\".\")===-1)\n\t\t\topts.method = frappe.model.get_server_module_name(me.doctype) + \".\" + opts.method;\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif($.isPlainObject(r.message)) {\n\t\t\t\tif(opts.child) {\n\t\t\t\t\t// update child doc\n\t\t\t\t\topts.child = locals[opts.child.doctype][opts.child.name];\n\n\t\t\t\t\tvar std_field_list = [\"doctype\"].concat(frappe.model.std_fields_list);\n\t\t\t\t\tfor (var key in r.message) {\n\t\t\t\t\t\tif (std_field_list.indexOf(key)===-1) {\n\t\t\t\t\t\t\topts.child[key] = r.message[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tme.fields_dict[opts.child.parentfield].refresh();\n\t\t\t\t} else {\n\t\t\t\t\t// update parent doc\n\t\t\t\t\tme.set_value(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\t} else {\n\t\topts.original_callback = opts.callback;\n\t\topts.callback = function(r) {\n\t\t\tif(!r.exc) me.refresh_fields();\n\n\t\t\topts.original_callback && opts.original_callback(r);\n\t\t};\n\n\t}\n\treturn frappe.call(opts);\n};\n\n_f.Frm.prototype.get_field = function(field) {\n\treturn this.fields_dict[field];\n};\n\n\n_f.Frm.prototype.set_read_only = function() {\n\tvar perm = [];\n\tvar docperms = frappe.perm.get_perm(this.doc.doctype);\n\tfor (var i=0, l=docperms.length; i<l; i++) {\n\t\tvar p = docperms[i];\n\t\tperm[p.permlevel || 0] = {read:1, print:1, cancel:1};\n\t}\n\tthis.perm = perm;\n};\n\n_f.Frm.prototype.trigger = function(event) {\n\treturn this.script_manager.trigger(event);\n};\n\n_f.Frm.prototype.get_formatted = function(fieldname) {\n\treturn frappe.format(this.doc[fieldname],\n\t\tfrappe.meta.get_docfield(this.doctype, fieldname, this.docname),\n\t\t{no_icon:true}, this.doc);\n};\n\n_f.Frm.prototype.open_grid_row = function() {\n\treturn frappe.ui.form.get_open_grid_form();\n};\n\n_f.Frm.prototype.is_new = function() {\n\treturn this.doc.__islocal;\n};\n\n_f.Frm.prototype.get_title = function() {\n\tif(this.meta.title_field) {\n\t\treturn this.doc[this.meta.title_field];\n\t} else {\n\t\treturn this.doc.name;\n\t}\n};\n\n_f.Frm.prototype.get_selected = function() {\n\t// returns list of children that are selected. returns [parentfield, name] for each\n\tvar selected = {}, me = this;\n\tfrappe.meta.get_table_fields(this.doctype).forEach(function(df) {\n\t\tvar _selected = me.fields_dict[df.fieldname].grid.get_selected();\n\t\tif(_selected.length) {\n\t\t\tselected[df.fieldname] = _selected;\n\t\t}\n\t});\n\treturn selected;\n};\n\n_f.Frm.prototype.has_mapper = function() {\n\t// hackalert!\n\t// if open_mapped_doc is mentioned in the custom script, then mapper exists\n\tif(this._has_mapper === undefined) {\n\t\tthis._has_mapper = (this.meta.__js && this.meta.__js.search('open_mapped_doc')!==-1) ?\n\t\t\ttrue: false;\n\t}\n\treturn this._has_mapper;\n};\n\n_f.Frm.prototype.set_indicator_formatter = function(fieldname, get_color, get_text) {\n\t// get doctype from parent\n\tvar doctype;\n\tif(frappe.meta.docfield_map[this.doctype][fieldname]) {\n\t\tdoctype = this.doctype;\n\t} else {\n\t\tfrappe.meta.get_table_fields(this.doctype).every(function(df) {\n\t\t\tif(frappe.meta.docfield_map[df.options][fieldname]) {\n\t\t\t\tdoctype = df.options;\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t}\n\n\tfrappe.meta.docfield_map[doctype][fieldname].formatter =\n\t\tfunction(value, df, options, doc) {\n\t\t\tif(value) {\n\t\t\t\tvar label;\n\t\t\t\tif(get_text) {\n\t\t\t\t\tlabel = get_text(doc);\n\t\t\t\t} else if(frappe.form.link_formatters[df.options]) {\n\t\t\t\t\tlabel = frappe.form.link_formatters[df.options](value, doc);\n\t\t\t\t} else {\n\t\t\t\t\tlabel = value;\n\t\t\t\t}\n\n\t\t\t\tconst escaped_name = encodeURIComponent(value);\n\t\t\t\treturn repl('<a class=\"indicator %(color)s\" href=\"#Form/%(doctype)s/%(name)s\">%(label)s</a>', {\n\t\t\t\t\tcolor: get_color(doc || {}),\n\t\t\t\t\tdoctype: df.options,\n\t\t\t\t\tname: escaped_name,\n\t\t\t\t\tlabel: label\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t};\n};\n\n_f.Frm.prototype.can_create = function(doctype) {\n\t// return true or false if the user can make a particlar doctype\n\t// will check permission, `can_make_methods` if exists, or will decided on\n\t// basis of whether the document is submittable\n\tif(!frappe.model.can_create(doctype)) {\n\t\treturn false;\n\t}\n\n\tif(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\t// custom buttons are translated and so are the keys\n\t\tconst key = __(this.custom_make_buttons[doctype]);\n\t\t// if the button is present, then show make\n\t\treturn !!this.custom_buttons[key];\n\t}\n\n\tif(this.can_make_methods && this.can_make_methods[doctype]) {\n\t\treturn this.can_make_methods[doctype](this);\n\t} else {\n\t\tif(this.meta.is_submittable && !this.doc.docstatus==1) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t}\n};\n\n_f.Frm.prototype.make_new = function(doctype) {\n\t// make new doctype from the current form\n\t// will handover to `make_methods` if defined\n\t// or will create and match link fields\n\tvar me = this;\n\tif(this.make_methods && this.make_methods[doctype]) {\n\t\treturn this.make_methods[doctype](this);\n\t} else if(this.custom_make_buttons && this.custom_make_buttons[doctype]) {\n\t\tthis.custom_buttons[__(this.custom_make_buttons[doctype])].trigger('click');\n\t} else {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\n\t\t\t// set link fields (if found)\n\t\t\tfrappe.get_meta(doctype).fields.forEach(function(df) {\n\t\t\t\tif(df.fieldtype==='Link' && df.options===me.doctype) {\n\t\t\t\t\tnew_doc[df.fieldname] = me.doc.name;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t\t// frappe.set_route('Form', doctype, new_doc.name);\n\t\t});\n\t}\n};\n\n_f.Frm.prototype.update_in_all_rows = function(table_fieldname, fieldname, value) {\n\t// update the child value in all tables where it is missing\n\tif(!value) return;\n\tvar cl = this.doc[table_fieldname] || [];\n\tfor(var i = 0; i < cl.length; i++){\n\t\tif(!cl[i][fieldname]) cl[i][fieldname] = value;\n\t}\n\trefresh_field(\"items\");\n};\n\n_f.Frm.prototype.get_sum = function(table_fieldname, fieldname) {\n\tlet sum = 0;\n\tfor (let d of (this.doc[table_fieldname] || [])) {\n\t\tsum += d[fieldname];\n\t}\n\treturn sum;\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Toolbar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.refresh();\n\t\tthis.add_update_button_on_dirty();\n\t\tthis.setup_editable_title();\n\t},\n\trefresh: function() {\n\t\tthis.make_menu();\n\t\tthis.set_title();\n\t\tthis.page.clear_user_actions();\n\t\tthis.show_title_as_dirty();\n\t\tthis.set_primary_action();\n\n\t\tif(this.frm.meta.hide_toolbar) {\n\t\t\tthis.page.hide_menu();\n\t\t} else {\n\t\t\tif(this.frm.doc.__islocal) {\n\t\t\t\tthis.page.hide_menu();\n\t\t\t\tthis.print_icon && this.print_icon.addClass(\"hide\");\n\t\t\t} else {\n\t\t\t\tthis.page.show_menu();\n\t\t\t\tthis.print_icon && this.print_icon.removeClass(\"hide\");\n\t\t\t}\n\t\t}\n\t},\n\tset_title: function() {\n\t\tif(this.frm.meta.title_field) {\n\t\t\tvar title = strip_html((this.frm.doc[this.frm.meta.title_field] || \"\").trim() || this.frm.docname);\n\t\t\tif(this.frm.doc.__islocal || title === this.frm.docname || this.frm.meta.autoname===\"hash\") {\n\t\t\t\tthis.page.set_title_sub(\"\");\n\t\t\t} else {\n\t\t\t\tthis.page.set_title_sub(this.frm.docname);\n\t\t\t}\n\t\t} else {\n\t\t\tvar title = this.frm.docname;\n\t\t}\n\n\t\tvar me = this;\n\t\ttitle = __(title);\n\t\tthis.page.set_title(title);\n\t\tif(this.frm.meta.title_field) {\n\t\t\tfrappe.utils.set_title(title + \" - \" + this.frm.docname);\n\t\t}\n\t\tthis.page.$title_area.toggleClass(\"editable-title\",\n\t\t\t!!(this.is_title_editable() || this.can_rename()));\n\n\t\tthis.set_indicator();\n\t},\n\tis_title_editable: function() {\n\t\tif (this.frm.meta.title_field===\"title\"\n\t\t\t&& this.frm.perm[0].write\n\t\t\t&& !this.frm.get_docfield(\"title\").options\n\t\t\t&& !this.frm.doc.__islocal) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\tcan_rename: function() {\n\t\treturn this.frm.perm[0].write && this.frm.meta.allow_rename && !this.frm.doc.__islocal;\n\t},\n\tsetup_editable_title: function() {\n\t\tvar me = this;\n\t\tthis.page.$title_area.find(\".title-text\").on(\"click\", function() {\n\t\t\tif(me.is_title_editable()) {\n\t\t\t\tfrappe.prompt({fieldname: \"title\", fieldtype:\"Data\",\n\t\t\t\t\tlabel: __(\"Title\"), reqd: 1, \"default\": me.frm.doc.title },\n\t\t\t\t\tfunction(data) {\n\t\t\t\t\t\tif(data.title) {\n\t\t\t\t\t\t\tme.frm.set_value(\"title\", data.title);\n\t\t\t\t\t\t\tif(!me.frm.doc.__islocal) {\n\t\t\t\t\t\t\t\tme.frm.save_or_update();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.set_title();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, __(\"Edit Title\"), __(\"Update\"));\n\t\t\t}\n\t\t\tif(me.can_rename()) {\n\t\t\t\tme.frm.rename_doc();\n\t\t\t}\n\t\t});\n\t},\n\tget_dropdown_menu: function(label) {\n\t\treturn this.page.add_dropdown(label);\n\t},\n\tset_indicator: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tvar indicator = frappe.get_indicator(this.frm.doc);\n\t\tif(indicator) {\n\t\t\tthis.page.set_indicator(indicator[0], indicator[1]);\n\t\t} else {\n\t\t\tthis.page.clear_indicator();\n\t\t}\n\t},\n\tmake_menu: function() {\n\t\tthis.page.clear_icons();\n\t\tthis.page.clear_menu();\n\t\tvar me = this;\n\t\tvar p = this.frm.perm[0];\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar is_submittable = frappe.model.is_submittable(this.frm.doc.doctype)\n\t\tvar issingle = this.frm.meta.issingle;\n\t\tvar print_settings = frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\tvar allow_print_for_draft = cint(print_settings.allow_print_for_draft);\n\t\tvar allow_print_for_cancelled = cint(print_settings.allow_print_for_cancelled);\n\n\t\t// Print\n\t\tif(!is_submittable || docstatus == 1  ||\n\t\t\t(allow_print_for_cancelled && docstatus == 2)||\n\t\t\t(allow_print_for_draft && docstatus == 0)) {\n\t\t\tif(frappe.model.can_print(null, me.frm) && !issingle) {\n\t\t\t\tthis.page.add_menu_item(__(\"Print\"), function() {\n\t\t\t\t\tme.frm.print_doc();}, true);\n\t\t\t\tthis.print_icon = this.page.add_action_icon(\"fa fa-print\", function() {\n\t\t\t\t\tme.frm.print_doc();});\n\t\t\t}\n\t\t}\n\n\t\t// email\n\t\tif(frappe.model.can_email(null, me.frm) && me.frm.doc.docstatus < 2) {\n\t\t\tthis.page.add_menu_item(__(\"Email\"), function() {\n\t\t\t\tme.frm.email_doc();}, true);\n\t\t}\n\n\t\t// Linked With\n\t\tif(!me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Links'), function() {\n\t\t\t\tme.show_linked_with();\n\t\t\t}, true)\n\t\t}\n\n\t\t// copy\n\t\tif(in_list(frappe.boot.user.can_create, me.frm.doctype) && !me.frm.meta.allow_copy) {\n\t\t\tthis.page.add_menu_item(__(\"Duplicate\"), function() {\n\t\t\t\tme.frm.copy_doc();}, true);\n\t\t}\n\n\t\t// rename\n\t\tif(this.can_rename()) {\n\t\t\tthis.page.add_menu_item(__(\"Rename\"), function() {\n\t\t\t\tme.frm.rename_doc();}, true);\n\t\t}\n\n\t\t// reload\n\t\tthis.page.add_menu_item(__(\"Reload\"), function() {\n\t\t\tme.frm.reload_doc();}, true);\n\n\t\t// add to desktop\n\t\tif(me.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__('Add to Desktop'), function () {\n\t\t\t\tfrappe.add_to_desktop(me.frm.doctype, me.frm.doctype);\n\t\t\t}, true);\n\t\t}\n\n\t\t// delete\n\t\tif((cint(me.frm.doc.docstatus) != 1) && !me.frm.doc.__islocal\n\t\t\t&& frappe.model.can_delete(me.frm.doctype)) {\n\t\t\tthis.page.add_menu_item(__(\"Delete\"), function() {\n\t\t\t\tme.frm.savetrash();}, true);\n\t\t}\n\n\t\tif(frappe.user_roles.includes(\"System Manager\") && me.frm.meta.issingle === 0) {\n\t\t\tthis.page.add_menu_item(__(\"Customize\"), function() {\n\t\t\t\tfrappe.set_route(\"Form\", \"Customize Form\", {\n\t\t\t\t\tdoc_type: me.frm.doctype\n\t\t\t\t})\n\t\t\t}, true);\n\n\t\t\tif (frappe.boot.developer_mode===1 && me.frm.meta.issingle) {\n\t\t\t\t// edit doctype\n\t\t\t\tthis.page.add_menu_item(__(\"Edit DocType\"), function() {\n\t\t\t\t\tfrappe.set_route('Form', 'DocType', me.frm.doctype);\n\t\t\t\t}, true);\n\t\t\t}\n\t\t}\n\n\t\t// feedback\n\t\tif(!this.frm.doc.__unsaved) {\n\t\t\tif(is_submittable && docstatus == 1) {\n\t\t\t\tthis.page.add_menu_item(__(\"Request Feedback\"), function() {\n\t\t\t\t\tvar feedback = new frappe.utils.Feedback();\n\t\t\t\t\tfeedback.manual_feedback_request(me.frm.doc);\n\t\t\t\t}, true)\n\t\t\t}\n\t\t}\n\n\t\t// New\n\t\tif(p[CREATE] && !this.frm.meta.issingle) {\n\t\t\tthis.page.add_menu_item(__(\"New {0} (Ctrl+B)\", [__(me.frm.doctype)]), function() {\n\t\t\t\tfrappe.new_doc(me.frm.doctype, true);}, true);\n\t\t}\n\t},\n\tcan_save: function() {\n\t\treturn this.get_docstatus()===0;\n\t},\n\tcan_submit: function() {\n\t\treturn this.get_docstatus()===0\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& !this.frm.doc.__unsaved\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& !this.has_workflow();\n\t},\n\tcan_update: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& !this.frm.doc.__islocal\n\t\t\t&& this.frm.perm[0].submit\n\t\t\t&& this.frm.doc.__unsaved\n\t},\n\tcan_cancel: function() {\n\t\treturn this.get_docstatus()===1\n\t\t\t&& this.frm.perm[0].cancel\n\t\t\t&& !this.read_only;\n\t},\n\tcan_amend: function() {\n\t\treturn this.get_docstatus()===2\n\t\t\t&& this.frm.perm[0].amend\n\t\t\t&& !this.read_only;\n\t},\n\thas_workflow: function() {\n\t\tif(this._has_workflow === undefined)\n\t\t\tthis._has_workflow = frappe.get_list(\"Workflow\", {document_type: this.frm.doctype}).length;\n\t\treturn this._has_workflow;\n\t},\n\tget_docstatus: function() {\n\t\treturn cint(this.frm.doc.docstatus);\n\t},\n\tshow_linked_with: function() {\n\t\tif(!this.frm.linked_with) {\n\t\t\tthis.frm.linked_with = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm\n\t\t\t});\n\t\t}\n\t\tthis.frm.linked_with.show();\n\t},\n\tset_primary_action: function(dirty) {\n\t\tif (!dirty) {\n\t\t\t// don't clear actions menu if dirty\n\t\t\tthis.page.clear_user_actions();\n\t\t}\n\n\t\tvar status = this.get_action_status();\n\t\tif (status) {\n\t\t\tif (status !== this.current_status) {\n\t\t\t\tthis.set_page_actions(status);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.page.clear_actions();\n\t\t\tthis.current_status = null\n\t\t}\n\t},\n\tget_action_status: function() {\n\t\tvar status = null;\n\t\tif (this.frm.page.current_view_name==='print' || this.frm.hidden) {\n\t\t\tstatus = \"Edit\";\n\t\t} else if (this.can_submit()) {\n\t\t\tstatus = \"Submit\";\n\t\t} else if (this.can_save()) {\n\t\t\tif (!this.frm.save_disabled) {\n\t\t\t\t//Show the save button if there is no workflow or if there is a workflow and there are changes\n\t\t\t\tif (this.has_workflow() ? this.frm.doc.__unsaved : true) {\n\t\t\t\t\tstatus = \"Save\";\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (this.can_update()) {\n\t\t\tstatus = \"Update\";\n\t\t} else if (this.can_cancel()) {\n\t\t\tstatus = \"Cancel\";\n\t\t} else if (this.can_amend()) {\n\t\t\tstatus = \"Amend\";\n\t\t}\n\t\treturn status;\n\t},\n\tset_page_actions: function(status) {\n\t\tvar me = this;\n\t\tthis.page.clear_actions();\n\n\t\tif(status!== 'Edit') {\n\t\t\tvar perm_to_check = this.frm.action_perm_type_map[status];\n\t\t\tif(!this.frm.perm[0][perm_to_check]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif(status === \"Edit\") {\n\t\t\tthis.page.set_primary_action(__(\"Edit\"), function() {\n\t\t\t\tme.frm.page.set_view('main');\n\t\t\t}, 'octicon octicon-pencil');\n\t\t} else if(status === \"Cancel\") {\n\t\t\tthis.page.set_secondary_action(__(status), function() {\n\t\t\t\tme.frm.savecancel(this);\n\t\t\t}, \"octicon octicon-circle-slash\");\n\t\t} else {\n\t\t\tvar click = {\n\t\t\t\t\"Save\": function() {\n\t\t\t\t\treturn me.frm.save('Save', null, this);\n\t\t\t\t},\n\t\t\t\t\"Submit\": function() {\n\t\t\t\t\treturn me.frm.savesubmit(this);\n\t\t\t\t},\n\t\t\t\t\"Update\": function() {\n\t\t\t\t\treturn me.frm.save('Update', null, this);\n\t\t\t\t},\n\t\t\t\t\"Amend\": function() {\n\t\t\t\t\treturn me.frm.amend_doc();\n\t\t\t\t}\n\t\t\t}[status];\n\n\t\t\tvar icon = {\n\t\t\t\t\"Save\": \"octicon octicon-check\",\n\t\t\t\t\"Submit\": \"octicon octicon-lock\",\n\t\t\t\t\"Update\": \"octicon octicon-check\",\n\t\t\t\t\"Amend\": \"octicon octicon-split\"\n\t\t\t}[status];\n\n\t\t\tthis.page.set_primary_action(__(status), click, icon);\n\t\t}\n\n\t\tthis.current_status = status;\n\t},\n\tmake_cancel_amend_button: function() {\n\t\tvar me = this;\n\t\tvar docstatus = cint(this.frm.doc.docstatus);\n\t\tvar p = this.frm.perm[0];\n\t\tvar has_workflow = this.has_workflow();\n\n\t\tif(has_workflow) {\n\t\t\treturn;\n\t\t} else if(docstatus==1 && p[CANCEL]) {\n\t\t\tthis.page.set_secondary_action(__('Cancel'), function() {\n\t\t\t\tme.frm.savecancel(this) }, 'fa fa-ban-circle');\n\t\t} else if(docstatus==2 && p[AMEND]) {\n\t\t\tthis.page.set_secondary_action(__('Amend'), function() {\n\t\t\t\tme.frm.amend_doc() }, 'fa fa-pencil', true);\n\t\t}\n\t},\n\tadd_update_button_on_dirty: function() {\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).on(\"dirty\", function() {\n\t\t\tme.show_title_as_dirty();\n\n\t\t\t// clear workflow actions\n\t\t\tme.frm.page.clear_actions_menu();\n\n\t\t\t// enable save action\n\t\t\tif(!me.frm.save_disabled) {\n\t\t\t\tme.set_primary_action(true);\n\t\t\t}\n\t\t});\n\t},\n\tshow_title_as_dirty: function() {\n\t\tif(this.frm.save_disabled)\n\t\t\treturn;\n\n\t\tif(this.frm.doc.__unsaved) {\n\t\t\tthis.page.set_indicator(__(\"Not Saved\"), \"orange\");\n\t\t}\n\n\t\t$(this.frm.wrapper).attr(\"data-state\", this.frm.doc.__unsaved ? \"dirty\" : \"clean\");\n\t}\n})\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Dashboard = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.section = this.frm.fields_dict._form_dashboard.wrapper;\n\t\tthis.parent = this.section.find('.section-body');\n\t\tthis.wrapper = $(frappe.render_template('form_dashboard',\n\t\t\t{frm: this.frm})).appendTo(this.parent);\n\n\t\tthis.progress_area = this.wrapper.find(\".progress-area\");\n\t\tthis.heatmap_area = this.wrapper.find('.form-heatmap');\n\t\tthis.chart_area = this.wrapper.find('.form-graph');\n\t\tthis.stats_area = this.wrapper.find('.form-stats');\n\t\tthis.stats_area_row = this.stats_area.find('.row');\n\t\tthis.links_area = this.wrapper.find('.form-links');\n\t\tthis.transactions_area = this.links_area.find('.transactions');\n\n\t},\n\treset: function() {\n\t\tthis.section.addClass('hidden');\n\t\tthis.clear_headline();\n\n\t\t// clear progress\n\t\tthis.progress_area.empty().addClass('hidden');\n\n\t\t// clear links\n\t\tthis.links_area.addClass('hidden');\n\t\tthis.links_area.find('.count, .open-notification').addClass('hidden');\n\n\t\t// clear stats\n\t\tthis.stats_area.addClass('hidden')\n\t\tthis.stats_area_row.empty();\n\n\t\t// clear custom\n\t\tthis.wrapper.find('.custom').remove();\n\t},\n\tset_headline: function(html) {\n\t\tthis.frm.layout.show_message(html);\n\t},\n\tclear_headline: function() {\n\t\tthis.frm.layout.show_message();\n\t},\n\n\tadd_comment: function(text, alert_class, permanent) {\n\t\tvar me = this;\n\t\tthis.set_headline_alert(text, alert_class);\n\t\tif(!permanent) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tme.clear_headline();\n\t\t\t}, 10000);\n\t\t}\n\t},\n\n\tclear_comment: function() {\n\t\tthis.clear_headline();\n\t},\n\n\tset_headline_alert: function(text, indicator_color) {\n\t\tif (!indicator_color) {\n\t\t\tindicator_color = 'orange';\n\t\t}\n\t\tif(text) {\n\t\t\tthis.set_headline(`<div><span class=\"indicator ${indicator_color}\">${text}</span></div>`);\n\t\t} else {\n\t\t\tthis.clear_headline();\n\t\t}\n\t},\n\n\tadd_section: function(html) {\n\t\treturn $('<div class=\"form-dashboard-section custom\">'+html+'</div>').appendTo(this.wrapper);\n\t},\n\n\tadd_progress: function(title, percent, message) {\n\t\tvar progress_chart = this.make_progress_chart(title);\n\n\t\tif(!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\n\t\tvar progress = $('<div class=\"progress\"></div>').appendTo(progress_chart);\n\t\t$.each(percent, function(i, opts) {\n\t\t\t$(repl('<div class=\"progress-bar %(progress_class)s\" style=\"width: %(width)s\" \\\n\t\t\t\ttitle=\"%(title)s\"></div>', opts)).appendTo(progress);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\t$(`<p class=\"progress-message text-muted small\">${message}</p>`).appendTo(progress_chart);\n\n\t\tthis.show();\n\n\t\treturn progress_chart;\n\t},\n\n\tshow_progress: function(title, percent, message) {\n\t\tthis._progress_map = this._progress_map || {};\n\t\tif (!this._progress_map[title]) {\n\t\t\tconst progress_chart = this.add_progress(title, percent, message);\n\t\t\tthis._progress_map[title] = progress_chart;\n\t\t}\n\t\tlet progress_chart = this._progress_map[title];\n\t\tif (!$.isArray(percent)) {\n\t\t\tpercent = this.format_percent(title, percent);\n\t\t}\n\t\tprogress_chart.find('.progress-bar').each((i, progress_bar) => {\n\t\t\tconst { progress_class, width } = percent[i];\n\t\t\t$(progress_bar).css('width', width)\n\t\t\t\t.removeClass('progress-bar-danger progress-bar-success')\n\t\t\t\t.addClass(progress_class);\n\t\t});\n\n\t\tif (!message) message = '';\n\t\tprogress_chart.find('.progress-message').text(message);\n\t},\n\n\thide_progress: function(title) {\n\t\tif (title){\n\t\t\tthis._progress_map[title].remove();\n\t\t\tdelete this._progress_map[title];\n\t\t} else {\n\t\t\tthis._progress_map = {};\n\t\t\tthis.progress_area.empty();\n\t\t}\n\t},\n\n\tformat_percent: function(title, percent) {\n\t\tvar width = cint(percent) < 1 ? 1 : cint(percent);\n\t\tvar progress_class = \"\";\n\t\tif(width < 10)\n\t\t\tprogress_class = \"progress-bar-danger\";\n\t\tif(width > 99.9)\n\t\t\tprogress_class = \"progress-bar-success\";\n\n\t\treturn [{\n\t\t\ttitle: title,\n\t\t\twidth: width + '%',\n\t\t\tprogress_class: progress_class\n\t\t}];\n\t},\n\tmake_progress_chart: function(title) {\n\t\tvar progress_chart = $('<div class=\"progress-chart\" title=\"'+(title || '')+'\"></div>')\n\t\t\t.appendTo(this.progress_area.removeClass('hidden'));\n\t\treturn progress_chart;\n\t},\n\n\trefresh: function() {\n\t\tthis.reset();\n\t\tif(this.frm.doc.__islocal) {\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tvar show = false;\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\tif(this.data.docstatus && this.frm.doc.docstatus !== this.data.docstatus) {\n\t\t\t\t// limited docstatus\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render_links();\n\t\t\tthis.set_open_count();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.heatmap) {\n\t\t\tthis.render_heatmap();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(this.data.graph) {\n\t\t\tthis.setup_graph();\n\t\t\tshow = true;\n\t\t}\n\n\t\tif(show) {\n\t\t\tthis.show();\n\t\t}\n\t},\n\n\tafter_refresh: function() {\n\t\tvar me = this;\n\t\t// show / hide new buttons (if allowed)\n\t\tthis.links_area.find('.btn-new').each(function() {\n\t\t\tif(me.frm.can_create($(this).attr('data-doctype'))) {\n\t\t\t\t$(this).removeClass('hidden');\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_data: function() {\n\t\tthis.data = this.frm.meta.__dashboard || {};\n\t\tif(!this.data.transactions) this.data.transactions = [];\n\t\tif(!this.data.internal_links) this.data.internal_links = {};\n\t\tthis.filter_permissions();\n\t},\n\n\tadd_transactions: function(opts) {\n\t\t// add additional data on dashboard\n\t\tlet group_added = [];\n\n\t\tif(!Array.isArray(opts)) opts=[opts];\n\n\t\tif(!this.data) {\n\t\t\tthis.init_data();\n\t\t}\n\n\t\tif(this.data && (this.data.transactions || []).length) {\n\t\t\t// check if label already exists, add items to it\n\t\t\tthis.data.transactions.map(group => {\n\t\t\t\topts.map(d => {\n\t\t\t\t\tif(d.label == group.label) {\n\t\t\t\t\t\tgroup_added.push(d.label);\n\t\t\t\t\t\tgroup.items.push(...d.items);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// if label not already present, add new label and items under it\n\t\t\topts.map(d => {\n\t\t\t\tif(!group_added.includes(d.label)) {\n\t\t\t\t\tthis.data.transactions.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.filter_permissions();\n\t\t}\n\t},\n\n\tfilter_permissions: function() {\n\t\t// filter out transactions for which the user\n\t\t// does not have permission\n\t\tvar transactions = [];\n\t\t(this.data.transactions || []).forEach(function(group) {\n\t\t\tvar items = [];\n\t\t\tgroup.items.forEach(function(doctype) {\n\t\t\t\tif(frappe.model.can_read(doctype)) {\n\t\t\t\t\titems.push(doctype);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// only add thie group, if there is atleast\n\t\t\t// one item with permission\n\t\t\tif(items.length) {\n\t\t\t\tgroup.items = items;\n\t\t\t\ttransactions.push(group);\n\t\t\t}\n\t\t});\n\t\tthis.data.transactions = transactions;\n\t},\n\trender_links: function() {\n\t\tvar me = this;\n\t\tthis.links_area.removeClass('hidden');\n\t\tthis.links_area.find('.btn-new').addClass('hidden');\n\t\tif(this.data_rendered) {\n\t\t\treturn;\n\t\t}\n\n\t\t//this.transactions_area.empty();\n\n\t\tthis.data.frm = this.frm;\n\n\t\t$(frappe.render_template('form_links', this.data))\n\t\t\t.appendTo(this.transactions_area)\n\n\t\t// bind links\n\t\tthis.transactions_area.find(\".badge-link\").on('click', function() {\n\t\t\tme.open_document_list($(this).parent());\n\t\t});\n\n\t\t// bind open notifications\n\t\tthis.transactions_area.find('.open-notification').on('click', function() {\n\t\t\tme.open_document_list($(this).parent(), true);\n\t\t});\n\n\t\t// bind new\n\t\tthis.transactions_area.find('.btn-new').on('click', function() {\n\t\t\tme.frm.make_new($(this).attr('data-doctype'));\n\t\t});\n\n\t\tthis.data_rendered = true;\n\t},\n\topen_document_list: function($link, show_open) {\n\t\t// show document list with filters\n\t\tvar doctype = $link.attr('data-doctype'),\n\t\t\tnames = $link.attr('data-names') || [];\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names.length) {\n\t\t\t\tfrappe.route_options = {'name': ['in', names]};\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else if(this.data.fieldname) {\n\t\t\tfrappe.route_options = this.get_document_filter(doctype);\n\t\t\tif(show_open) {\n\t\t\t\tfrappe.ui.notifications.show_open_count_list(doctype);\n\t\t\t}\n\t\t}\n\n\t\tfrappe.set_route(\"List\", doctype, \"List\");\n\t},\n\tget_document_filter: function(doctype) {\n\t\t// return the default filter for the given document\n\t\t// like {\"customer\": frm.doc.name}\n\t\tvar filter = {};\n\t\tvar fieldname = this.data.non_standard_fieldnames\n\t\t\t? (this.data.non_standard_fieldnames[doctype] || this.data.fieldname)\n\t\t\t: this.data.fieldname;\n\n\t\tif (this.data.dynamic_links && this.data.dynamic_links[fieldname]) {\n\t\t\tlet dynamic_fieldname = this.data.dynamic_links[fieldname][1];\n\t\t\tfilter[dynamic_fieldname] = this.data.dynamic_links[fieldname][0];\n\t\t}\n\n\t\tfilter[fieldname] = this.frm.doc.name;\n\t\treturn filter;\n\t},\n\tset_open_count: function() {\n\t\tif(!this.data.transactions || !this.data.fieldname) {\n\t\t\treturn;\n\t\t}\n\n\t\t// list all items from the transaction list\n\t\tvar items = [],\n\t\t\tme = this;\n\n\t\tthis.data.transactions.forEach(function(group) {\n\t\t\tgroup.items.forEach(function(item) { items.push(item); });\n\t\t});\n\n\t\tvar method = this.data.method || 'frappe.desk.notifications.get_open_count';\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name,\n\t\t\t\titems: items\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message.timeline_data) {\n\t\t\t\t\tme.update_heatmap(r.message.timeline_data);\n\t\t\t\t}\n\n\t\t\t\t// update badges\n\t\t\t\t$.each(r.message.count, function(i, d) {\n\t\t\t\t\tme.frm.dashboard.set_badge_count(d.name, cint(d.open_count), cint(d.count));\n\t\t\t\t});\n\n\t\t\t\t// update from internal links\n\t\t\t\t$.each(me.data.internal_links, function(doctype, link) {\n\t\t\t\t\tvar table_fieldname = link[0], link_fieldname = link[1];\n\t\t\t\t\tvar names = [];\n\t\t\t\t\t(me.frm.doc[table_fieldname] || []).forEach(function(d) {\n\t\t\t\t\t\tvar value = d[link_fieldname];\n\t\t\t\t\t\tif(value && names.indexOf(value)===-1) {\n\t\t\t\t\t\t\tnames.push(value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tme.frm.dashboard.set_badge_count(doctype, 0, names.length, names);\n\t\t\t\t});\n\n\t\t\t\tme.frm.dashboard_data = r.message;\n\t\t\t\tme.frm.trigger('dashboard_update');\n\t\t\t}\n\t\t});\n\n\t},\n\tset_badge_count: function(doctype, open_count, count, names) {\n\t\tvar $link = $(this.transactions_area)\n\t\t\t.find('.document-link[data-doctype=\"'+doctype+'\"]');\n\n\t\tif(open_count) {\n\t\t\t$link.find('.open-notification')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((open_count > 99) ? '99+' : open_count);\n\t\t}\n\n\t\tif(count) {\n\t\t\t$link.find('.count')\n\t\t\t\t.removeClass('hidden')\n\t\t\t\t.html((count > 99) ? '99+' : count);\n\t\t}\n\n\t\tif(this.data.internal_links[doctype]) {\n\t\t\tif(names && names.length) {\n\t\t\t\t$link.attr('data-names', names ? names.join(',') : '');\n\t\t\t} else {\n\t\t\t\t$link.find('a').attr('disabled', true);\n\t\t\t}\n\t\t}\n\t},\n\n\tupdate_heatmap: function(data) {\n\t\tif(this.heatmap) {\n\t\t\tthis.heatmap.update(data);\n\t\t}\n\t},\n\n\t// heatmap\n\trender_heatmap: function() {\n\t\tif(!this.heatmap) {\n\t\t\tthis.heatmap = new Chart(\"#heatmap-\" + frappe.model.scrub(this.frm.doctype), {\n\t\t\t\ttype: 'heatmap',\n\t\t\t\theight: 120,\n\t\t\t\tstart: new Date(moment().subtract(1, 'year').toDate()),\n\t\t\t\tcount_label: \"interactions\",\n\t\t\t\tdiscreteDomains: 0,\n\t\t\t\tdata: {}\n\t\t\t});\n\n\t\t\t// center the heatmap\n\t\t\tthis.heatmap_area.removeClass('hidden').find('svg').css({'margin': 'auto'});\n\n\t\t\t// message\n\t\t\tvar heatmap_message = this.heatmap_area.find('.heatmap-message');\n\t\t\tif(this.data.heatmap_message) {\n\t\t\t\theatmap_message.removeClass('hidden').html(this.data.heatmap_message);\n\t\t\t} else {\n\t\t\t\theatmap_message.addClass('hidden');\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator: function(label, color) {\n\t\tthis.show();\n\t\tthis.stats_area.removeClass('hidden');\n\n\n\t\t// set colspan\n\t\tvar indicators = this.stats_area_row.find('.indicator-column');\n\t\tvar n_indicators = indicators.length + 1;\n\t\tvar colspan;\n\t\tif(n_indicators > 4) { colspan = 3 }\n\t\telse { colspan = 12 / n_indicators; }\n\n\t\t// reset classes in existing indicators\n\t\tif(indicators.length) {\n\t\t\tindicators.removeClass().addClass('col-sm-'+colspan).addClass('indicator-column');\n\t\t}\n\n\t\tvar indicator = $('<div class=\"col-sm-'+colspan+' indicator-column\"><span class=\"indicator '+color+'\">'\n\t\t\t+label+'</span></div>').appendTo(this.stats_area_row);\n\n\t\treturn indicator;\n\t},\n\n\t// graphs\n\tsetup_graph: function() {\n\t\tvar me = this;\n\t\tvar method = this.data.graph_method;\n\t\tvar args = {\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.doc.name,\n\t\t};\n\t\t$.extend(args, this.data.graph_method_args);\n\n\t\tfrappe.call({\n\t\t\ttype: \"GET\",\n\t\t\tmethod: method,\n\t\t\targs: args,\n\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.message) {\n\t\t\t\t\tme.render_graph(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\trender_graph: function(args) {\n\t\tvar me = this;\n\t\tthis.chart_area.empty().removeClass('hidden');\n\t\t$.extend(args, {\n\t\t\ttype: 'line',\n\t\t\tcolors: ['green']\n\t\t});\n\t\tthis.show();\n\n\t\tthis.chart = new Chart('.form-graph', args);\n\t\tif(!this.chart) {\n\t\t\tthis.hide();\n\t\t}\n\t},\n\n\tshow: function() {\n\t\tthis.section.removeClass('hidden');\n\t},\n\n\thide: function() {\n\t\tthis.section.addClass('hidden');\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.document_flow');\n\nfrappe.ui.form.DocumentFlow = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tthis.module = frappe.get_meta(this.frm.doctype).module\n\t\tif (!frappe.document_flow || !frappe.document_flow[this.module]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.doctypes = frappe.document_flow[this.module][this.frm.doctype];\n\t\tif (!this.doctypes) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.wrapper = $('<div class=\"document-flow-wrapper hidden\"></div>').prependTo(this.frm.layout.wrapper);\n\t},\n\n\trefresh: function() {\n\t\tif(this.doctypes) {\n\t\t\tthis.reset();\n\t\t\tthis.render();\n\t\t}\n\t},\n\n\treset: function() {\n\t\tthis.wrapper.empty().addClass('hidden');\n\t\tthis.linked_with = {};\n\t},\n\n\trender: function() {\n\t\tvar me = this;\n\n\t\t$(frappe.render_template('form_document_flow', {\n\t\t\tfrm: this.frm,\n\t\t\tdoctypes: this.doctypes,\n\t\t})).appendTo(this.wrapper.removeClass('hidden'));\n\n\t\tthis.wrapper.on('click', '.document-flow-link', function() {\n\t\t\tvar doctype = $(this).attr(\"data-doctype\");\n\t\t\tif (me.frm.doctype != doctype) {\n\t\t\t\tme.get_linked_docs(doctype);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif (!this.frm.doc.__islocal) {\n\t\t\tthis.mark_completed_flow()\n\t\t}\n\n\t},\n\n\tget_linked_docs: function(for_doctype) {\n\t\tif(!this.linked_with[for_doctype]) {\n\t\t\tthis.linked_with[for_doctype] = new frappe.ui.form.LinkedWith({\n\t\t\t\tfrm: this.frm,\n\t\t\t\tfor_doctype: for_doctype\n\t\t\t});\n\t\t}\n\n\t\tthis.linked_with[for_doctype].show();\n\t},\n\n\tmark_completed_flow: function() {\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.desk.form.document_flow.get_document_completion_status\",\n\t\t\targs: {\n\t\t\t\tdoctypes: me.doctypes,\n\t\t\t\tfrm_doctype: me.frm.doctype,\n\t\t\t\tfrm_docname: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif(!r.message) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t$.each(me.doctypes, function(i, doctype) {\n\t\t\t\t\tif (r.message[doctype] && me.frm.doctype!=doctype) {\n\t\t\t\t\t\tme.wrapper.find(\"[data-doctype='\"+doctype+\"']a .indicator\")\n\t\t\t\t\t\t\t.removeClass(\"darkgrey\")\n\t\t\t\t\t\t\t.addClass(\"black\")\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.save = function (frm, action, callback, btn) {\n\t$(btn).prop(\"disabled\", true);\n\n\t// specified here because there are keyboard shortcuts to save\n\tvar working_label = {\n\t\t\"Save\": __(\"Saving\"),\n\t\t\"Submit\": __(\"Submitting\"),\n\t\t\"Update\": __(\"Updating\"),\n\t\t\"Amend\": __(\"Amending\"),\n\t\t\"Cancel\": __(\"Cancelling\")\n\t}[toTitle(action)];\n\n\tvar freeze_message = working_label ? __(working_label) : \"\";\n\n\tvar save = function () {\n\t\tremove_empty_rows();\n\n\t\t$(frm.wrapper).addClass('validated-form');\n\t\tif (check_mandatory()) {\n\t\t\t_call({\n\t\t\t\tmethod: \"frappe.desk.form.save.savedocs\",\n\t\t\t\targs: { doc: frm.doc, action: action },\n\t\t\t\tcallback: function (r) {\n\t\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\terror: function (r) {\n\t\t\t\t\tcallback(r);\n\t\t\t\t},\n\t\t\t\tbtn: btn,\n\t\t\t\tfreeze_message: freeze_message\n\t\t\t});\n\t\t} else {\n\t\t\t$(btn).prop(\"disabled\", false);\n\t\t}\n\t};\n\n\tvar remove_empty_rows = function() {\n\t\t/**\n\t\tThis function removes empty rows. Note that in this function, a row is considered\n\t\tempty if the fields with `in_list_view: 1` are undefined or falsy because that's\n\t\twhat users also consider to be an empty row\n\t\t */\n\t\tconst docs = frappe.model.get_all_docs(frm.doc);\n\n\t\t// we should only worry about table data\n\t\tconst tables = docs.filter(function(d){\n\t\t\treturn frappe.model.is_table(d.doctype);\n\t\t});\n\n\t\ttables.map(\n\t\t\tfunction(doc){\n\t\t\t\tconst cells = frappe.meta.docfield_list[doc.doctype] || [];\n\n\t\t\t\tconst in_list_view_cells = cells.filter(function(df) {\n\t\t\t\t\treturn cint(df.in_list_view) === 1;\n\t\t\t\t});\n\n\t\t\t\tvar is_empty_row = function(cells) {\n\t\t\t\t\tfor (var i=0; i < cells.length; i++){\n\t\t\t\t\t\tif(locals[doc.doctype][doc.name][cells[i].fieldname]){\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tif (is_empty_row(in_list_view_cells)) {\n\t\t\t\t\tfrappe.model.clear_doc(doc.doctype, doc.name);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t};\n\n\tvar cancel = function () {\n\t\tvar args = {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tname: frm.doc.name\n\t\t};\n\n\t\t// update workflow state value if workflow exists\n\t\tvar workflow_state_fieldname = frappe.workflow.get_state_fieldname(frm.doctype);\n\t\tif (workflow_state_fieldname) {\n\t\t\t$.extend(args, {\n\t\t\t\tworkflow_state_fieldname: workflow_state_fieldname,\n\t\t\t\tworkflow_state: frm.doc[workflow_state_fieldname]\n\n\t\t\t});\n\t\t}\n\n\t\t_call({\n\t\t\tmethod: \"frappe.desk.form.save.cancel\",\n\t\t\targs: args,\n\t\t\tcallback: function (r) {\n\t\t\t\t$(document).trigger(\"save\", [frm.doc]);\n\t\t\t\tcallback(r);\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tfreeze_message: freeze_message\n\t\t});\n\t};\n\n\tvar check_mandatory = function () {\n\t\tvar me = this;\n\t\tvar has_errors = false;\n\t\tfrm.scroll_set = false;\n\n\t\tif (frm.doc.docstatus == 2) return true; // don't check for cancel\n\n\t\t$.each(frappe.model.get_all_docs(frm.doc), function (i, doc) {\n\t\t\tvar error_fields = [];\n\t\t\tvar folded = false;\n\n\t\t\t$.each(frappe.meta.docfield_list[doc.doctype] || [], function (i, docfield) {\n\t\t\t\tif (docfield.fieldname) {\n\t\t\t\t\tvar df = frappe.meta.get_docfield(doc.doctype,\n\t\t\t\t\t\tdocfield.fieldname, frm.doc.name);\n\n\t\t\t\t\tif (df.fieldtype === \"Fold\") {\n\t\t\t\t\t\tfolded = frm.layout.folded;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (df.reqd && !frappe.model.has_value(doc.doctype, doc.name, df.fieldname)) {\n\t\t\t\t\t\thas_errors = true;\n\t\t\t\t\t\terror_fields[error_fields.length] = __(df.label);\n\t\t\t\t\t\t// scroll to field\n\t\t\t\t\t\tif (!frm.scroll_set) {\n\t\t\t\t\t\t\tscroll_to(doc.parentfield || df.fieldname);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (folded) {\n\t\t\t\t\t\t\tfrm.layout.unfold();\n\t\t\t\t\t\t\tfolded = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (error_fields.length) {\n\t\t\t\tif (doc.parenttype) {\n\t\t\t\t\tvar message = __('Mandatory fields required in table {0}, Row {1}',\n\t\t\t\t\t\t[__(frappe.meta.docfield_map[doc.parenttype][doc.parentfield].label).bold(), doc.idx]);\n\t\t\t\t} else {\n\t\t\t\t\tvar message = __('Mandatory fields required in {0}', [__(doc.doctype)]);\n\n\t\t\t\t}\n\t\t\t\tmessage = message + '<br><br><ul><li>' + error_fields.join('</li><li>') + \"</ul>\";\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tindicator: 'red',\n\t\t\t\t\ttitle: __('Missing Fields')\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn !has_errors;\n\t};\n\n\tvar scroll_to = function (fieldname) {\n\t\tvar f = cur_frm.fields_dict[fieldname];\n\t\tif (f) {\n\t\t\t$(document).scrollTop($(f.wrapper).offset().top - 60);\n\t\t}\n\t\tfrm.scroll_set = true;\n\t};\n\n\tvar _call = function (opts) {\n\t\t// opts = {\n\t\t// \tmethod: \"some server method\",\n\t\t// \targs: {args to be passed},\n\t\t// \tcallback: callback,\n\t\t// \tbtn: btn\n\t\t// }\n\n\t\tif (frappe.ui.form.is_saving) {\n\t\t\t// this is likely to happen if the user presses the shortcut cmd+s for a longer duration or uses double click\n\t\t\t// no need to show this to user, as they can see \"Saving\" in freeze message\n\t\t\tconsole.log(\"Already saving. Please wait a few moments.\")\n\t\t\tthrow \"saving\";\n\t\t}\n\n\t\t// ensure we remove new docs routes ONLY\n\t\tif ( frm.is_new() ) {\n\t\t\tfrappe.ui.form.remove_old_form_route();\n\t\t}\n\t\tfrappe.ui.form.is_saving = true;\n\n\t\treturn frappe.call({\n\t\t\tfreeze: true,\n\t\t\t// freeze_message: opts.freeze_message,\n\t\t\tmethod: opts.method,\n\t\t\targs: opts.args,\n\t\t\tbtn: opts.btn,\n\t\t\tcallback: function (r) {\n\t\t\t\topts.callback && opts.callback(r);\n\t\t\t},\n\t\t\terror: opts.error,\n\t\t\talways: function (r) {\n\t\t\t\t$(btn).prop(\"disabled\", false);\n\t\t\t\tfrappe.ui.form.is_saving = false;\n\t\t\t\tif (r) {\n\t\t\t\t\tvar doc = r.docs && r.docs[0];\n\t\t\t\t\tif (doc) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(doc);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t};\n\n\tif (action === \"cancel\") {\n\t\tcancel();\n\t} else {\n\t\tsave();\n\t}\n}\n\nfrappe.ui.form.remove_old_form_route = () => {\n\tlet current_route = frappe.get_route().join(\"/\");\n\tfrappe.route_history = frappe.route_history\n\t\t.filter((route) => route.join(\"/\") !== current_route);\n}\n\nfrappe.ui.form.update_calling_link = (newdoc) => {\n\tif (frappe._from_link && newdoc.doctype === frappe._from_link.df.options) {\n\t\tvar doc = frappe.get_doc(frappe._from_link.doctype, frappe._from_link.docname);\n\t\t// set value\n\t\tif (doc && doc.parentfield) {\n\t\t\t//update values for child table\n\t\t\t$.each(frappe._from_link.frm.fields_dict[doc.parentfield].grid.grid_rows, function (index, field) {\n\t\t\t\tif (field.doc && field.doc.name === frappe._from_link.docname) {\n\t\t\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tfrappe._from_link.set_value(newdoc.name);\n\t\t}\n\n\t\t// refresh field\n\t\tfrappe._from_link.refresh();\n\n\t\t// if from form, switch\n\t\tif (frappe._from_link.frm) {\n\t\t\tfrappe.set_route(\"Form\",\n\t\t\t\tfrappe._from_link.frm.doctype, frappe._from_link.frm.docname)\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.scroll_to(frappe._from_link_scrollY);\n\t\t\t\t});\n\t\t}\n\n\t\tfrappe._from_link = null;\n\t}\n}\n\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form.handlers\");\n\nfrappe.ui.form.get_event_handler_list = function(doctype, fieldname) {\n\tif(!frappe.ui.form.handlers[doctype]) {\n\t\tfrappe.ui.form.handlers[doctype] = {};\n\t}\n\tif(!frappe.ui.form.handlers[doctype][fieldname]) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\treturn frappe.ui.form.handlers[doctype][fieldname];\n}\n\nfrappe.ui.form.on = frappe.ui.form.on_change = function(doctype, fieldname, handler) {\n\tvar add_handler = function(fieldname, handler) {\n\t\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\t\thandler_list.push(handler);\n\n\t\t// add last handler to events so it can be called as\n\t\t// frm.events.handler(frm)\n\t\tif(cur_frm && cur_frm.doctype===doctype) {\n\t\t\tcur_frm.events[fieldname] = handler;\n\t\t}\n\t}\n\n\tif (!handler && $.isPlainObject(fieldname)) {\n\t\t// a dict of handlers {fieldname: handler, ...}\n\t\tfor (var key in fieldname) {\n\t\t\tvar fn = fieldname[key];\n\t\t\tif (typeof fn === \"function\") {\n\t\t\t\tadd_handler(key, fn);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tadd_handler(fieldname, handler);\n\t}\n}\n\n// remove standard event handlers\nfrappe.ui.form.off = function(doctype, fieldname, handler) {\n\tvar handler_list = frappe.ui.form.get_event_handler_list(doctype, fieldname);\n\tif(handler_list.length) {\n\t\tfrappe.ui.form.handlers[doctype][fieldname] = [];\n\t}\n\n\tif(cur_frm && cur_frm.doctype===doctype && cur_frm.events[fieldname]) {\n\t\tdelete cur_frm.events[fieldname];\n\t}\n\n\tif(cur_frm && cur_frm.cscript && cur_frm.cscript[fieldname]) {\n\t\tdelete cur_frm.cscript[fieldname];\n\t}\n}\n\n\nfrappe.ui.form.trigger = function(doctype, fieldname) {\n\tcur_frm.script_manager.trigger(fieldname, doctype);\n}\n\nfrappe.ui.form.ScriptManager = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tmake: function(ControllerClass) {\n\t\tthis.frm.cscript = $.extend(this.frm.cscript,\n\t\t\tnew ControllerClass({frm: this.frm}));\n\t},\n\ttrigger: function(event_name, doctype, name) {\n\t\t// trigger all the form level events that\n\t\t// are bound to this event_name\n\t\tlet me = this;\n\t\tdoctype = doctype || this.frm.doctype;\n\t\tname = name || this.frm.docname;\n\n\t\tlet tasks = [];\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\n\t\t// helper for child table\n\t\tthis.frm.selected_doc = frappe.get_doc(doctype, name);\n\n\t\tlet runner = (_function, is_old_style) => {\n\t\t\tlet _promise = null;\n\t\t\tif(is_old_style) {\n\t\t\t\t// old style arguments (doc, cdt, cdn)\n\t\t\t\t_promise = me.frm.cscript[_function](me.frm.doc, doctype, name);\n\t\t\t} else {\n\t\t\t\t// new style (frm, doctype, name)\n\t\t\t\t_promise = _function(me.frm, doctype, name);\n\t\t\t}\n\n\t\t\t// if the trigger returns a promise, return it,\n\t\t\t// or use the default promise frappe.after_ajax\n\t\t\tif (_promise && _promise.then) {\n\t\t\t\treturn _promise;\n\t\t\t} else {\n\t\t\t\treturn frappe.after_server_call();\n\t\t\t}\n\t\t};\n\n\t\t// make list of functions to be run serially\n\t\thandlers.new_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, false);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, false));\n\t\t\t}\n\t\t});\n\n\t\thandlers.old_style.forEach((_function) => {\n\t\t\tif(event_name==='setup') {\n\t\t\t\t// setup must be called immediately\n\t\t\t\trunner(_function, true);\n\t\t\t} else {\n\t\t\t\ttasks.push(() => runner(_function, true));\n\t\t\t}\n\t\t});\n\n\t\t// run them serially\n\t\treturn frappe.run_serially(tasks);\n\t},\n\thas_handlers: function(event_name, doctype) {\n\t\tlet handlers = this.get_handlers(event_name, doctype);\n\t\treturn handlers && (handlers.old_style.length || handlers.new_style.length);\n\t},\n\tget_handlers: function(event_name, doctype) {\n\t\t// returns list of all functions to be called (old style and new style)\n\t\tlet me = this;\n\t\tlet handlers = {\n\t\t\told_style: [],\n\t\t\tnew_style: []\n\t\t};\n\t\tif(frappe.ui.form.handlers[doctype] && frappe.ui.form.handlers[doctype][event_name]) {\n\t\t\t$.each(frappe.ui.form.handlers[doctype][event_name], function(i, fn) {\n\t\t\t\thandlers.new_style.push(fn);\n\t\t\t});\n\t\t}\n\t\tif(this.frm.cscript[event_name]) {\n\t\t\thandlers.old_style.push(event_name);\n\t\t}\n\t\tif(this.frm.cscript[\"custom_\" + event_name]) {\n\t\t\thandlers.old_style.push(\"custom_\" + event_name);\n\t\t}\n\t\treturn handlers;\n\t},\n\tsetup: function() {\n\t\tvar doctype = this.frm.meta;\n\t\tvar me = this;\n\n\t\t// js\n\t\tvar cs = doctype.__js;\n\t\tif(cs) {\n\t\t\tvar tmp = eval(cs);\n\t\t}\n\n\t\tif(doctype.__custom_js) {\n\t\t\ttry {\n\t\t\t\teval(doctype.__custom_js);\n\t\t\t} catch(e) {\n\t\t\t\tfrappe.msgprint({\n\t\t\t\t\ttitle: __('Error in Custom Script'),\n\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\tmessage: '<pre class=\"small\"><code>' + e.stack  + '</code></pre>'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tfunction setup_add_fetch(df) {\n\t\t\tif((['Data', 'Read Only', 'Text', 'Small Text', 'Currency',\n\t\t\t\t'Text Editor', 'Code', 'Link', 'Float', 'Int', 'Date'].includes(df.fieldtype) || df.read_only==1)\n\t\t\t\t&& df.fetch_from && df.fetch_from.indexOf(\".\")!=-1) {\n\t\t\t\tvar parts = df.fetch_from.split(\".\");\n\t\t\t\tme.frm.add_fetch(parts[0], parts[1], df.fieldname);\n\t\t\t}\n\t\t}\n\n\t\t// setup add fetch\n\t\t$.each(this.frm.fields, function(i, field) {\n\t\t\tsetup_add_fetch(field.df);\n\t\t\tif(field.df.fieldtype===\"Table\") {\n\t\t\t\t$.each(frappe.meta.get_docfields(field.df.options, me.frm.docname), function(i, df) {\n\t\t\t\t\tsetup_add_fetch(df);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// css\n\t\tdoctype.__css && frappe.dom.set_style(doctype.__css);\n\n\t\tthis.trigger('setup');\n\t},\n\tlog_error: function(caller, e) {\n\t\tfrappe.show_alert(\"Error in Client Script.\");\n\t\tconsole.group && console.group();\n\t\tconsole.log(\"----- error in client script -----\");\n\t\tconsole.log(\"method: \" + caller);\n\t\tconsole.log(e);\n\t\tconsole.log(\"error message: \" + e.message);\n\t\tconsole.trace && console.trace();\n\t\tconsole.log(\"----- end of error message -----\");\n\t\tconsole.group && console.groupEnd();\n\t},\n\tcopy_from_first_row: function(parentfield, current_row, fieldnames) {\n\t\tvar data = this.frm.doc[parentfield];\n\t\tif(data.length===1 || data[0]===current_row) return;\n\n\t\tif(typeof fieldnames==='string') {\n\t\t\tfieldnames = [fieldnames];\n\t\t}\n\n\t\t$.each(fieldnames, function(i, fieldname) {\n\t\t\tfrappe.model.set_value(current_row.doctype, current_row.name, fieldname,\n\t\t\t\tdata[0][fieldname]);\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.LinkedWith = class LinkedWith {\n\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t}\n\n\tshow() {\n\t\tif(!this.dialog)\n\t\t\tthis.make_dialog();\n\n\t\t$(this.dialog.body).html(\n\t\t\t`<div class=\"text-muted text-center\" style=\"padding: 30px 0px\">\n\t\t\t\t${__(\"Loading\")}...\n\t\t\t</div>`);\n\n\t\tthis.dialog.show();\n\t}\n\n\tmake_dialog() {\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\thide_on_page_refresh: true,\n\t\t\ttitle: __(\"Linked With\")\n\t\t});\n\n\t\tthis.dialog.on_page_show = () => {\n\t\t\t// execute ajax calls sequentially\n\t\t\t// 1. get linked doctypes\n\t\t\t// 2. load all doctypes\n\t\t\t// 3. load linked docs\n\t\t\tthis.get_linked_doctypes()\n\t\t\t\t.then(() => this.load_doctypes())\n\t\t\t\t.then(() => this.links_not_permitted_or_missing())\n\t\t\t\t.then(() => this.get_linked_docs())\n\t\t\t\t.then(() => this.make_html());\n\t\t};\n\t}\n\n\tmake_html() {\n\t\tconst linked_docs = this.frm.__linked_docs;\n\n\t\tlet html = '';\n\n\t\tconst linked_doctypes = Object.keys(linked_docs);\n\n\t\tif (linked_doctypes.length === 0) {\n\t\t\thtml = __(\"Not Linked to any record\");\n\t\t} else {\n\t\t\thtml = linked_doctypes.map(doctype => {\n\t\t\t\tconst docs = linked_docs[doctype];\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"list-item-table margin-bottom\">\n\t\t\t\t\t\t${this.make_doc_head(doctype)}\n\t\t\t\t\t\t${docs.map(doc => this.make_doc_row(doc, doctype)).join('')}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t}).join('');\n\t\t}\n\n\t\t$(this.dialog.body).html(html);\n\t}\n\n\tload_doctypes() {\n\t\tconst already_loaded = Object.keys(locals.DocType);\n\t\tlet doctypes_to_load = [];\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tdoctypes_to_load =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(doctype => !already_loaded.includes(doctype));\n\t\t}\n\n\t\t// load all doctypes asynchronously using with_doctype\n\t\tconst promises = doctypes_to_load.map(dt => {\n\t\t\treturn frappe.model.with_doctype(dt, () => {\n\t\t\t\tif(frappe.listview_settings[dt]) {\n\t\t\t\t\t// add additional fields to __linked_doctypes\n\t\t\t\t\tthis.frm.__linked_doctypes[dt].add_fields =\n\t\t\t\t\t\tfrappe.listview_settings[dt].add_fields;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tlinks_not_permitted_or_missing() {\n\t\tlet links = null;\n\n\t\tif (this.frm.__linked_doctypes) {\n\t\t\tlinks =\n\t\t\t\tObject.keys(this.frm.__linked_doctypes)\n\t\t\t\t\t.filter(frappe.model.can_get_report);\n\t\t}\n\n\t\tlet flag;\n\t\tif(!links) {\n\t\t\t$(this.dialog.body).html(`${this.frm.__linked_doctypes\n\t\t\t\t? __(\"Not enough permission to see links\")\n\t\t\t\t: __(\"Not Linked to any record\")}`);\n\t\t\tflag = true;\n\t\t}\n\t\tflag = false;\n\n\t\t// reject Promise if not_permitted or missing\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => flag ? reject() : resolve()\n\t\t);\n\t}\n\n\tget_linked_doctypes() {\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.frm.__linked_doctypes) {\n\t\t\t\tresolve();\n\t\t\t}\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_doctypes\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: this.frm.doctype\n\t\t\t\t},\n\t\t\t\tcallback: (r) => {\n\t\t\t\t\tthis.frm.__linked_doctypes = r.message;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_linked_docs() {\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.linked_with.get_linked_docs\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.docname,\n\t\t\t\tlinkinfo: this.frm.__linked_doctypes,\n\t\t\t\tfor_doctype: this.for_doctype\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tthis.frm.__linked_docs = r.message || {};\n\t\t\t}\n\t\t});\n\t}\n\n\tmake_doc_head(heading) {\n\t\treturn `\n\t\t\t<header class=\"level list-row list-row-head text-muted small\">\n\t\t\t\t<div>${__(heading)}</div>\n\t\t\t</header>\n\t\t`;\n\t}\n\n\tmake_doc_row(doc, doctype) {\n\t\treturn `<div class=\"list-row-container\">\n\t\t\t<div class=\"level list-row small\">\n\t\t\t\t<div class=\"level-left bold\">\n\t\t\t\t\t<a href=\"#Form/${doctype}/${doc.name}\">${doc.name}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`;\n\t}\n};\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.States = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.state_fieldname = frappe.workflow.get_state_fieldname(this.frm.doctype);\n\n\t\t// no workflow?\n\t\tif(!this.state_fieldname)\n\t\t\treturn;\n\n\t\tthis.update_fields = frappe.workflow.get_update_fields(this.frm.doctype);\n\n\t\tvar me = this;\n\t\t$(this.frm.wrapper).bind(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\n\tsetup_help: function() {\n\t\tvar me = this;\n\t\tthis.frm.page.add_action_item(__(\"Help\"), function() {\n\t\t\tfrappe.workflow.setup(me.frm.doctype);\n\t\t\tvar state = me.get_state();\n\t\t\tvar d = new frappe.ui.Dialog({\n\t\t\t\ttitle: \"Workflow: \"\n\t\t\t\t\t+ frappe.workflow.workflows[me.frm.doctype].name\n\t\t\t});\n\n\t\t\tfrappe.workflow.get_transitions(me.frm.doc).then((transitions) => {\n\t\t\t\tvar next_html = $.map(transitions,\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\treturn d.action.bold() + __(\" by Role \") + d.allowed;\n\t\t\t\t\t}).join(\", \") || __(\"None: End of Workflow\").bold();\n\n\t\t\t\t$(d.body).html(\"<p>\"+__(\"Current status\")+\": \" + state.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Document is only editable by users of role\")+\": \"\n\t\t\t\t\t\t+ frappe.workflow.get_document_state(me.frm.doctype,\n\t\t\t\t\t\t\tstate).allow_edit.bold() + \"</p>\"\n\t\t\t\t\t+ \"<p>\"+__(\"Next actions\")+\": \"+ next_html +\"</p>\"\n\t\t\t\t\t+ (me.frm.doc.__islocal ? (\"<div class='alert alert-info'>\"\n\t\t\t\t\t\t+__(\"Workflow will start after saving.\")+\"</div>\") : \"\")\n\t\t\t\t\t+ \"<p class='help'>\"+__(\"Note: Other permission rules may also apply\")+\"</p>\"\n\t\t\t\t).css({padding: '15px'});\n\t\t\t\td.show();\n\t\t\t});\n\t\t}, true);\n\t},\n\n\trefresh: function() {\n\t\tconst me = this;\n\t\t// hide if its not yet saved\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.set_default_state();\n\t\t\treturn;\n\t\t}\n\n\t\t// state text\n\t\tconst state = this.get_state();\n\n\t\tlet doctype = this.frm.doctype;\n\n\t\tif(state) {\n\t\t\t// show actions from that state\n\t\t\tthis.show_actions(state);\n\t\t}\n\t},\n\n\tshow_actions: function() {\n\t\tvar added = false;\n\t\tvar me = this;\n\n\t\tthis.frm.page.clear_actions_menu();\n\n\t\t// if the loaded doc is dirty, don't show workflow buttons\n\t\tif (this.frm.doc.__unsaved===1) {\n\t\t\treturn;\n\t\t}\n\n\t\tfunction has_approval_access(transition) {\n\t\t\tlet approval_access = false;\n\t\t\tconst user = frappe.session.user;\n\t\t\tif (user === 'Administrator'\n\t\t\t\t|| transition.allow_self_approval\n\t\t\t\t|| user !== me.frm.doc.owner) {\n\t\t\t\tapproval_access = true;\n\t\t\t}\n\t\t\treturn approval_access;\n\t\t}\n\n\t\tfrappe.workflow.get_transitions(this.frm.doc).then(transitions => {\n\t\t\t$.each(transitions, function(i, d) {\n\t\t\t\tif(frappe.user_roles.includes(d.allowed) && has_approval_access(d)) {\n\t\t\t\t\tadded = true;\n\t\t\t\t\tme.frm.page.add_action_item(__(d.action), function() {\n\t\t\t\t\t\tfrappe.xcall('frappe.model.workflow.apply_workflow',\n\t\t\t\t\t\t\t{doc: me.frm.doc, action: d.action})\n\t\t\t\t\t\t\t.then((doc) => {\n\t\t\t\t\t\t\t\tfrappe.model.sync(doc);\n\t\t\t\t\t\t\t\tme.frm.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.setup_btn(added);\n\t\t});\n\n\t},\n\n\tsetup_btn: function(action_added) {\n\t\tif(action_added) {\n\t\t\tthis.frm.page.btn_primary.addClass(\"hide\");\n\t\t\tthis.frm.page.btn_secondary.addClass(\"hide\");\n\t\t\tthis.frm.toolbar.current_status = \"\";\n\t\t\tthis.setup_help();\n\t\t}\n\t},\n\n\tset_default_state: function() {\n\t\tvar default_state = frappe.workflow.get_default_state(this.frm.doctype, this.frm.doc.docstatus);\n\t\tif(default_state) {\n\t\t\tthis.frm.set_value(this.state_fieldname, default_state);\n\t\t}\n\t},\n\n\tget_state: function() {\n\t\tif(!this.frm.doc[this.state_fieldname]) {\n\t\t\tthis.set_default_state();\n\t\t}\n\t\treturn this.frm.doc[this.state_fieldname];\n\t}\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.PrintPreview = Class.extend({\n\tinit: function (opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.bind_events();\n\t},\n\tmake: function () {\n\t\tthis.wrapper = this.frm.page.add_view(\"print\", frappe.render_template(\"print_layout\", {}));\n\n\t\t// only system manager can edit\n\t\tthis.wrapper.find(\".btn-print-edit\").toggle(frappe.user.has_role(\"System Manager\"));\n\t},\n\tbind_events: function () {\n\t\tvar me = this;\n\t\tthis.wrapper.find(\".btn-print-close\").click(function () {\n\t\t\tme.frm.hide_print();\n\t\t});\n\n\t\t// hide print view on pressing escape, only if there is no focus on any input\n\t\t$(document).on(\"keydown\", function (e) {\n\t\t\tif (e.which === 27 && me.frm && e.target === document.body) {\n\t\t\t\tme.frm.hide_print();\n\t\t\t}\n\t\t});\n\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.meta.name);\n\t\tthis.print_letterhead = this.wrapper\n\t\t\t.find(\".print-letterhead\")\n\t\t\t.on(\"change\", function () { me.print_sel.trigger(\"change\"); })\n\t\t\t.prop(\"checked\", cint(\n\t\t\t\t(frappe.model.get_doc(\":Print Settings\", \"Print Settings\")\n\t\t\t\t\t|| { with_letterhead: 1 }).with_letterhead) ? true : false);\n\t\tthis.print_sel = this.wrapper\n\t\t\t.find(\".print-preview-select\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.set_default_print_language();\n\t\t\t\tme.multilingual_preview();\n\t\t\t});\n\n\t\t//On selection of language get code and pass it to preview method\n\t\tthis.language_sel = this.wrapper\n\t\t\t.find(\".languages\")\n\t\t\t.on(\"change\", function () {\n\t\t\t\tme.lang_code = me.language_sel.val()\n\t\t\t\tme.multilingual_preview()\n\t\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-print\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.print_old_style();\n\t\t\t} else {\n\t\t\t\tme.printit();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-preview\").click(function () {\n\t\t\tif (me.is_old_style()) {\n\t\t\t\tme.new_page_preview_old_style();\n\t\t\t} else {\n\t\t\t\tme.new_page_preview();\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-download-pdf\").click(function () {\n\t\t\tif (!me.is_old_style()) {\n\t\t\t\tvar w = window.open(\n\t\t\t\t\tfrappe.urllib.get_full_url(\"/api/method/frappe.utils.print_format.download_pdf?\"\n\t\t\t\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t\t\t\t+ \"&format=\" + encodeURIComponent(me.selected_format())\n\t\t\t\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\"))\n\t\t\t\t);\n\t\t\t\tif (!w) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper.find(\".btn-print-edit\").on(\"click\", function () {\n\t\t\tlet print_format = me.get_print_format();\n\t\t\tlet is_custom_format = print_format.name\n\t\t\t\t&& print_format.print_format_builder\n\t\t\t\t&& print_format.standard === 'No';\n\t\t\tlet is_standard_but_editable = print_format.name && print_format.custom_format;\n\n\t\t\tif (is_standard_but_editable) {\n\t\t\t\tfrappe.set_route(\"Form\", \"Print Format\", print_format.name);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (is_custom_format) {\n\t\t\t\tfrappe.set_route(\"print-format-builder\", print_format.name);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// start a new print format\n\t\t\tfrappe.prompt([\n\t\t\t\t{\n\t\t\t\t\tlabel: __(\"New Print Format Name\"),\n\t\t\t\t\tfieldname: \"print_format_name\",\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Based On'),\n\t\t\t\t\tfieldname: 'based_on',\n\t\t\t\t\tfieldtype: 'Read Only',\n\t\t\t\t\tdefault: print_format.name || 'Standard'\n\t\t\t\t}\n\t\t\t], function (data) {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tmake_new: true,\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: data.print_format_name,\n\t\t\t\t\tbased_on: data.based_on\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"print-format-builder\");\n\t\t\t}, __(\"New Custom Print Format\"), __(\"Start\"));\n\t\t});\n\t},\n\tset_user_lang: function () {\n\t\tthis.lang_code = this.frm.doc.language;\n\t\t// Load all languages in the field\n\t\tthis.language_sel.empty()\n\t\t\t.add_options([{value:'', label:__(\"Select Language...\")}]\n\t\t\t\t.concat(frappe.get_languages()))\n\t\t\t.val(this.lang_code);\n\t\tthis.preview();\n\t},\n\tset_default_print_language: function () {\n \t\tvar print_format = this.get_print_format();\n\t\tthis.lang_code = print_format.default_print_language || frappe.boot.lang;\n\t\tthis.language_sel.val(this.lang_code);\n \t},\n\tmultilingual_preview: function () {\n\t\tvar me = this;\n\t\tif (this.is_old_style()) {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(false);\n\t\t\tme.set_style();\n\t\t\tme.preview_old_style();\n\t\t} else {\n\t\t\tme.wrapper.find(\".btn-download-pdf\").toggle(true);\n\t\t\tme.preview();\n\t\t}\n\t},\n\tpreview: function () {\n\t\tvar me = this;\n\t\tthis.get_print_html(function (out) {\n\t\t\tconst $print_format = me.wrapper.find(\".print-format\");\n\t\t\t$print_format.html(out.html);\n\t\t\tme.show_footer();\n\t\t\tme.set_style(out.style);\n\n\t\t\tconst print_height = $print_format.get(0).offsetHeight;\n\t\t\tconst $message = me.wrapper.find(\".page-break-message\");\n\n\t\t\tconst print_height_inches = frappe.dom.pixel_to_inches(print_height);\n\t\t\t// if contents are large enough, indicate that it will get printed on multiple pages\n\t\t\t// Maximum height for an A4 document is 11.69 inches\n\t\t\tif (print_height_inches > 11.69) {\n\t\t\t\t$message.text(__('This may get printed on multiple pages'));\n\t\t\t} else {\n\t\t\t\t$message.text('');\n\t\t\t}\n\t\t});\n\t},\n\tshow_footer: function() {\n\t\t// footer is hidden by default as reqd by pdf generation\n\t\t// simple hack to show it in print preview\n\t\tthis.wrapper.find('.print-format').css({\n\t\t\tdisplay: 'flex',\n\t\t\tflexDirection: 'column'\n\t\t});\n\t\tthis.wrapper.find('.page-break').css({\n\t\t\t'display': 'flex',\n\t\t\t'flex-direction': 'column',\n\t\t\t'flex': '1'\n\t\t});\n\t\tthis.wrapper.find('#footer-html').attr('style', `\n\t\t\tdisplay: block !important;\n\t\t\torder: 1;\n\t\t\tmargin-top: auto;\n\t\t`);\n\t},\n\tprintit: function () {\n\t\tlet print_server ;\n\t\tvar me = this;\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.printing.doctype.print_settings.print_settings.is_print_server_enabled\",\n\t\t\tcallback: function (data) {\n\t\t\t\tif (data.message) {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\"method\": \"frappe.utils.print_format.print_by_server\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tprint_format:  me.selected_format(),\n\t\t\t\t\t\t\tno_letterhead: me.with_letterhead()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tme.new_page_preview(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tnew_page_preview: function (printit) {\n\t\tvar me = this;\n\t\tvar w = window.open(frappe.urllib.get_full_url(\"/printview?\"\n\t\t\t+ \"doctype=\" + encodeURIComponent(me.frm.doc.doctype)\n\t\t\t+ \"&name=\" + encodeURIComponent(me.frm.doc.name)\n\t\t\t+ (printit ? \"&trigger_print=1\" : \"\")\n\t\t\t+ \"&format=\" + encodeURIComponent(me.selected_format())\n\t\t\t+ \"&no_letterhead=\" + (me.with_letterhead() ? \"0\" : \"1\")\n\t\t\t+ (me.lang_code ? (\"&_lang=\" + me.lang_code) : \"\")));\n\t\tif (!w) {\n\t\t\tfrappe.msgprint(__(\"Please enable pop-ups\")); return;\n\t\t}\n\t},\n\tget_print_html: function (callback) {\n\t\tif (this._req) {\n\t\t\tthis._req.abort();\n\t\t}\n\t\tthis._req = frappe.call({\n\t\t\tmethod: \"frappe.www.printview.get_html_and_style\",\n\t\t\targs: {\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tprint_format: this.selected_format(),\n\t\t\t\tno_letterhead: !this.with_letterhead() ? 1 : 0,\n\t\t\t\t_lang: this.lang_code\n\t\t\t},\n\t\t\tcallback: function (r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tcallback(r.message);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\tpreview_old_style: function () {\n\t\tvar me = this;\n\t\tthis.with_old_style({\n\t\t\tformat: me.print_sel.val(),\n\t\t\tcallback: function (html) {\n\t\t\t\tme.wrapper.find(\".print-format\").html('<div class=\"alert alert-warning\">'\n\t\t\t\t\t+ __(\"Warning: This Print Format is in old style and cannot be generated via the API.\")\n\t\t\t\t\t+ '</div>'\n\t\t\t\t\t+ html);\n\t\t\t},\n\t\t\tno_letterhead: !this.with_letterhead(),\n\t\t\tonly_body: true,\n\t\t\tno_heading: true\n\t\t});\n\t},\n\trefresh_print_options: function () {\n\t\tthis.print_formats = frappe.meta.get_print_formats(this.frm.doctype);\n\t\treturn this.print_sel\n\t\t\t.empty().add_options(this.print_formats);\n\n\t},\n\twith_old_style: function (opts) {\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(opts.format, opts.callback, opts.no_letterhead, opts.only_body, opts.no_heading);\n\t\t});\n\t},\n\tprint_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.go,\n\t\t\t\t!me.with_letterhead());\n\t\t});\n\t},\n\tnew_page_preview_old_style: function () {\n\t\tvar me = this;\n\t\tfrappe.require(\"/assets/js/print_format_v3.min.js\", function () {\n\t\t\t_p.build(me.print_sel.val(), _p.preview, !me.with_letterhead());\n\t\t});\n\t},\n\tselected_format: function () {\n\t\treturn this.print_sel.val() || this.frm.meta.default_print_format || \"Standard\";\n\t},\n\tis_old_style: function (format) {\n\t\treturn this.get_print_format(format).print_format_type === \"Client\";\n\t},\n\tget_print_format: function (format) {\n\t\tif (!format) {\n\t\t\tformat = this.selected_format();\n\t\t}\n\n\t\tif (locals[\"Print Format\"] && locals[\"Print Format\"][format]) {\n\t\t\treturn locals[\"Print Format\"][format]\n\t\t} else {\n\t\t\treturn {}\n\t\t}\n\t},\n\twith_letterhead: function () {\n\t\treturn this.print_letterhead.is(\":checked\") ? 1 : 0;\n\t},\n\tset_style: function (style) {\n\t\tfrappe.dom.set_style(style || frappe.boot.print_css, \"print-style\");\n\t}\n});\n\nfrappe.ui.get_print_settings = function (pdf, callback, letter_head) {\n\tvar print_settings = locals[\":Print Settings\"][\"Print Settings\"];\n\n\tvar default_letter_head = locals[\":Company\"] && frappe.defaults.get_default('company')\n\t\t? locals[\":Company\"][frappe.defaults.get_default('company')][\"default_letter_head\"]\n\t\t: '';\n\n\tvar columns = [{\n\t\tfieldtype: \"Check\",\n\t\tfieldname: \"with_letter_head\",\n\t\tlabel: __(\"With Letter head\")\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"letter_head\",\n\t\tlabel: __(\"Letter Head\"),\n\t\tdepends_on: \"with_letter_head\",\n\t\toptions: $.map(frappe.boot.letter_heads, function (i, d) { return d }),\n\t\tdefault: letter_head || default_letter_head\n\t}, {\n\t\tfieldtype: \"Select\",\n\t\tfieldname: \"orientation\",\n\t\tlabel: __(\"Orientation\"),\n\t\toptions: \"Landscape\\nPortrait\",\n\t\tdefault: \"Landscape\"\n\t}];\n\n\tfrappe.prompt(columns, function (data) {\n\t\tvar data = $.extend(print_settings, data);\n\t\tif (!data.with_letter_head) {\n\t\t\tdata.letter_head = null;\n\t\t}\n\t\tif (data.letter_head) {\n\t\t\tdata.letter_head = frappe.boot.letter_heads[print_settings.letter_head];\n\t\t}\n\t\tcallback(data);\n\t}, __(\"Print Settings\"));\n}\n","frappe.provide(\"frappe.ui.form\");\nfrappe.ui.form.Sidebar = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\n\tmake: function() {\n\t\tvar sidebar_content = frappe.render_template(\"form_sidebar\", {doctype: this.frm.doctype, frm:this.frm});\n\n\t\tthis.sidebar = $('<div class=\"form-sidebar overlay-sidebar hidden-xs hidden-sm\"></div>')\n\t\t\t.html(sidebar_content)\n\t\t\t.appendTo(this.page.sidebar.empty());\n\n\t\tthis.ratings = this.sidebar.find(\".sidebar-rating\");\n\t\tthis.comments = this.sidebar.find(\".sidebar-comments\");\n\t\tthis.user_actions = this.sidebar.find(\".user-actions\");\n\t\tthis.image_section = this.sidebar.find(\".sidebar-image-section\");\n\t\tthis.image_wrapper = this.image_section.find('.sidebar-image-wrapper');\n\n\t\tthis.make_assignments();\n\t\tthis.make_attachments();\n\t\tthis.make_shared();\n\t\tthis.make_viewers();\n\t\tthis.make_tags();\n\t\tthis.make_like();\n\n\t\tthis.bind_events();\n\t\tfrappe.ui.form.setup_user_image_event(this.frm);\n\n\t\tthis.refresh();\n\n\t},\n\n\tbind_events: function() {\n\t\tvar me = this;\n\n\t\t// scroll to comments\n\t\tthis.comments.on(\"click\", function() {\n\t\t\tfrappe.utils.scroll_to(me.frm.footer.wrapper.find(\".form-comments\"), true);\n\t\t});\n\n\t\tthis.like_icon.on(\"click\", function() {\n\t\t\tfrappe.ui.toggle_like(me.like_icon, me.frm.doctype, me.frm.doc.name, function() {\n\t\t\t\tme.refresh_like();\n\t\t\t});\n\t\t})\n\t},\n\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.sidebar.toggle(false);\n\t\t} else {\n\t\t\tthis.sidebar.toggle(true);\n\t\t\tthis.frm.assign_to.refresh();\n\t\t\tthis.frm.attachments.refresh();\n\t\t\tthis.frm.shared.refresh();\n\t\t\tthis.frm.viewers.refresh();\n\t\t\tthis.frm.tags && this.frm.tags.refresh(this.frm.doc._user_tags);\n\t\t\tthis.sidebar.find(\".modified-by\").html(__(\"{0} edited this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.modified_by) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.modified)]));\n\t\t\tthis.sidebar.find(\".created-by\").html(__(\"{0} created this {1}\",\n\t\t\t\t[\"<strong>\" + frappe.user.full_name(this.frm.doc.owner) + \"</strong>\",\n\t\t\t\t\t\"<br>\" + comment_when(this.frm.doc.creation)]));\n\n\t\t\tthis.refresh_like();\n\t\t\tthis.setup_ratings();\n\t\t\tfrappe.ui.form.set_user_image(this.frm);\n\t\t}\n\t},\n\n\trefresh_comments: function() {\n\t\t$.map(this.frm.timeline.get_communications(), function(c) {\n\t\t\treturn (c.communication_type===\"Communication\" || (c.communication_type==\"Comment\" && c.comment_type===\"Comment\")) ? c : null;\n\t\t});\n\t\tthis.comments.find(\".n-comments\").html(this.frm.get_docinfo().total_comments);\n\t},\n\n\tmake_tags: function() {\n\t\tvar me = this;\n\t\tif (this.frm.meta.issingle) {\n\t\t\tthis.sidebar.find(\".form-tags\").toggle(false);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm.tags = new frappe.ui.TagEditor({\n\t\t\tparent: this.sidebar.find(\".tag-area\"),\n\t\t\tfrm: this.frm,\n\t\t\ton_change: function(user_tags) {\n\t\t\t\tme.frm.doc._user_tags = user_tags;\n\t\t\t}\n\t\t});\n\t},\n\tmake_attachments: function() {\n\t\tvar me = this;\n\t\tthis.frm.attachments = new frappe.ui.form.Attachments({\n\t\t\tparent: me.sidebar.find(\".form-attachments\"),\n\t\t\tfrm: me.frm\n\t\t});\n\t},\n\tmake_assignments: function() {\n\t\tthis.frm.assign_to = new frappe.ui.form.AssignTo({\n\t\t\tparent: this.sidebar.find(\".form-assignments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\tmake_shared: function() {\n\t\tthis.frm.shared = new frappe.ui.form.Share({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-shared\")\n\t\t});\n\t},\n\tmake_viewers: function() {\n\t\tthis.frm.viewers = new frappe.ui.form.Viewers({\n\t\t\tfrm: this.frm,\n\t\t\tparent: this.sidebar.find(\".form-viewers\")\n\t\t});\n\t},\n\tadd_user_action: function(label, click) {\n\t\treturn $('<a>').html(label).appendTo($('<li class=\"user-action-row\">')\n\t\t\t.appendTo(this.user_actions.removeClass(\"hidden\"))).on(\"click\", click);\n\t},\n\tclear_user_actions: function() {\n\t\tthis.user_actions.addClass(\"hidden\")\n\t\tthis.user_actions.find(\".user-action-row\").remove();\n\t},\n\n\tmake_like: function() {\n\t\tthis.like_wrapper = this.sidebar.find(\".liked-by\");\n\t\tthis.like_icon = this.sidebar.find(\".liked-by .octicon-heart\");\n\t\tthis.like_count = this.sidebar.find(\".liked-by .likes-count\");\n\t\tfrappe.ui.setup_like_popover(this.sidebar.find(\".liked-by-parent\"), \".liked-by\");\n\t},\n\n\trefresh_like: function() {\n\t\tif (!this.like_icon) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.like_wrapper.attr(\"data-liked-by\", this.frm.doc._liked_by);\n\n\t\tthis.like_icon.toggleClass(\"text-extra-muted not-liked\",\n\t\t\t!frappe.ui.is_liked(this.frm.doc))\n\t\t\t.attr(\"data-doctype\", this.frm.doctype)\n\t\t\t.attr(\"data-name\", this.frm.doc.name);\n\n\t\tthis.like_count.text(JSON.parse(this.frm.doc._liked_by || \"[]\").length);\n\t},\n\n\trefresh_image: function() {\n\t},\n\n\tsetup_ratings: function() {\n\t\tvar _ratings = this.frm.get_docinfo().rating || 0;\n\n\t\tif(_ratings) {\n\t\t\tthis.ratings.removeClass(\"hide\");\n\t\t\tvar rating_icons = frappe.render_template(\"rating_icons\", {rating: _ratings, show_label: false});\n\t\t\tthis.ratings.find(\".rating-icons\").html(rating_icons);\n\t\t}\n\t}\n});\n","frappe.ui.form.set_user_image = function(frm) {\n\n\tvar image_section = frm.sidebar.image_section;\n\tvar image_field = frm.meta.image_field;\n\tvar image = frm.doc[image_field];\n\tvar title_image = frm.page.$title_area.find('.title-image');\n\n\n\timage_section.toggleClass('hide', image_field ? false : true);\n\ttitle_image.toggleClass('hide', image_field ? false : true);\n\n\tif(!image_field) {\n\t\treturn;\n\t}\n\n\t// if image field has value\n\tif (image) {\n\t\timage = (window.cordova && image.indexOf('http')===-1) ?\n\t\t\tfrappe.base_url + image : image;\n\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.removeClass(\"hide\");\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.addClass('hide');\n\n\t\ttitle_image\n\t\t\t.css('background-color', '')\n\t\t\t.css(\"background-image\", 'url(\"' + image + '\")')\n\t\t\t.html('');\n\n\t} else {\n\t\timage_section\n\t\t\t.find(\".sidebar-image\")\n\t\t\t.css(\"background-image\", null)\n\t\t\t.addClass(\"hide\");\n\n\t\tvar title = frm.get_title();\n\n\t\timage_section\n\t\t\t.find('.sidebar-standard-image')\n\t\t\t.removeClass('hide')\n\t\t\t.find('.standard-image')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t\ttitle_image.css(\"background-image\", '')\n\t\t\t.css({'background-color': frappe.get_palette(title)})\n\t\t\t.html(frappe.get_abbr(title));\n\n\t}\n\n}\n\nfrappe.ui.form.setup_user_image_event = function(frm) {\n\t// re-draw image on change of user image\n\tif(frm.meta.image_field) {\n\t\tfrappe.ui.form.on(frm.doctype, frm.meta.image_field, function(frm) {\n\t\t\tfrappe.ui.form.set_user_image(frm);\n\t\t});\n\t}\n\n\t// bind click on image_wrapper\n\tfrm.sidebar.image_wrapper.on('click', function() {\n\t\tvar field = frm.get_field(frm.meta.image_field);\n\t\tif(!field.$input) {\n\t\t\tfield.make_input();\n\t\t}\n\t\tfield.$input.trigger('click');\n\t});\n}","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Share = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\trefresh: function() {\n\t\tthis.render_sidebar();\n\t},\n\trender_sidebar: function() {\n\t\tvar me = this;\n\t\tthis.parent.empty();\n\n\t\tvar shared = this.shared || this.frm.get_docinfo().shared;\n\t\tshared = shared.filter(function(d) { return d });\n\t\tvar users = [];\n\t\tfor (var i=0, l=shared.length; i < l; i++) {\n\t\t\tvar s = shared[i];\n\n\t\t\tif (s.everyone) {\n\t\t\t\tusers.push({\n\t\t\t\t\ticon: \"octicon octicon-megaphone text-muted\",\n\t\t\t\t\tavatar_class: \"avatar-empty share-doc-btn shared-with-everyone\",\n\t\t\t\t\ttitle: __(\"Shared with everyone\")\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar user_info = frappe.user_info(s.user);\n\t\t\t\tusers.push({\n\t\t\t\t\timage: user_info.image,\n\t\t\t\t\tfullname: user_info.fullname,\n\t\t\t\t\tabbr: user_info.abbr,\n\t\t\t\t\tcolor: user_info.color,\n\t\t\t\t\ttitle: __(\"Shared with {0}\", [user_info.fullname])\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!me.frm.doc.__islocal) {\n\t\t\tusers.push({\n\t\t\t\ticon: \"octicon octicon-plus text-muted\",\n\t\t\t\tavatar_class: \"avatar-empty share-doc-btn\",\n\t\t\t\ttitle: __(\"Share\")\n\t\t\t});\n\t\t}\n\n\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\tthis.parent.find(\".avatar\").on(\"click\", function() {\n\t\t\tme.frm.share_doc();\n\t\t});\n\t},\n\tshow: function() {\n\t\tvar me = this;\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Share {0} with\", [this.frm.doc.name]),\n\t\t});\n\n\t\tthis.dialog = d;\n\t\tthis.dirty = false;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.share.get_users\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.frm.doctype,\n\t\t\t\tname: this.frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tme.render_shared(r.message || []);\n\t\t\t}\n\t\t});\n\n\t\t$(d.body).html('<p class=\"text-muted\">' + __(\"Loading...\") + '</p>');\n\n\t\td.onhide = function() {\n\t\t\t// reload comments\n\t\t\tif(me.dirty) me.frm.reload_docinfo();\n\t\t}\n\n\t\td.show();\n\t},\n\trender_shared: function(shared) {\n\t\tif(shared)\n\t\t\tthis.shared = shared;\n\t\tvar d = this.dialog;\n\t\t$(d.body).empty();\n\n\t\tvar everyone = {};\n\t\t$.each(this.shared, function(i, s) {\n\t\t\t// pullout everyone record from shared list\n\t\t\tif (s && s.everyone) {\n\t\t\t\teveryone = s;\n\t\t\t}\n\t\t});\n\n\t\t$(frappe.render_template(\"set_sharing\", {frm: this.frm, shared: this.shared, everyone: everyone}))\n\t\t\t.appendTo(d.body);\n\n\t\tif(frappe.model.can_share(null, this.frm)) {\n\t\t\tthis.make_user_input();\n\t\t\tthis.add_share_button();\n\t\t\tthis.set_edit_share_events();\n\t\t} else {\n\t\t\t// if cannot share, disable sharing settings.\n\t\t\t$(d.body).find(\".edit-share\").prop(\"disabled\", true);\n\t\t}\n\t},\n\tmake_user_input: function() {\n\t\t// make add-user input\n\t\tthis.dialog.share_with = frappe.ui.form.make_control({\n\t\t\tparent: $(this.dialog.body).find(\".input-wrapper-add-share\"),\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tlabel: __(\"Share With\"),\n\t\t\t\tfieldname: \"share_with\",\n\t\t\t\toptions: \"User\",\n\t\t\t\tfilters: {\n\t\t\t\t\t\"user_type\": \"System User\",\n\t\t\t\t\t\"name\": [\"!=\", frappe.session.user]\n\t\t\t\t}\n\t\t\t},\n\t\t\tonly_input: true,\n\t\t\trender_input: true\n\t\t});\n\n\t},\n\tadd_share_button: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".btn-add-share\").on(\"click\", function() {\n\t\t\tvar user = d.share_with.get_value();\n\t\t\tif(!user) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.add\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tread: $(d.body).find(\".add-share-read\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\twrite: $(d.body).find(\".add-share-write\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tshare: $(d.body).find(\".add-share-share\").prop(\"checked\") ? 1 : 0,\n\t\t\t\t\tnotify: $(d.body).find(\".add-share-notify\").prop(\"checked\") ? 1 : 0\n\t\t\t\t},\n\t\t\t\tbtn: this,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\tif(s && s.user===r.message.user) {\n\t\t\t\t\t\t\t// re-adding / remove the old share rule.\n\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tset_edit_share_events: function() {\n\t\tvar me = this, d = this.dialog;\n\t\t$(d.body).find(\".edit-share\").on(\"click\", function() {\n\t\t\tvar user = $(this).parents(\".shared-user:first\").attr(\"data-user\") || \"\",\n\t\t\t\tvalue = $(this).prop(\"checked\") ? 1 : 0,\n\t\t\t\tproperty = $(this).attr(\"name\"),\n\t\t\t\teveryone = cint($(this).parents(\".shared-user:first\").attr(\"data-everyone\"));\n\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.share.set_permission\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tuser: user,\n\t\t\t\t\tpermission_to: property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\teveryone: everyone\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tvar found = null;\n\t\t\t\t\t$.each(me.shared, function(i, s) {\n\t\t\t\t\t\t// update shared object\n\t\t\t\t\t\tif(s && (s.user===user || (everyone && s.everyone===1))) {\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdelete me.shared[i];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tme.shared[i] = $.extend(s, r.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!found) {\n\t\t\t\t\t\tme.shared.push(r.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tme.dirty = true;\n\t\t\t\t\tme.render_shared();\n\t\t\t\t\tme.frm.shared.refresh();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n});\n","frappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Viewers = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t},\n\tget_viewers: function() {\n\t\tlet docinfo = this.frm.get_docinfo();\n\t\tif (docinfo) {\n\t\t\treturn docinfo.viewers || {};\n\t\t} else {\n\t\t\treturn {};\n\t\t}\n\t},\n\trefresh: function(data_updated) {\n\t\tthis.parent.empty();\n\n\t\tvar viewers = this.get_viewers();\n\n\t\tvar users = [];\n\t\tvar new_users = [];\n\t\tfor (var i=0, l=(viewers.current || []).length; i < l; i++) {\n\t\t\tvar username = viewers.current[i];\n\t\t\tif (username===frappe.session.user) {\n\t\t\t\t// current user\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tvar user_info = frappe.user_info(username);\n\t\t\tusers.push({\n\t\t\t\timage: user_info.image,\n\t\t\t\tfullname: user_info.fullname,\n\t\t\t\tabbr: user_info.abbr,\n\t\t\t\tcolor: user_info.color,\n\t\t\t\ttitle: __(\"{0} is currently viewing this document\", [user_info.fullname])\n\t\t\t});\n\n\t\t\tif (viewers.new.indexOf(username)!==-1) {\n\t\t\t\tnew_users.push(user_info.fullname);\n\t\t\t}\n\t\t}\n\n\t\tif (users.length) {\n\t\t\tthis.parent.parent().removeClass(\"hidden\");\n\t\t\tthis.parent.append(frappe.render_template(\"users_in_sidebar\", {\"users\": users}));\n\t\t} else {\n\t\t\tthis.parent.parent().addClass(\"hidden\");\n\t\t}\n\n\t\tif (data_updated && new_users.length) {\n\t\t\t// new user viewing this document, who wasn't viewing in the past\n\t\t\tif (new_users.length===1) {\n\t\t\t\tfrappe.show_alert(__(\"{0} is currently viewing this document\", [new_users[0]]));\n\t\t\t} else {\n\t\t\t\tfrappe.show_alert(__(\"{0} are currently viewing this document\", [frappe.utils.comma_and(new_users)]));\n\t\t\t}\n\n\t\t}\n\t}\n});\n\nfrappe.ui.form.set_viewers = function(data) {\n\tvar doctype = data.doctype;\n\tvar docname = data.docname;\n\tvar docinfo = frappe.model.get_docinfo(doctype, docname);\n\tvar past_viewers = ((docinfo && docinfo.viewers) || {}).past || [];\n\tvar viewers = data.viewers || [];\n\n\tvar new_viewers = viewers.filter(viewer => !past_viewers.includes(viewer));\n\n\tfrappe.model.set_docinfo(doctype, docname, \"viewers\", {\n\t\tpast: past_viewers.concat(new_viewers),\n\t\tnew: new_viewers,\n\t\tcurrent: viewers\n\t});\n\n\tif (cur_frm && cur_frm.doc && cur_frm.doc.doctype===doctype && cur_frm.doc.name==docname) {\n\t\tcur_frm.viewers.refresh(true);\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.ui.form.Footer = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t\tthis.make_comments();\n\t\t// render-complete\n\t\t$(this.frm.wrapper).on(\"render_complete\", function() {\n\t\t\tme.refresh();\n\t\t});\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"form_footer\", {}))\n\t\t\t.appendTo(this.parent);\n\t\tthis.wrapper.find(\".btn-save\").click(function() {\n\t\t\tme.frm.save('Save', null, this);\n\t\t})\n\n\t},\n\tmake_comments: function() {\n\t\tthis.frm.timeline = new frappe.ui.form.Timeline({\n\t\t\tparent: this.wrapper.find(\".form-comments\"),\n\t\t\tfrm: this.frm\n\t\t});\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.addClass(\"hide\");\n\t\t} else {\n\t\t\tthis.parent.removeClass(\"hide\");\n\t\t\tthis.frm.timeline.refresh();\n\t\t}\n\t},\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.Attachments = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t},\n\tmake: function() {\n\t\tvar me = this;\n\t\tthis.parent.find(\".add-attachment\").click(function() {\n\t\t\tme.new_attachment();\n\t\t});\n\t\tthis.add_attachment_wrapper = this.parent.find(\".add_attachment\").parent();\n\t\tthis.attachments_label = this.parent.find(\".attachments-label\");\n\t},\n\tmax_reached: function() {\n\t\t// no of attachments\n\t\tvar n = Object.keys(this.get_attachments()).length;\n\n\t\t// button if the number of attachments is less than max\n\t\tif(n < this.frm.meta.max_attachments || !this.frm.meta.max_attachments) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\trefresh: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.parent.find(\".attachment-row\").remove();\n\n\t\tvar max_reached = this.max_reached();\n\t\tthis.add_attachment_wrapper.toggleClass(\"hide\", !max_reached);\n\n\t\t// add attachment objects\n\t\tvar attachments = this.get_attachments();\n\t\tif(attachments.length) {\n\t\t\tattachments.forEach(function(attachment) {\n\t\t\t\tme.add_attachment(attachment)\n\t\t\t});\n\t\t} else {\n\t\t\tthis.attachments_label.removeClass(\"has-attachments\");\n\t\t}\n\n\t},\n\tget_attachments: function() {\n\t\treturn this.frm.get_docinfo().attachments;\n\t},\n\tadd_attachment: function(attachment) {\n\t\tvar file_name = attachment.file_name;\n\t\tvar file_url = this.get_file_url(attachment);\n\t\tvar fileid = attachment.name;\n\t\tif (!file_name) {\n\t\t\tfile_name = file_url;\n\t\t}\n\n\t\tvar me = this;\n\n\t\tvar $attach = $(frappe.render_template(\"attachment\", { \n\t\t\t\"file_path\": \"/desk#Form/File/\" + fileid,\n\t\t\t\"icon\": attachment.is_private ? \"fa fa-lock\" : \"fa fa-unlock-alt\",\n\t\t\t\"file_name\": file_name,\n\t\t\t\"file_url\": frappe.urllib.get_full_url(file_url)\n\t\t})).insertAfter(this.attachments_label.addClass(\"has-attachments\"));\t\t\t\n\n\t\tvar $close =\n\t\t\t$attach.find(\".close\")\n\t\t\t.data(\"fileid\", fileid)\n\t\t\t.click(function() {\n\t\t\t\tvar remove_btn = this;\n\t\t\t\tfrappe.confirm(__(\"Are you sure you want to delete the attachment?\"),\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tme.remove_attachment($(remove_btn).data(\"fileid\"))\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\treturn false\n\t\t\t});\n\n\t\tif(!frappe.model.can_write(this.frm.doctype, this.frm.name)) {\n\t\t\t$close.remove();\n\t\t}\n\t},\n\tget_file_url: function(attachment) {\n\t\tvar file_url = attachment.file_url;\n\t\tif (!file_url) {\n\t\t\tif (attachment.file_name.indexOf('files/') === 0) {\n\t\t\t\tfile_url = '/' + attachment.file_name;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfile_url = '/files/' + attachment.file_name;\n\t\t\t}\n\t\t}\n\t\t// hash is not escaped, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI\n\t\treturn encodeURI(file_url).replace(/#/g, '%23');\n\t},\n\tget_file_id_from_file_url: function(file_url) {\n\t\tvar fid;\n\t\t$.each(this.get_attachments(), function(i, attachment) {\n\t\t\tif (attachment.file_url === file_url) {\n\t\t\t\tfid = attachment.name;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\treturn fid;\n\t},\n\tremove_attachment_by_filename: function(filename, callback) {\n\t\tthis.remove_attachment(this.get_file_id_from_file_url(filename), callback);\n\t},\n\tremove_attachment: function(fileid, callback) {\n\t\tif (!fileid) {\n\t\t\tif (callback) callback();\n\t\t\treturn;\n\t\t}\n\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.remove_attach',\n\t\t\targs: {\n\t\t\t\tfid: fileid,\n\t\t\t\tdt: me.frm.doctype,\n\t\t\t\tdn: me.frm.docname\n\t\t\t},\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(r.exc) {\n\t\t\t\t\tif(!r._server_messages)\n\t\t\t\t\t\tfrappe.msgprint(__(\"There were errors\"));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tme.remove_fileid(fileid);\n\t\t\t\tme.frm.get_docinfo().communications.push(r.message);\n\t\t\t\tme.frm.timeline && me.frm.timeline.refresh();\n\t\t\t\tif (callback) callback();\n\t\t\t}\n\t\t});\n\t},\n\tnew_attachment: function(fieldname) {\n\t\tvar me = this;\n\t\tif (this.dialog) {\n\t\t\t// remove upload dialog\n\t\t\tthis.dialog.$wrapper.remove();\n\t\t}\n\n\t\t// make upload dialog\n\t\tthis.dialog = frappe.ui.get_upload_dialog({\n\t\t\t\"args\": me.get_args(),\n\t\t\t\"callback\": function(attachment, r) { me.attachment_uploaded(attachment, r) },\n\t\t\t\"max_width\": me.frm.cscript ? me.frm.cscript.attachment_max_width : null,\n\t\t\t\"max_height\": me.frm.cscript ? me.frm.cscript.attachment_max_height : null\n\t\t});\n\t},\n\tget_args: function() {\n\t\treturn {\n\t\t\tfrom_form: 1,\n\t\t\tdoctype: this.frm.doctype,\n\t\t\tdocname: this.frm.docname,\n\t\t}\n\t},\n\tattachment_uploaded:  function(attachment, r) {\n\t\tthis.dialog && this.dialog.hide();\n\t\tthis.update_attachment(attachment, r.message.comment);\n\n\t\tif(this.fieldname) {\n\t\t\tthis.frm.set_value(this.fieldname, attachment.file_url);\n\t\t}\n\t},\n\tupdate_attachment: function(attachment, comment) {\n\t\tif(attachment.name) {\n\t\t\tthis.add_to_attachments(attachment);\n\t\t\tthis.refresh();\n\t\t\tif(comment) {\n\t\t\t\tthis.frm.get_docinfo().communications.push(comment);\n\t\t\t\tthis.frm.timeline.refresh();\n\t\t\t}\n\t\t}\n\t},\n\tadd_to_attachments: function (attachment) {\n\t\tvar form_attachments = this.get_attachments();\n\t\tfor(var i in form_attachments) {\n\t\t\t// prevent duplicate\n\t\t\tif(form_attachments[i][\"name\"] === attachment.name) return;\n\t\t}\n\t\tform_attachments.push(attachment);\n\t},\n\tremove_fileid: function(fileid) {\n\t\tvar attachments = this.get_attachments();\n\t\tvar new_attachments = [];\n\t\t$.each(attachments, function(i, attachment) {\n\t\t\tif(attachment.name!=fileid) {\n\t\t\t\tnew_attachments.push(attachment);\n\t\t\t}\n\t\t});\n\t\tthis.frm.get_docinfo().attachments = new_attachments;\n\t\tthis.refresh();\n\t}\n});\n\nfrappe.ui.get_upload_dialog = function(opts){\n\tvar dialog = new frappe.ui.Dialog({\n\t\ttitle: __('Upload Attachment'),\n\t\tno_focus: true,\n\t\tfields: [\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Section Break\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"file\" ,\n\t\t\t\t\"label\": __(\"Select uploaded file\"),\n\t\t\t\t\"options\": \"File\",\n\t\t\t\tonchange: function() {\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t'method': 'frappe.client.get_value',\n\t\t\t\t\t\t'args': {\n\t\t\t\t\t\t\t'doctype': 'File',\n\t\t\t\t\t\t\t'fieldname': ['file_url','file_name','is_private'],\n\t\t\t\t\t\t\t'filters': {\n\t\t\t\t\t\t\t\t'name': dialog.get_value(\"file\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r){\n\t\t\t\t\t\t\tif(!r.message) {\n\t\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(\"\");\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdialog.$wrapper.find('[name=\"file_url\"]').val(r.message.file_url);\n\t\t\t\t\t\t\tdialog.$wrapper.find('.private-file input').prop('checked', r.message.is_private);\n\t\t\t\t\t\t\topts.args.filename = r.message.file_name;\n\t\t\t\t\t\t\topts.args.is_private = r.message.is_private;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"hidden\": !opts.args.doctype || !frappe.boot.gsuite_enabled,\n\t\t\t\t\"fieldtype\": \"Section Break\",\n\t\t\t\t\"label\": __(\"GSuite Document\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"fieldtype\": \"Link\" ,\n\t\t\t\t\"fieldname\": \"gs_template\" ,\n\t\t\t\t\"label\": __(\"Select template\"),\n\t\t\t\t\"options\": \"GSuite Templates\",\n\t\t\t\t\"reqd\" : false,\n\t\t\t\t\"filters\": {\n\t\t\t\t\t'related_doctype': opts.args.doctype\n\t\t\t\t},\n\t\t\t\tonchange: function(){\n\t\t\t\t\topts.args.gs_template = this.get_value();\n\t\t\t\t}\n\t\t\t},\n\t\t],\n\t});\n\n\n\n\n\tvar btn = dialog.set_primary_action(__(\"Attach\"));\n\tbtn.removeClass(\"btn-primary\").addClass(\"btn-default\");\n\n\tdialog.show();\n\tvar upload_area = $('<div></div>').prependTo(dialog.body);\n\n\t\n\n\tfrappe.upload.make({\n\t\tparent: upload_area,\n\t\targs: opts.args,\n\t\tcallback: function(attachment, r) {\n\t\t\tdialog.hide();\n\t\t\tif(opts.callback){\n\t\t\t\topts.callback(attachment, r);\n\t\t\t}\n\t\t},\n\t\ton_select: function() {\n\t\t\tbtn.removeClass(\"btn-default\").addClass(\"btn-primary\");\n\t\t},\n\t\tonerror: function() {\n\t\t\tdialog.hide();\n\t\t},\n\t\tbtn: btn,\n\t\tmax_width: opts.max_width,\n\t\tmax_height: opts.max_height,\n\t});\n\n\treturn dialog;\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide('frappe.timeline');\nfrappe.separator_element = '<div>---</div>';\n\nfrappe.ui.form.Timeline = class Timeline {\n\tconstructor(opts) {\n\t\t$.extend(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tvar me = this;\n\t\tthis.wrapper = $(frappe.render_template(\"timeline\",\n\t\t\t{doctype: me.frm.doctype, allow_events_in_timeline: me.frm.meta.allow_events_in_timeline})).appendTo(me.parent);\n\n\t\tthis.list = this.wrapper.find(\".timeline-items\");\n\n\t\tthis.comment_area = frappe.ui.form.make_control({\n\t\t\tparent: this.wrapper.find('.timeline-head'),\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\ton_submit: (val) => {\n\t\t\t\tval && this.insert_comment(\"Comment\", val, this.comment_area.button);\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_email_button();\n\t\tthis.setup_interaction_button();\n\n\t\tthis.list.on(\"click\", \".toggle-blockquote\", function() {\n\t\t\t$(this).parent().siblings(\"blockquote\").toggleClass(\"hidden\");\n\t\t});\n\n\t\tthis.setup_comment_like();\n\n\t\tthis.list.on(\"click\", \".btn-more\", function() {\n\t\t\tvar communications = me.get_communications();\n\t\t\tfrappe.call({\n\t\t\t\tbtn: this,\n\t\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\tstart: communications.length\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tvar new_communications = r.message;\n\t\t\t\t\t\t\tvar communications = me.get_communications().concat(new_communications);\n\t\t\t\t\t\t\tfrappe.model.set_docinfo(me.frm.doc.doctype, me.frm.doc.name, \"communications\", communications);\n\n\t\t\t\t\t\t\tif (new_communications.length < 20) {\n\t\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.more = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t}\n\n\tsetup_email_button() {\n\t\tvar me = this;\n\t\tvar selector = this.frm.doctype === \"Communication\"? \".btn-reply-email\": \".btn-new-email\";\n\t\tthis.email_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tconst $btn = $(this);\n\t\t\t\tlet is_a_reply = true;\n\t\t\t\tif ($btn.is('.btn-new-email')) {\n\t\t\t\t\tis_a_reply = false;\n\t\t\t\t}\n\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient(),\n\t\t\t\t\tis_a_reply\n\t\t\t\t}\n\n\t\t\t\tif(me.frm.doctype === \"Communication\") {\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: \"\",\n\t\t\t\t\t\tlast_email: me.frm.doc,\n\t\t\t\t\t\trecipients: me.frm.doc.sender,\n\t\t\t\t\t\tsubject: __(\"Re: {0}\", [me.frm.doc.subject]),\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst comment_value = frappe.markdown(me.comment_area.get_value());\n\t\t\t\t\t$.extend(args, {\n\t\t\t\t\t\ttxt: strip_html(comment_value) ? comment_value : ''\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tnew frappe.views.CommunicationComposer(args)\n\t\t\t});\n\t}\n\n\tsetup_interaction_button() {\n\t\tvar me = this;\n\t\tvar selector = \".btn-new-interaction\";\n\t\tthis.activity_button = this.wrapper.find(selector)\n\t\t\t.on(\"click\", function() {\n\t\t\t\tvar args = {\n\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\tfrm: me.frm,\n\t\t\t\t\trecipients: me.get_recipient()\n\t\t\t\t}\n\t\t\t\t$.extend(args, {\n\t\t\t\t\ttxt: frappe.markdown(me.comment_area.get_value())\n\t\t\t\t});\n\t\t\t\tnew frappe.views.InteractionComposer(args);\n\t\t\t});\n\t}\n\n\tsetup_editing_area() {\n\t\tthis.$editing_area = $('<div class=\"timeline-editing-area\">');\n\n\t\tthis.editing_area = new frappe.ui.CommentArea({\n\t\t\tparent: this.$editing_area,\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\tno_wrapper: true\n\t\t});\n\n\t\tthis.editing_area.destroy();\n\t}\n\n\trefresh(scroll_to_end) {\n\t\tvar me = this;\n\t\tthis.last_type = \"Comment\";\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.wrapper.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.wrapper.toggle(true);\n\t\tthis.list.empty();\n\t\tthis.comment_area.set_value('');\n\t\tlet communications = this.get_communications(true);\n\t\tvar views = this.get_view_logs();\n\n\t\tvar timeline = communications.concat(views);\n\t\ttimeline\n\t\t\t.filter(a => a.content)\n\t\t\t.sort((b, c) => me.compare_dates(b, c))\n\t\t\t.forEach(d => {\n\t\t\t\td.frm = me.frm;\n\t\t\t\tme.render_timeline_item(d);\n\t\t\t});\n\n\n\n\t\t// more btn\n\t\tif (this.more===undefined && timeline.length===20) {\n\t\t\tthis.more = true;\n\t\t}\n\n\t\tif (this.more) {\n\t\t\t$('<div class=\"timeline-item\">\\\n\t\t\t\t<button class=\"btn btn-default btn-xs btn-more\">More</button>\\\n\t\t\t</div>').appendTo(me.list);\n\t\t}\n\n\t\t// created\n\t\tme.render_timeline_item({\n\t\t\tcontent: __(\"created\"),\n\t\t\tcomment_type: \"Created\",\n\t\t\tcommunication_type: \"Comment\",\n\t\t\tsender: this.frm.doc.owner,\n\t\t\tcommunication_date: this.frm.doc.creation,\n\t\t\tcreation: this.frm.doc.creation,\n\t\t\tfrm: this.frm\n\t\t});\n\n\t\tthis.wrapper.find(\".is-email\").prop(\"checked\", this.last_type===\"Email\").change();\n\n\t\tthis.frm.sidebar.refresh_comments();\n\n\t\tthis.frm.trigger('timeline_refresh');\n\t}\n\n\tcompare_dates(b, c) {\n\t\tlet b_date = b.communication_date ? b.communication_date : b.creation;\n\t\tlet c_date = c.communication_date ? c.communication_date : c.creation;\n\t\tlet comparison = new Date(b_date) > new Date(c_date) ? -1 : 1;\n\t\treturn comparison;\n\t}\n\n\tmake_editing_area(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: 'Comment',\n\t\t\t\tfieldname: 'comment',\n\t\t\t\tlabel: 'Comment'\n\t\t\t},\n\t\t\tmentions: this.get_names_for_mentions(),\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true\n\t\t});\n\t}\n\n\trender_timeline_item(c) {\n\t\tvar me = this;\n\t\tthis.prepare_timeline_item(c);\n\t\tvar $timeline_item = $(frappe.render_template(\"timeline_item\", {data:c, frm:this.frm}))\n\t\t\t.appendTo(me.list)\n\t\t\t.on(\"click\", \".delete-comment\", function() {\n\t\t\t\tvar name = $timeline_item.data('name');\n\t\t\t\tme.delete_comment(name);\n\t\t\t\treturn false;\n\t\t\t})\n\t\t\t.on('click', '.edit-comment', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar name = $timeline_item.data('name');\n\n\t\t\t\tif($timeline_item.hasClass('is-editing')) {\n\t\t\t\t\tme.current_editing_area.submit();\n\t\t\t\t} else {\n\t\t\t\t\tconst $edit_btn = $(this);\n\t\t\t\t\tconst $timeline_content = $timeline_item.find('.timeline-item-content');\n\t\t\t\t\tconst $timeline_edit = $timeline_item.find('.timeline-item-edit');\n\t\t\t\t\tconst content = $timeline_content.html();\n\n\t\t\t\t\t// update state\n\t\t\t\t\t$edit_btn\n\t\t\t\t\t\t.text(__(\"Save\"))\n\t\t\t\t\t\t.find('i')\n\t\t\t\t\t\t.removeClass('octicon-pencil')\n\t\t\t\t\t\t.addClass('octicon-check');\n\t\t\t\t\t$timeline_content.hide();\n\t\t\t\t\t$timeline_item.addClass('is-editing');\n\n\t\t\t\t\t// initialize editing area\n\t\t\t\t\tme.current_editing_area = me.make_editing_area($timeline_edit);\n\t\t\t\t\tme.current_editing_area.set_value(content);\n\n\t\t\t\t\t// submit handler\n\t\t\t\t\tme.current_editing_area.on_submit = (value) => {\n\t\t\t\t\t\t$timeline_edit.empty();\n\t\t\t\t\t\t$timeline_content.show();\n\n\t\t\t\t\t\t// set content to new val so that on save and refresh the new content is shown\n\t\t\t\t\t\tc.content = value;\n\t\t\t\t\t\tfrappe.timeline.update_communication(c);\n\t\t\t\t\t\tme.update_comment(name, value);\n\t\t\t\t\t\t// all changes to the timeline_item for editing are reset after calling refresh\n\t\t\t\t\t\tme.refresh();\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\n\n\t\tif(c.communication_type==\"Communication\" && c.communication_medium===\"Email\") {\n\t\t\tthis.last_type = c.communication_medium;\n\t\t\tthis.add_reply_btn_event($timeline_item, c);\n\t\t}\n\n\t}\n\n\tadd_reply_btn_event($timeline_item, c) {\n\t\tvar me = this;\n\t\t$timeline_item.find(\".reply-link\").on(\"click\", function() {\n\t\t\tvar name = $(this).attr(\"data-name\");\n\t\t\tvar last_email = null;\n\n\t\t\t// find the email tor reply to\n\t\t\tme.get_communications().forEach(function(c) {\n\t\t\t\tif(c.name==name) {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// make the composer\n\t\t\tnew frappe.views.CommunicationComposer({\n\t\t\t\tdoc: me.frm.doc,\n\t\t\t\ttxt: \"\",\n\t\t\t\ttitle: __('Reply'),\n\t\t\t\tfrm: me.frm,\n\t\t\t\tlast_email: last_email,\n\t\t\t\tis_a_reply: true\n\t\t\t});\n\t\t});\n\t}\n\n\tprepare_timeline_item(c) {\n\t\tif(!c.sender) c.sender = c.owner || 'Guest';\n\n\t\tif(c.sender && c.sender.indexOf(\"<\")!==-1) {\n\t\t\tc.sender = c.sender.split(\"<\")[1].split(\">\")[0];\n\t\t}\n\n\t\tc.user_info = frappe.user_info(c.sender);\n\n\t\tc[\"delete\"] = \"\";\n\t\tc[\"edit\"] = \"\";\n\t\tif(c.communication_type==\"Comment\" && (c.comment_type || \"Comment\") === \"Comment\") {\n\t\t\tif(frappe.model.can_delete(\"Communication\")) {\n\t\t\t\tc[\"delete\"] = '<a class=\"close delete-comment\" title=\"Delete\"  href=\"#\"><i class=\"octicon octicon-x\"></i></a>';\n\t\t\t}\n\n\t\t\tif(frappe.user.name == c.sender || (frappe.user.name == 'Administrator')) {\n\t\t\t\tc[\"edit\"] = '<a class=\"edit-comment text-muted\" title=\"Edit\" href=\"#\">Edit</a>';\n\t\t\t}\n\t\t}\n\t\tlet communication_date = c.communication_date || c.creation;\n\t\tc.comment_on_small = comment_when(communication_date, true);\n\t\tc.comment_on = comment_when(communication_date);\n\t\tc.futur_date = communication_date > frappe.datetime.now_datetime() ? true : false;\n\t\tif(!c.fullname) {\n\t\t\tc.fullname = c.sender_full_name || frappe.user.full_name(c.sender);\n\t\t}\n\n\t\tif(c.attachments && typeof c.attachments===\"string\")\n\t\t\tc.attachments = JSON.parse(c.attachments);\n\n\t\tif(c.communication_type==\"Comment\" && !c.comment_type) {\n\t\t\tc.comment_type = \"Comment\";\n\t\t}\n\n\t\tthis.set_icon_and_color(c);\n\n\t\t// label view\n\t\tif(c.comment_type===\"Workflow\" || c.comment_type===\"Label\") {\n\t\t\tc.comment_html = repl('<span class=\"label label-%(style)s\">%(text)s</span>', {\n\t\t\t\tstyle: frappe.utils.guess_style(c.content),\n\t\t\t\ttext: __(c.content)\n\t\t\t});\n\t\t} else {\n\t\t\tif(c.communication_type==\"Communication\" && c.communication_medium==\"Email\") {\n\t\t\t\tc.content = c.content.split(frappe.separator_element)[0];\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t} else if (c.communication_type===\"Feedback\") {\n\t\t\t\tc.content = frappe.utils.strip_original_content(c.content);\n\n\t\t\t\tc.original_content = c.content;\n\t\t\t\tc.content = frappe.utils.toggle_blockquote(c.content);\n\t\t\t}\n\t\t\tif(!frappe.utils.is_html(c.content)) {\n\t\t\t\tc.content_html = frappe.markdown(__(c.content));\n\t\t\t} else {\n\t\t\t\tc.content_html = c.content;\n\t\t\t\tc.content_html = frappe.utils.strip_whitespace(c.content_html);\n\t\t\t}\n\n\t\t\t// bold @mentions\n\t\t\tif(c.comment_type===\"Comment\" &&\n\t\t\t\t// avoid adding <b> tag a 2nd time\n\t\t\t\t!c.content_html.match(/(^|\\W)<b>(@[^\\s]+)<\\/b>/)\n\t\t\t) {\n\t\t\t\t/*\n\t\t\t\t\tReplace the email ids by only displaying the string which\n\t\t\t\t\toccurs before the second `@` to enhance the mentions.\n\t\t\t\t\tEg.\n\t\t\t\t\t@abc@a-example.com will be converted to\n\t\t\t\t\t@abc with the below line of code.\n\t\t\t\t*/\n\n\t\t\t\t// bold the @mentions\n\t\t\t\tc.content_html = c.content_html.replace(/(@[^\\s@]*)@[^\\s@|<]*/g, \"<b>$1</b>\");\n\t\t\t}\n\n\t\t\tif (this.is_communication_or_comment(c)) {\n\t\t\t\tc.user_content = true;\n\t\t\t\tif (!$.isArray(c._liked_by)) {\n\t\t\t\t\tc._liked_by = JSON.parse(c._liked_by || \"[]\");\n\t\t\t\t}\n\n\t\t\t\tc.liked_by_user = c._liked_by.indexOf(frappe.session.user)!==-1;\n\t\t\t}\n\t\t}\n\n\t\t// basic level of XSS protection\n\t\tc.content_html = frappe.dom.remove_script_and_style(c.content_html);\n\n\t\t// subject\n\t\tc.show_subject = false;\n\t\tif(c.subject && c.communication_type===\"Communication\") {\n\t\t\tif(this.frm.doc.subject && !this.frm.doc.subject.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(this.frm.meta.title_field && this.frm.doc[this.frm.meta.title_field]\n\t\t\t\t&& !!this.frm.doc[this.frm.meta.title_field].includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t} else if(!this.frm.doc.name.includes(c.subject)) {\n\t\t\t\tc.show_subject = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tis_communication_or_comment(c) {\n\t\treturn c.communication_type===\"Communication\"\n\t\t|| c.communication_type===\"Feedback\"\n\t\t|| (c.communication_type===\"Comment\" && (c.comment_type===\"Comment\"||c.comment_type===\"Relinked\"));\n\t}\n\n\tset_icon_and_color(c) {\n\t\tif(c.communication_type == \"Feedback\"){\n\t\t\tc.icon = \"octicon octicon-comment-discussion\"\n\t\t\tc.rating_icons = frappe.render_template(\"rating_icons\", {rating: c.rating, show_label: true})\n\t\t\tc.color = \"#f39c12\"\n\t\t} else {\n\t\t\tc.icon = {\n\t\t\t\t\"Email\": \"octicon octicon-mail\",\n\t\t\t\t\"Chat\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Phone\": \"octicon octicon-device-mobile\",\n\t\t\t\t\"SMS\": \"octicon octicon-comment\",\n\t\t\t\t\"Event\": \"fa fa-calendar\",\n\t\t\t\t\"Meeting\": \"octicon octicon-briefcase\",\n\t\t\t\t\"ToDo\": \"fa fa-check\",\n\t\t\t\t\"Created\": \"octicon octicon-plus\",\n\t\t\t\t\"Submitted\": \"octicon octicon-lock\",\n\t\t\t\t\"Cancelled\": \"octicon octicon-x\",\n\t\t\t\t\"Assigned\": \"octicon octicon-person\",\n\t\t\t\t\"Assignment Completed\": \"octicon octicon-check\",\n\t\t\t\t\"Comment\": \"octicon octicon-comment-discussion\",\n\t\t\t\t\"Workflow\": \"octicon octicon-git-branch\",\n\t\t\t\t\"Label\": \"octicon octicon-tag\",\n\t\t\t\t\"Attachment\": \"octicon octicon-cloud-upload\",\n\t\t\t\t\"Attachment Removed\": \"octicon octicon-trashcan\",\n\t\t\t\t\"Shared\": \"octicon octicon-eye\",\n\t\t\t\t\"Unshared\": \"octicon octicon-circle-slash\",\n\t\t\t\t\"Like\": \"octicon octicon-heart\",\n\t\t\t\t\"Edit\": \"octicon octicon-pencil\",\n\t\t\t\t\"Relinked\": \"octicon octicon-check\",\n\t\t\t\t\"Reply\": \"octicon octicon-mail-reply\"\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t\tc.color = {\n\t\t\t\t\"Email\": \"#3498db\",\n\t\t\t\t\"Chat\": \"#3498db\",\n\t\t\t\t\"Phone\": \"#3498db\",\n\t\t\t\t\"SMS\": \"#3498db\",\n\t\t\t\t\"Created\": \"#1abc9c\",\n\t\t\t\t\"Submitted\": \"#1abc9c\",\n\t\t\t\t\"Cancelled\": \"#c0392b\",\n\t\t\t\t\"Assigned\": \"#f39c12\",\n\t\t\t\t\"Assignment Completed\": \"#16a085\",\n\t\t\t\t\"Comment\": \"#f39c12\",\n\t\t\t\t\"Workflow\": \"#2c3e50\",\n\t\t\t\t\"Label\": \"#2c3e50\",\n\t\t\t\t\"Attachment\": \"#7f8c8d\",\n\t\t\t\t\"Attachment Removed\": \"#eee\",\n\t\t\t\t\"Relinked\": \"#16a085\",\n\t\t\t\t\"Reply\": \"#8d99a6\"\n\t\t\t}[c.comment_type || c.communication_medium];\n\n\t\t\tc.icon_fg = {\n\t\t\t\t\"Attachment Removed\": \"#333\",\n\t\t\t}[c.comment_type || c.communication_medium]\n\n\t\t}\n\t\tif(!c.icon_fg)\n\t\t\tc.icon_fg = \"#fff\";\n\t}\n\n\tget_communications(with_versions) {\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [].concat(docinfo.communications);\n\t\tif(with_versions) {\n\t\t\tthis.build_version_comments(docinfo, out);\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tget_view_logs(){\n\t\tvar docinfo = this.frm.get_docinfo(),\n\t\t\tme = this,\n\t\t\tout = [];\n\t\tfor(let c of docinfo.views){\n\t\t\tc.content = `<a href=\"#Form/View Log/${c.name}\"> ${__(\"viewed\")}</a>`;\n\t\t\tc.comment_type = \"Info\";\n\t\t\tout.push(c);\n\t\t};\n\t\treturn out;\n\t}\n\n\tbuild_version_comments(docinfo, out) {\n\t\tvar me = this;\n\t\tdocinfo.versions.forEach(function(version) {\n\t\t\tif(!version.data) return;\n\t\t\tvar data = JSON.parse(version.data);\n\n\t\t\t// comment\n\t\t\tif(data.comment) {\n\t\t\t\tout.push(me.get_version_comment(version, data.comment, data.comment_type));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// value changed in parent\n\t\t\tif(data.changed && data.changed.length) {\n\t\t\t\tvar parts = [];\n\t\t\t\tdata.changed.every(function(p) {\n\t\t\t\t\tif(p[0]==='docstatus') {\n\t\t\t\t\t\tif(p[2]==1) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('submitted this document')));\n\t\t\t\t\t\t} else if (p[2]==2) {\n\t\t\t\t\t\t\tout.push(me.get_version_comment(version, __('cancelled this document')));\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2}', [\n\t\t\t\t\t\t\t\t\t__(df.label),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold()\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed value of {0}\", [parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// value changed in table field\n\t\t\tif(data.row_changed && data.row_changed.length) {\n\t\t\t\tvar parts = [], count = 0;\n\t\t\t\tdata.row_changed.every(function(row) {\n\t\t\t\t\trow[3].every(function(p) {\n\t\t\t\t\t\tvar df = me.frm.fields_dict[row[0]] &&\n\t\t\t\t\t\t\tfrappe.meta.get_docfield(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\tp[0], me.frm.docname);\n\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df,\n\t\t\t\t\t\t\t\tnull, me.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\tparts.push(__('{0} from {1} to {2} in row #{3}', [\n\t\t\t\t\t\t\t\t\tfrappe.meta.get_label(me.frm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\t\t\t\t\tp[0]),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[1], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\t(frappe.ellipsis(p[2], 40) || '\"\"').bold(),\n\t\t\t\t\t\t\t\t\trow[1]\n\t\t\t\t\t\t\t\t]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t\t});\n\t\t\t\t\treturn parts.length < 3;\n\t\t\t\t});\n\t\t\t\tif(parts.length) {\n\t\t\t\t\tout.push(me.get_version_comment(version, __(\"changed values for {0}\",\n\t\t\t\t\t\t[parts.join(', ')])));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// rows added / removed\n\t\t\t// __('added'), __('removed') # for translation, don't remove\n\t\t\t['added', 'removed'].forEach(function(key) {\n\t\t\t\tif(data[key] && data[key].length) {\n\t\t\t\t\tparts = (data[key] || []).map(function(p) {\n\t\t\t\t\t\tvar df = frappe.meta.get_docfield(me.frm.doctype, p[0], me.frm.docname);\n\t\t\t\t\t\tif(df && !df.hidden) {\n\t\t\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(df, null,\n\t\t\t\t\t\t\t\tme.frm.perm);\n\n\t\t\t\t\t\t\tif(field_display_status === 'Read' || field_display_status === 'Write') {\n\t\t\t\t\t\t\t\treturn frappe.meta.get_label(me.frm.doctype, p[0])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tparts = parts.filter(function(p) { return p; });\n\t\t\t\t\tif(parts.length) {\n\t\t\t\t\t\tout.push(me.get_version_comment(version, __(\"{0} rows for {1}\",\n\t\t\t\t\t\t\t[__(key), parts.join(', ')])));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_version_comment(version, text, comment_type) {\n\t\tif(!comment_type) {\n\t\t\ttext = '<a href=\"#Form/Version/'+version.name+'\">' + text + '</a>';\n\t\t}\n\t\treturn {\n\t\t\tcomment_type: comment_type || 'Edit',\n\t\t\tcreation: version.creation,\n\t\t\towner: version.owner,\n\t\t\tversion_name: version.name,\n\t\t\tsender: version.owner,\n\t\t\tcomment_by: version.owner,\n\t\t\tcontent: text\n\t\t};\n\t}\n\n\tinsert_comment(comment_type, comment, btn) {\n\t\tvar me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"frappe.desk.form.utils.add_comment\",\n\t\t\targs: {\n\t\t\t\tdoc:{\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tcommunication_type: \"Comment\",\n\t\t\t\t\tcomment_type: comment_type || \"Comment\",\n\t\t\t\t\treference_doctype: this.frm.doctype,\n\t\t\t\t\treference_name: this.frm.docname,\n\t\t\t\t\tcontent: comment,\n\t\t\t\t\tsender: frappe.session.user\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: btn,\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tme.comment_area.set_value('');\n\t\t\t\t\tfrappe.utils.play_sound(\"click\");\n\n\t\t\t\t\tvar comment = r.message;\n\t\t\t\t\tvar comments = me.get_communications();\n\t\t\t\t\tvar comment_exists = false;\n\t\t\t\t\tfor (var i=0, l=comments.length; i<l; i++) {\n\t\t\t\t\t\tif (comments[i].name==comment.name) {\n\t\t\t\t\t\t\tcomment_exists = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (comment_exists) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tme.frm.get_docinfo().communications = comments.concat([r.message]);\n\t\t\t\t\tme.refresh(true);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\tdelete_comment(name) {\n\t\tvar me = this;\n\n\t\tfrappe.confirm(__('Delete comment?'), function() {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"frappe.client.delete\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Communication\",\n\t\t\t\t\tname: name\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\n\t\t\t\t\t\tme.frm.get_docinfo().communications =\n\t\t\t\t\t\t\t$.map(me.frm.get_docinfo().communications,\n\t\t\t\t\t\t\t\tfunction(v) {\n\t\t\t\t\t\t\t\t\tif(v.name==name) return null;\n\t\t\t\t\t\t\t\t\telse return v;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tme.refresh(true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Update comment\n\t *\n\t * @param {string} name\n\t * @param {string} content\n\t *\n\t * @returns {boolean}\n\t */\n\tupdate_comment(name, content){\n\t\treturn frappe.call({\n\t\t\tmethod: 'frappe.desk.form.utils.update_comment',\n\t\t\targs: { name, content },\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound('click');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tget_last_email(from_recipient) {\n\t\tvar last_email = null,\n\t\t\tcommunications = this.frm.get_docinfo().communications,\n\t\t\temail = this.get_recipient();\n\n\t\t$.each(communications && communications.sort(function(a, b) { return a.creation > b.creation ? -1 : 1 }), function(i, c) {\n\t\t\tif(c.communication_type=='Communication' && c.communication_medium==\"Email\") {\n\t\t\t\tif(from_recipient) {\n\t\t\t\t\tif(c.sender.indexOf(email)!==-1) {\n\t\t\t\t\t\tlast_email = c;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlast_email = c;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn last_email;\n\t}\n\n\tget_names_for_mentions() {\n\t\tvar valid_users = Object.keys(frappe.boot.user_info)\n\t\t\t.filter(user => ![\"Administrator\", \"Guest\"].includes(user));\n\n\t\treturn valid_users.map(user => frappe.boot.user_info[user].name);\n\t}\n\n\tsetup_comment_like() {\n\t\tthis.wrapper.on(\"click\", \".comment-likes .octicon-heart\", frappe.ui.click_toggle_like);\n\n\t\tfrappe.ui.setup_like_popover(this.wrapper, \".comment-likes\");\n\t}\n};\n\n$.extend(frappe.timeline, {\n\tnew_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\t\t\tvar communication_exists = false;\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tcommunication_exists = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!communication_exists) {\n\t\t\t\tdocinfo.communications = communications.concat([communication]);\n\t\t\t}\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tdelete_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\t\tif (index !== -1) {\n\t\t\t// remove it from communications list\n\t\t\tdocinfo.communications.splice(index, 1);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tupdate_communication: function(communication) {\n\t\tvar docinfo = frappe.model.get_docinfo(communication.reference_doctype, communication.reference_name);\n\t\tvar index = frappe.timeline.index_of_communication(communication, docinfo);\n\n\t\tif (index !== -1) {\n\t\t\t// update\n\t\t\t$.extend(docinfo.communications[index], communication);\n\t\t}\n\n\t\tif (cur_frm.doctype === communication.reference_doctype && cur_frm.docname === communication.reference_name) {\n\t\t\tcur_frm.timeline && cur_frm.timeline.refresh();\n\t\t}\n\t},\n\n\tindex_of_communication: function(communication, docinfo) {\n\t\tvar index = -1;\n\n\t\tif (docinfo && docinfo.communications) {\n\t\t\tvar communications = docinfo.communications;\n\n\t\t\tfor (var i=0, l=communications.length; i<l; i++) {\n\t\t\t\tif (communications[i].name==communication.name) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn index;\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nfrappe.provide(\"frappe.ui.form\");\n\nfrappe.ui.form.AssignTo = Class.extend({\n\tinit: function(opts) {\n\t\tvar me = this;\n\n\t\t$.extend(this, opts);\n\t\tthis.btn = this.parent.find(\".add-assignment\").on(\"click\", function() { me.add(); });\n\t\tthis.btn_wrapper = this.btn.parent();\n\n\t\tthis.refresh();\n\t},\n\trefresh: function() {\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tthis.parent.toggle(false);\n\t\t\treturn;\n\t\t}\n\t\tthis.parent.toggle(true);\n\t\tthis.render(this.frm.get_docinfo().assignments);\n\t},\n\trender: function(d) {\n\t\tvar me = this;\n\t\tthis.frm.get_docinfo().assignments = d;\n\t\tthis.parent.find(\".assignment-row\").remove();\n\n\t\tif(me.primary_action) {\n\t\t\tme.primary_action.remove();\n\t\t\tme.primary_action = null;\n\t\t}\n\n\t\tif(this.dialog) {\n\t\t\tthis.dialog.hide();\n\t\t}\n\n\t\tif(d && d.length) {\n\t\t\tfor(var i=0; i<d.length; i++) {\n\t\t\t\tvar info = frappe.user_info(d[i].owner);\n\t\t\t\tinfo.assign_to_name = d[i].name\n\t\t\t\tinfo.owner = d[i].owner;\n\t\t\t\tinfo.avatar = frappe.avatar(d[i].owner);\n\t\t\t\tinfo.description = d[i].description || \"\";\n\n\t\t\t\tinfo._fullname = info.fullname;\n\t\t\t\tif(info.fullname.length > 10) {\n\t\t\t\t\tinfo._fullname = info.fullname.substr(0, 10) + '...';\n\t\t\t\t}\n\n\t\t\t\t$(repl('<li class=\"assignment-row\">\\\n\t\t\t\t\t<a class=\"close\" data-owner=\"%(owner)s\">&times;</a>\\\n\t\t\t\t\t%(avatar)s\\\n\t\t\t\t\t<span><a href=\"#Form/ToDo/%(assign_to_name)s\">%(_fullname)s</a></span>\\\n\t\t\t\t</li>', info))\n\t\t\t\t\t.insertBefore(this.parent.find('.add-assignment'));\n\n\t\t\t\tif(d[i].owner===frappe.session.user) {\n\t\t\t\t\tme.primary_action = this.frm.page.add_menu_item(__(\"Assignment Complete\"), function() {\n\t\t\t\t\t\tme.remove(frappe.session.user);\n\t\t\t\t\t}, \"fa fa-check\", \"btn-success\")\n\t\t\t\t}\n\n\t\t\t\tif(!(d[i].owner === frappe.session.user || me.frm.perm[0].write)) {\n\t\t\t\t\tme.parent.find('a.close').remove();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set remove\n\t\t\tthis.parent.find('a.close').click(function() {\n\t\t\t\tme.remove($(this).attr('data-owner'));\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\t//this.btn_wrapper.addClass(\"hide\");\n\t\t} else {\n\t\t\t//this.btn_wrapper.removeClass(\"hide\");\n\t\t}\n\t},\n\tadd: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tif(!me.assign_to) {\n\t\t\tme.assign_to = new frappe.ui.form.AssignToDialog({\n\t\t\t\tobj: me,\n\t\t\t\tmethod: 'frappe.desk.form.assign_to.add',\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tdocname: me.frm.docname,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.render(r.message);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tme.assign_to.dialog.clear();\n\n\t\tif(me.frm.meta.title_field) {\n\t\t\tme.assign_to.dialog.set_value(\"description\", me.frm.doc[me.frm.meta.title_field])\n\t\t}\n\n\t\tme.assign_to.dialog.show();\n\t\tme.assign_to = null;\n\t},\n\tremove: function(owner) {\n\t\tvar me = this;\n\n\t\tif(this.frm.is_new()) {\n\t\t\tfrappe.throw(__(\"Please save the document before removing assignment\"));\n\t\t\treturn;\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod:'frappe.desk.form.assign_to.remove',\n\t\t\targs: {\n\t\t\t\tdoctype: me.frm.doctype,\n\t\t\t\tname: me.frm.docname,\n\t\t\t\tassign_to: owner\n\t\t\t},\n\t\t\tcallback:function(r,rt) {\n\t\t\t\tme.render(r.message);\n\t\t\t}\n\t\t});\n\t}\n});\n\n\nfrappe.ui.form.AssignToDialog = Class.extend({\n\tinit: function(opts){\n\t\tvar me = this\n\t\tvar dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add to To Do'),\n\t\t\tfields: [\n\t\t\t\t{ fieldtype: 'Link', fieldname: 'assign_to', options: 'User', label: __(\"Assign To\"), reqd: true, filters: { 'user_type': 'System User' }},\n\t\t\t\t{ fieldtype: 'Check', fieldname: 'myself', label: __(\"Assign to me\"), \"default\": 0 },\n\t\t\t\t{ fieldtype: 'Small Text', fieldname: 'description', label: __(\"Comment\") },\n\t\t\t\t{ fieldtype: 'Section Break' },\n\t\t\t\t{ fieldtype: 'Column Break' },\n\t\t\t\t{ fieldtype: 'Date', fieldname: 'date', label: __(\"Complete By\") },\n\t\t\t\t{ fieldtype: 'Check', fieldname: 'notify', label: __(\"Notify by Email\") },\n\t\t\t\t{ fieldtype: 'Column Break' },\n\t\t\t\t{ fieldtype: 'Select', fieldname: 'priority', label: __(\"Priority\"),\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ value: 'Low', label: __('Low') },\n\t\t\t\t\t\t{ value: 'Medium', label: __('Medium') },\n\t\t\t\t\t\t{ value: 'High', label: __('High') }\n\t\t\t\t\t],\n\t\t\t\t\t// Pick up priority from the source document, if it exists and is available in ToDo\n\t\t\t\t\t'default': [\"Low\", \"Medium\", \"High\"].includes(opts.obj.frm && opts.obj.frm.doc.priority\n\t\t\t\t\t\t? opts.obj.frm.doc.priority : 'Medium')\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: function() { frappe.ui.add_assignment(opts, this) },\n\t\t\tprimary_action_label: __(\"Add\")\n\t\t})\n\t\t$.extend(me, dialog);\n\n\t\tme.dialog = dialog;\n\n\t\tme.dialog.fields_dict.assign_to.get_query = \"frappe.core.doctype.user.user.user_query\";\n\n\t\tvar myself = me.dialog.get_input(\"myself\").on(\"click\", function() {\n\t\t\tme.toggle_myself(this);\n\t\t});\n\t\tme.toggle_myself(myself);\n\t},\n\ttoggle_myself: function(myself) {\n\t\tvar me = this;\n\t\tif($(myself).prop(\"checked\")) {\n\t\t\tme.dialog.set_value(\"assign_to\", frappe.session.user);\n\t\t\tme.dialog.set_value(\"notify\", 0);\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(false);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(false);\n\t\t} else {\n\t\t\tme.dialog.set_value(\"assign_to\", \"\");\n\t\t\tme.dialog.get_field(\"notify\").$wrapper.toggle(true);\n\t\t\tme.dialog.get_field(\"assign_to\").$wrapper.toggle(true);\n\t\t}\n\t},\n\n});\n\nfrappe.ui.add_assignment = function(opts, dialog) {\n\tvar assign_to = dialog.fields_dict.assign_to.get_value();\n\tvar args = dialog.get_values();\n\tif(args && assign_to) {\n\t\treturn frappe.call({\n\t\t\tmethod: opts.method,\n\t\t\targs: $.extend(args, {\n\t\t\t\tdoctype: opts.doctype,\n\t\t\t\tname: opts.docname,\n\t\t\t\tassign_to: assign_to,\n\t\t\t\tbulk_assign:  opts.bulk_assign || false,\n\t\t\t\tre_assign: opts.re_assign || false\n\t\t\t}),\n\t\t\tcallback: function(r,rt) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tif(opts.callback){\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t\t}\n\t\t\t\t\tdialog && dialog.hide();\n\t\t\t\t}\n\t\t\t},\n\t\t\tbtn: this\n\t\t});\n\t}\n}\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.make_quick_entry = (doctype, after_insert, init_callback, doc) => {\n\tvar trimmed_doctype = doctype.replace(/ /g, '');\n\tvar controller_name = \"QuickEntryForm\";\n\n\tif(frappe.ui.form[trimmed_doctype + \"QuickEntryForm\"]){\n\t\tcontroller_name = trimmed_doctype + \"QuickEntryForm\";\n\t}\n\n\tfrappe.quick_entry = new frappe.ui.form[controller_name](doctype, after_insert, init_callback, doc);\n\treturn frappe.quick_entry.setup();\n};\n\nfrappe.ui.form.QuickEntryForm = Class.extend({\n\tinit: function(doctype, after_insert, init_callback, doc) {\n\t\tthis.doctype = doctype;\n\t\tthis.after_insert = after_insert;\n\t\tthis.init_callback = init_callback;\n\t\tthis.doc = doc;\n\t},\n\n\tsetup: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.model.with_doctype(this.doctype, function() {\n\t\t\t\tme.set_meta_and_mandatory_fields();\n\t\t\t\tif(me.is_quick_entry()) {\n\t\t\t\t\tme.render_dialog();\n\t\t\t\t\tresolve(me);\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.quick_entry = null;\n\t\t\t\t\tfrappe.set_route('Form', me.doctype, me.doc.name)\n\t\t\t\t\t\t.then(() => resolve(me));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_meta_and_mandatory_fields: function(){\n\t\tlet fields = frappe.get_meta(this.doctype).fields;\n\t\tif (fields.length < 7) {\n\t\t\t// if less than 7 fields, then show everything\n\t\t\tthis.mandatory = fields;\n\t\t} else {\n\t\t\t// prepare a list of mandatory and bold fields\n\t\t\tthis.mandatory = $.map(fields,\n\t\t\t\tfunction(d) { return ((d.reqd || d.bold || d.allow_in_quick_entry) && !d.read_only) ? $.extend({}, d) : null; });\n\t\t}\n\t\tthis.meta = frappe.get_meta(this.doctype);\n\t\tif (!this.doc) {\n\t\t\tthis.doc = frappe.model.get_new_doc(this.doctype, null, null, true);\n\t\t}\n\t},\n\n\tis_quick_entry: function(){\n\t\tif(this.meta.quick_entry != 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.validate_for_prompt_autoname();\n\n\t\tif (this.has_child_table()\n\t\t\t|| !this.mandatory.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\ttoo_many_mandatory_fields: function(){\n\t\tif(this.mandatory.length > 7) {\n\t\t\t// too many fields, show form\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\thas_child_table: function(){\n\t\tif($.map(this.mandatory, function(d) {\n\t\t\treturn d.fieldtype==='Table' ? d : null; }).length) {\n\t\t\t// has mandatory table, quit!\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tvalidate_for_prompt_autoname: function(){\n\t\tif(this.meta.autoname && this.meta.autoname.toLowerCase()==='prompt') {\n\t\t\tthis.mandatory = [{fieldname:'__newname', label:__('{0} Name', [this.meta.name]),\n\t\t\t\treqd: 1, fieldtype:'Data'}].concat(this.mandatory);\n\t\t}\n\t},\n\n\trender_dialog: function(){\n\t\tvar me = this;\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"New {0}\", [__(this.doctype)]),\n\t\t\tfields: this.mandatory,\n\t\t});\n\t\tthis.dialog.doc = this.doc;\n\n\t\tthis.register_primary_action();\n\t\tthis.render_edit_in_full_page_link();\n\t\t// ctrl+enter to save\n\t\tthis.dialog.wrapper.keydown(function(e) {\n\t\t\tif((e.ctrlKey || e.metaKey) && e.which==13) {\n\t\t\t\tif(!frappe.request.ajax_count) {\n\t\t\t\t\t// not already working -- double entry\n\t\t\t\t\tme.dialog.get_primary_btn().trigger(\"click\");\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.dialog.onhide = () => frappe.quick_entry = null;\n\t\tthis.dialog.show();\n\n\t\tthis.dialog.refresh_dependency();\n\t\tthis.set_defaults();\n\n\t\tif (this.init_callback) {\n\t\t\tthis.init_callback(this.dialog);\n\t\t}\n\t},\n\n\tregister_primary_action: function(){\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif(me.dialog.working) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar data = me.dialog.get_values();\n\n\t\t\tif(data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tme.dialog.set_message(__('Saving...'));\n\t\t\t\tme.insert().then(() => {\n\t\t\t\t\tme.dialog.clear_message();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function() {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tme.update_doc();\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: me.dialog.doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif(frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_form_if_not_list: function() {\n\t\tlet route = frappe.get_route();\n\t\tlet doc = this.dialog.doc;\n\t\tif (route && !(route[0]==='List' && route[1]===doc.doctype)) {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => frappe.set_route('Form', doc.doctype, doc.name)\n\t\t\t]);\n\t\t}\n\t},\n\n\tupdate_doc: function(){\n\t\tvar me = this;\n\t\tvar data = this.dialog.get_values(true);\n\t\t$.each(data, function(key, value) {\n\t\t\tif(key==='__newname') {\n\t\t\t\tme.dialog.doc.name = value;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif(!is_null(value)) {\n\t\t\t\t\tme.dialog.doc[key] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn this.dialog.doc;\n\t},\n\n\topen_doc: function(){\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t},\n\n\trender_edit_in_full_page_link: function(){\n\t\tvar me = this;\n\t\tvar $link = $('<div style=\"padding-left: 7px; padding-top: 30px; padding-bottom: 10px;\">' +\n\t\t\t'<button class=\"edit-full btn-default btn-sm\">' + __(\"Edit in full page\") + '</button></div>').appendTo(this.dialog.body);\n\n\t\t$link.find('.edit-full').on('click', function() {\n\t\t\t// edit in form\n\t\t\tme.open_doc();\n\t\t});\n\t},\n\n\tset_defaults: function(){\n\t\tvar me = this;\n\t\t// set defaults\n\t\t$.each(this.dialog.fields_dict, function(fieldname, field) {\n\t\t\tfield.doctype = me.doc.doctype;\n\t\t\tfield.docname = me.doc.name;\n\n\t\t\tif(!is_null(me.doc[fieldname])) {\n\t\t\t\tfield.set_input(me.doc[fieldname]);\n\t\t\t}\n\t\t});\n\t}\n});\n","frappe.provide('frappe.ui.form');\nfrappe.provide('frappe.success_action');\n\nfrappe.ui.form.SuccessAction = class SuccessAction {\n\tconstructor(form) {\n\t\tthis.form = form;\n\t\tthis.load_setting();\n\t}\n\n\tload_setting() {\n\t\tthis.setting = frappe.boot.success_action\n\t\t\t.find(setting => setting.ref_doctype === this.form.doctype);\n\t}\n\n\tshow() {\n\t\tif (!this.setting) return;\n\t\tif (this.form.doc.docstatus === 0 && !this.form.is_first_creation()) return;\n\n\t\tthis.prepare_dom();\n\t\tthis.show_alert();\n\t}\n\n\tprepare_dom() {\n\t\tthis.container = $(document.body).find('.success-container');\n\t\tif (!this.container.length) {\n\t\t\tthis.container = $('<div class=\"success-container\">').appendTo(document.body);\n\t\t}\n\t}\n\n\tshow_alert() {\n\t\tfrappe.db.count(this.form.doctype)\n\t\t\t.then(count => {\n\t\t\t\tconst setting = this.setting;\n\t\t\t\tlet message = count === 1 ?\n\t\t\t\t\tsetting.first_success_message :\n\t\t\t\t\tsetting.message;\n\n\t\t\t\tconst $buttons = this.get_actions().map(action => {\n\t\t\t\t\tconst $btn = $(`<button class=\"next-action\"><span>${action.label}</span></button>`);\n\t\t\t\t\t$btn.click(() => action.action(this.form));\n\t\t\t\t\treturn $btn;\n\t\t\t\t});\n\n\t\t\t\tconst next_action_container = $(`<div class=\"next-action-container\"></div>`);\n\t\t\t\tnext_action_container.append($buttons);\n\t\t\t\tconst html = next_action_container;\n\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: message,\n\t\t\t\t\tbody: html,\n\t\t\t\t\tindicator: 'green',\n\t\t\t\t}, setting.action_timeout);\n\t\t\t});\n\t}\n\n\tget_actions() {\n\t\tconst actions = [];\n\t\tconst checked_actions = this.setting.next_actions.split(\"\\n\");\n\t\tchecked_actions\n\t\t\t.forEach(action => {\n\t\t\t\tif (typeof action === 'string' && this.default_actions[action]) {\n\t\t\t\t\tactions.push(this.default_actions[action]);\n\t\t\t\t} else if (typeof action === 'object') {\n\t\t\t\t\tactions.push(action);\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn actions;\n\t}\n\n\tget default_actions() {\n\t\treturn {\n\t\t\t'new': {\n\t\t\t\tlabel: __('New'),\n\t\t\t\taction: (frm) => frappe.new_doc(frm.doctype)\n\t\t\t},\n\t\t\t'print': {\n\t\t\t\tlabel: __('Print'),\n\t\t\t\taction: (frm) => frm.print_doc()\n\t\t\t},\n\t\t\t'email': {\n\t\t\t\tlabel: __('Email'),\n\t\t\t\taction: (frm) => frm.email_doc()\n\t\t\t},\n\t\t\t'list': {\n\t\t\t\tlabel: __('View All'),\n\t\t\t\taction: (frm) => {\n\t\t\t\t\tfrappe.set_route('List', frm.doctype);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n};\n"],"names":["frappe","provide","views","FormFactory","Factory","[object Object]","route","me","this","dt","formview","show_doc","model","with_doctype","page","container","add_page","frm","_f","Frm","initialized","$","document","on","ui","form","close_grid_form","realtime","data","timeline","new_communication","delete_communication","update_communication","set_viewers","dn","slice","join","new_names","set_route","with_doc","r","locals","load","new_str","__","substr","length","new_name","make_new_doc_and_get_name","show_not_found","change_to","refresh","Controller","Class","extend","init","opts","frms","doctype","parent","in_form","docname","hidden","refresh_if_stale_for","opendocs","custom_buttons","sections","grids","cscript","events","pformat","fetch_dict","tinymce_id_list","setup_meta","event","old_name","rename_notify","prototype","check_doctype_conflict","msgprint","pages","window","location","reload","DocType","setup","fields","fields_dict","state_fieldname","workflow","get_state_fieldname","wrapper","$wrapper","make_app_page","single_column","meta","hide_toolbar","layout_main","main","get","toolbar","Toolbar","setup_print_layout","setup_std_layout","script_manager","ScriptManager","watch_model_updates","footer","Footer","appendTo","attr","setup_drag_drop","setup_done","e","dataTransfer","originalEvent","files","stopPropagation","preventDefault","doc","__islocal","attachments","max_reached","upload","make","args","get_args","callback","attachment","attachment_uploaded","print_preview","PrintPreview","set_primary_action","print_doc","is","hide_print","can_print","refresh_print_options","trigger","set_view","set_user_lang","set_default_print_language","preview","current_view_name","previous_view_name","fieldname","value","name","dirty","layout","refresh_dependency","table_fields","get_children","fieldtype","each","i","df","options","parentfield","grid","set_value","form_wrapper","body","section_style","Layout","with_dashboard","fields_list","document_flow","DocumentFlow","dashboard","Dashboard","states","States","email_doc","message","CommunicationComposer","subject","recipients","email","email_id","contact_email","attach_document_print","real_name","contact_display","contact_name","rename_doc","share_doc","shared","show","old","istable","docfield_copy","in_dialog","re_route","hash","encodeURIComponent","get_doc","perm","get_perm","refresh_header","is_a_different_doc","utils","set_title","issingle","current_status","undefined","is_submittable","submit","is_dirty","is_new","has_workflow","docstatus","add_comment","clear_custom_buttons","show_web_link","__onload","is_website_generator","web_link","remove","published","add_web_link","path","label","sidebar","add_user_action","check_doc_perm","parent_doctype","read","scroll_to","forEach","grid_obj","visible_columns","cur_frm","show_not_permitted","read_only","is_read_only","set_read_only","__unsaved","__last_sync_on","Date","reload_doc","is_onload","render_form","localname","setnewdoc","show_print_first","removeClass","toggleClass","show_if_needs_refresh","__needs_refresh","clear_headline","set_headline_alert","attach_doc_and_docfields","Sidebar","show_message","run_serially","refresh_fields","after_refresh","first","find","in_list","focus","show_empty_form_message","scroll_to_element","refresh_field","fname","primary_button","cleanup_refresh","amended_from","unhide_field","hide_field","trash_reason","autoname","fn","toggle_display","then","after_ajax","trigger_link_fields","breadcrumbs","add","module","track_seen","addClass","__run_link_triggers","field","runscript","scriptname","callingfield","onrefresh","input","set_working","call","method","docs","btn","$input","exc","copy_doc","onload","from_amend","validate_form_action","newdoc","idx","remove_from_locals","validated","Object","defineProperty","console","warn","set","save","save_action","on_error","let","Promise","resolve","reject","prop","activeElement","blur","setTimeout","_save","show_success_action","catch","error","after_save","indexOf","play_sound","fail","savesubmit","handle_fail","confirm","savecancel","savetrash","delete_doc","history","back","amend_doc","amendment_date","datetime","obj_to_str","alert","disable_save","save_disabled","clear_primary_action","enable_save","save_or_update","get_docinfo","docinfo","reload_docinfo","assign_to","permlevel","access_type","set_intro","txt","set_footnote","footnote_area","add_custom_button","group","add_inner_button","clear_inner_toolbar","clear_user_actions","remove_custom_button","remove_inner_button","add_fetch","link_field","src_field","tar_field","columns","push","set_print_heading","action_perm_type_map","Create","Save","Submit","Update","Cancel","Amend","Delete","action","perm_to_check","allowed_for_workflow","perms","throw","has_perm","ptype","route_options","selector","key","repl","get_route","SuccessAction","is_first_creation","modified","split","creation","get_server_fields","arg","table_field","allow_edit","call_back","dom","freeze","isPlainObject","JSON","stringify","$c","unfreeze","d","field_dict","set_multiple","dict","refresh_many","flist","set_field_tip","n","get_docfield","description","comment_area","innerHTML","replace_newlines","log","filter_dict","docfields","grid_rows_by_docname","set_field_options","set_df_property","set_field_permlevel","level","toggle_field","get_field_obj","set_currency_labels","currency","field_label_map","grid_field_label_map","docfield","docfield_map","replace","trim","set_label","field_map","fnames","keys","l","fieldname1","fieldname2","property","toggle_enable","enable","toggle_reqd","mandatory","reqd","call_server","$c_obj","get_files","sort","get_attachments","set_query","opt1","opt2","get_field","get_query","set_value_if_missing","clear_table","add_child","values","unique_keys","map","includes","if_missing","_set","f","v","fieldobj","has_value","isArray","j","child","tasks","original_callback","get_server_module_name","std_field_list","concat","std_fields_list","docperms","print","cancel","get_formatted","format","no_icon","open_grid_row","get_open_grid_form","get_title","title_field","get_selected","selected","get_table_fields","_selected","has_mapper","_has_mapper","__js","search","set_indicator_formatter","get_color","get_text","every","formatter","link_formatters","const","escaped_name","color","can_create","custom_make_buttons","can_make_methods","make_new","make_methods","new_doc","get_new_doc","get_meta","make_quick_entry","update_in_all_rows","table_fieldname","cl","get_sum","sum","add_update_button_on_dirty","setup_editable_title","make_menu","show_title_as_dirty","hide_menu","print_icon","show_menu","title","strip_html","set_title_sub","$title_area","is_title_editable","can_rename","set_indicator","write","allow_rename","prompt","default","get_dropdown_menu","add_dropdown","indicator","get_indicator","clear_indicator","clear_icons","clear_menu","p","cint","print_settings","allow_print_for_draft","allow_print_for_cancelled","add_menu_item","add_action_icon","can_email","show_linked_with","boot","user","allow_copy","add_to_desktop","can_delete","user_roles","doc_type","developer_mode","Feedback","manual_feedback_request","CREATE","can_save","get_docstatus","can_submit","can_update","can_cancel","can_amend","amend","_has_workflow","get_list","document_type","linked_with","LinkedWith","status","get_action_status","set_page_actions","clear_actions","set_secondary_action","click","icon","make_cancel_amend_button","CANCEL","AMEND","clear_actions_menu","section","_form_dashboard","render_template","progress_area","heatmap_area","chart_area","stats_area","stats_area_row","links_area","transactions_area","reset","empty","set_headline","html","text","alert_class","permanent","clear_comment","indicator_color","add_section","add_progress","percent","progress_chart","make_progress_chart","format_percent","progress","show_progress","_progress_map","progress_bar","css","width","progress_class","hide_progress","init_data","transactions","render_links","set_open_count","heatmap","render_heatmap","graph","setup_graph","__dashboard","internal_links","filter_permissions","add_transactions","group_added","Array","items","ref","can_read","data_rendered","open_document_list","$link","show_open","names","get_document_filter","notifications","show_open_count_list","filter","non_standard_fieldnames","dynamic_links","item","type","timeline_data","update_heatmap","count","set_badge_count","open_count","link","link_fieldname","dashboard_data","update","Chart","scrub","height","start","moment","subtract","toDate","count_label","discreteDomains","margin","heatmap_message","add_indicator","colspan","indicators","n_indicators","graph_method","graph_method_args","render_graph","colors","chart","hide","doctypes","prependTo","render","get_linked_docs","mark_completed_flow","for_doctype","frm_doctype","frm_docname","workflow_state_fieldname","working_label","toTitle","freeze_message","remove_empty_rows","get_all_docs","is_table","cells","is_empty_row","docfield_list","in_list_view","clear_doc","check_mandatory","has_errors","scroll_set","error_fields","folded","unfold","parenttype","bold","scrollTop","offset","top","_call","is_saving","remove_old_form_route","always","update_calling_link","workflow_state","current_route","route_history","_from_link","grid_rows","index","_from_link_scrollY","get_event_handler_list","handlers","on_change","handler","add_handler","off","ControllerClass","event_name","get_handlers","selected_doc","runner","_function","is_old_style","_promise","after_server_call","new_style","old_style","has_handlers","cs","tmp","eval","__custom_js","stack","setup_add_fetch","fetch_from","parts","get_docfields","__css","set_style","log_error","caller","show_alert","trace","groupEnd","copy_from_first_row","current_row","fieldnames","dialog","make_dialog","Dialog","hide_on_page_refresh","on_page_show","get_linked_doctypes","load_doctypes","links_not_permitted_or_missing","make_html","linked_docs","__linked_docs","linked_doctypes","make_doc_head","make_doc_row","already_loaded","doctypes_to_load","__linked_doctypes","promises","listview_settings","add_fields","all","flag","links","can_get_report","linkinfo","heading","update_fields","get_update_fields","bind","setup_help","add_action_item","state","get_state","workflows","get_transitions","transitions","next_html","allowed","get_document_state","padding","set_default_state","show_actions","added","transition","approval_access","session","allow_self_approval","owner","xcall","sync","setup_btn","action_added","btn_primary","btn_secondary","default_state","get_default_state","bind_events","add_view","toggle","has_role","which","target","print_formats","get_print_formats","print_letterhead","print_sel","with_letterhead","multilingual_preview","language_sel","lang_code","val","print_old_style","printit","new_page_preview_old_style","new_page_preview","open","urllib","get_full_url","selected_format","print_format","get_print_format","is_custom_format","print_format_builder","standard","custom_format","print_format_name","based_on","language","add_options","get_languages","default_print_language","lang","preview_old_style","get_print_html","out","$print_format","show_footer","style","print_height","offsetHeight","$message","pixel_to_inches","display","flexDirection","flex-direction","flex","no_letterhead","_req","abort","_lang","with_old_style","only_body","no_heading","require","_p","build","go","default_print_format","print_format_type","print_css","get_print_settings","pdf","letter_head","default_letter_head","defaults","get_default","depends_on","letter_heads","with_letter_head","sidebar_content","ratings","comments","user_actions","image_section","image_wrapper","make_assignments","make_attachments","make_shared","make_viewers","make_tags","make_like","setup_user_image_event","like_icon","toggle_like","refresh_like","viewers","tags","_user_tags","full_name","modified_by","comment_when","setup_ratings","set_user_image","refresh_comments","get_communications","c","communication_type","comment_type","total_comments","TagEditor","user_tags","Attachments","AssignTo","Share","Viewers","like_wrapper","like_count","setup_like_popover","_liked_by","is_liked","parse","refresh_image","_ratings","rating","rating_icons","show_label","image_field","image","title_image","cordova","base_url","background-color","get_palette","get_abbr","make_input","render_sidebar","users","s","everyone","avatar_class","user_info","fullname","abbr","append","render_shared","onhide","can_share","make_user_input","add_share_button","set_edit_share_events","share_with","make_control","filters","user_type","only_input","render_input","get_value","share","notify","parents","permission_to","found","get_viewers","data_updated","new_users","current","username","new","comma_and","past_viewers","past","new_viewers","viewer","set_docinfo","make_comments","Timeline","new_attachment","add_attachment_wrapper","attachments_label","max_attachments","add_attachment","file_name","file_url","get_file_url","fileid","$close","file_path","is_private","insertAfter","remove_btn","remove_attachment","can_write","encodeURI","get_file_id_from_file_url","fid","remove_attachment_by_filename","filename","rt","_server_messages","remove_fileid","communications","get_upload_dialog","max_width","attachment_max_width","max_height","attachment_max_height","from_form","update_attachment","comment","add_to_attachments","form_attachments","new_attachments","no_focus","onchange","gsuite_enabled","related_doctype","gs_template","upload_area","on_select","onerror","separator_element","allow_events_in_timeline","list","mentions","get_names_for_mentions","on_submit","insert_comment","button","setup_email_button","setup_interaction_button","siblings","setup_comment_like","new_communications","more","email_button","is_a_reply","get_recipient","last_email","sender","comment_value","markdown","activity_button","InteractionComposer","$editing_area","editing_area","CommentArea","no_wrapper","destroy","scroll_to_end","last_type","get_view_logs","a","content","b","compare_dates","render_timeline_item","communication_date","change","b_date","c_date","prepare_timeline_item","$timeline_item","delete_comment","hasClass","current_editing_area","$edit_btn","$timeline_content","$timeline_edit","make_editing_area","update_comment","communication_medium","add_reply_btn_event","comment_on_small","comment_on","futur_date","now_datetime","sender_full_name","set_icon_and_color","comment_html","guess_style","strip_original_content","original_content","toggle_blockquote","is_html","content_html","strip_whitespace","match","is_communication_or_comment","user_content","liked_by_user","remove_script_and_style","show_subject","Email","Chat","Phone","SMS","Event","Meeting","ToDo","Created","Submitted","Cancelled","Assigned","Assignment Completed","Comment","Workflow","Label","Attachment","Attachment Removed","Shared","Unshared","Like","Edit","Relinked","Reply","icon_fg","with_versions","build_version_comments","versions","version","get_version_comment","changed","field_display_status","get_field_display_status","ellipsis","row_changed","row","get_label","version_name","comment_by","reference_doctype","reference_name","comment_exists","email_field","from_recipient","click_toggle_like","communication","communication_exists","index_of_communication","splice","btn_wrapper","assignments","primary_action","info","assign_to_name","avatar","_fullname","insertBefore","AssignToDialog","obj","clear","priority","add_assignment","primary_action_label","myself","get_input","toggle_myself","get_values","bulk_assign","re_assign","after_insert","init_callback","trimmed_doctype","controller_name","quick_entry","QuickEntryForm","set_meta_and_mandatory_fields","is_quick_entry","render_dialog","allow_in_quick_entry","validate_for_prompt_autoname","has_child_table","too_many_mandatory_fields","toLowerCase","register_primary_action","render_edit_in_full_page_link","keydown","ctrlKey","metaKey","request","ajax_count","get_primary_btn","set_defaults","working","set_message","insert","clear_message","update_doc","open_form_if_not_list","open_doc","is_null","set_input","load_setting","setting","success_action","ref_doctype","prepare_dom","db","first_success_message","$buttons","get_actions","$btn","next_action_container","action_timeout","actions","next_actions","default_actions"],"mappings":"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"}